import {
  __values
} from "tslib";
/**
 * Rules
 * The filter works as a series of rules so that each word can be mapped to a rule.  So \"Happy\" can become \"happy\" and \"b4d\" and become \"bad\".    With this API you can manage your rules.
 *
 * OpenAPI spec version: 2.0.3
 * Contact: support@twohat.com
 *
 * NOTE: This class is auto generated by the swagger code generator program.
 * https://github.com/swagger-api/swagger-codegen.git
 * Do not edit the class manually.
 */
/* tslint:disable:no-unused-variable member-ordering */
import {
  Inject,
  Injectable,
  Optional
} from '@angular/core';
import {
  HttpHeaders,
  HttpParams
} from '@angular/common/http';
import {
  CustomHttpUrlEncodingCodec
} from '../encoder';
import {
  BASE_PATH,
  COLLECTION_FORMATS
} from '../variables';
import {
  Configuration
} from '../configuration';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common/http";
import * as i2 from "../configuration";
var DefaultService = /** @class */ (function () {
  function DefaultService(httpClient, basePath, configuration) {
    this.httpClient = httpClient;
    this.basePath = 'https://virtserver.swaggerhub.com/twohat/rules/2.0.3';
    this.defaultHeaders = new HttpHeaders();
    this.configuration = new Configuration();
    if (basePath) {
      this.basePath = basePath;
    }
    if (configuration) {
      this.configuration = configuration;
      this.basePath = basePath || configuration.basePath || this.basePath;
    }
  }
  /**
   * @param consumes string[] mime-types
   * @return true: consumes contains 'multipart/form-data', false: otherwise
   */
  DefaultService.prototype.canConsumeForm = function (consumes) {
    var e_1, _a;
    var form = 'multipart/form-data';
    try {
      for (var consumes_1 = __values(consumes), consumes_1_1 = consumes_1.next(); !consumes_1_1.done; consumes_1_1 = consumes_1.next()) {
        var consume = consumes_1_1.value;
        if (form === consume) {
          return true;
        }
      }
    } catch (e_1_1) {
      e_1 = {
        error: e_1_1
      };
    } finally {
      try {
        if (consumes_1_1 && !consumes_1_1.done && (_a = consumes_1.return)) _a.call(consumes_1);
      } finally {
        if (e_1) throw e_1.error;
      }
    }
    return false;
  };
  DefaultService.prototype.addComment = function (language, text, body, clientId, observe, reportProgress) {
    if (observe === void 0) {
      observe = 'body';
    }
    if (reportProgress === void 0) {
      reportProgress = false;
    }
    if (language === null || language === undefined) {
      throw new Error('Required parameter language was null or undefined when calling addComment.');
    }
    if (text === null || text === undefined) {
      throw new Error('Required parameter text was null or undefined when calling addComment.');
    }
    var queryParameters = new HttpParams({
      encoder: new CustomHttpUrlEncodingCodec()
    });
    if (language !== undefined && language !== null) {
      queryParameters = queryParameters.set('language', language);
    }
    if (clientId !== undefined && clientId !== null) {
      queryParameters = queryParameters.set('clientId', clientId);
    }
    var headers = this.defaultHeaders;
    // authentication (bearerAuth) required
    if (this.configuration.accessToken) {
      var accessToken = typeof this.configuration.accessToken === 'function' ?
        this.configuration.accessToken() :
        this.configuration.accessToken;
      headers = headers.set('Authorization', 'Bearer ' + accessToken);
    }
    // to determine the Accept header
    var httpHeaderAccepts = [
      'application/json'
    ];
    var httpHeaderAcceptSelected = this.configuration.selectHeaderAccept(httpHeaderAccepts);
    if (httpHeaderAcceptSelected != undefined) {
      headers = headers.set('Accept', httpHeaderAcceptSelected);
    }
    // to determine the Content-Type header
    var consumes = [
      'application/json'
    ];
    var httpContentTypeSelected = this.configuration.selectHeaderContentType(consumes);
    if (httpContentTypeSelected != undefined) {
      headers = headers.set('Content-Type', httpContentTypeSelected);
    }
    return this.httpClient.request('post', this.basePath + "/rules/text/" + encodeURIComponent(String(text)) + "/comments", {
      body: body,
      params: queryParameters,
      withCredentials: this.configuration.withCredentials,
      headers: headers,
      observe: observe,
      reportProgress: reportProgress
    });
  };
  DefaultService.prototype.deleteAlternateSense = function (text, language, dependency, clientId, publish, observe, reportProgress) {
    if (observe === void 0) {
      observe = 'body';
    }
    if (reportProgress === void 0) {
      reportProgress = false;
    }
    if (text === null || text === undefined) {
      throw new Error('Required parameter text was null or undefined when calling deleteAlternateSense.');
    }
    if (language === null || language === undefined) {
      throw new Error('Required parameter language was null or undefined when calling deleteAlternateSense.');
    }
    if (dependency === null || dependency === undefined) {
      throw new Error('Required parameter dependency was null or undefined when calling deleteAlternateSense.');
    }
    var queryParameters = new HttpParams({
      encoder: new CustomHttpUrlEncodingCodec()
    });
    if (language !== undefined && language !== null) {
      queryParameters = queryParameters.set('language', language);
    }
    if (clientId !== undefined && clientId !== null) {
      queryParameters = queryParameters.set('clientId', clientId);
    }
    if (publish !== undefined && publish !== null) {
      queryParameters = queryParameters.set('publish', publish);
    }
    var headers = this.defaultHeaders;
    // authentication (bearerAuth) required
    if (this.configuration.accessToken) {
      var accessToken = typeof this.configuration.accessToken === 'function' ?
        this.configuration.accessToken() :
        this.configuration.accessToken;
      headers = headers.set('Authorization', 'Bearer ' + accessToken);
    }
    // to determine the Accept header
    var httpHeaderAccepts = [
      'application/json'
    ];
    var httpHeaderAcceptSelected = this.configuration.selectHeaderAccept(httpHeaderAccepts);
    if (httpHeaderAcceptSelected != undefined) {
      headers = headers.set('Accept', httpHeaderAcceptSelected);
    }
    // to determine the Content-Type header
    var consumes = [];
    return this.httpClient.request('delete', this.basePath + "/rules/text/" + encodeURIComponent(String(text)) + "/alt_senses/" + encodeURIComponent(String(dependency)), {
      params: queryParameters,
      withCredentials: this.configuration.withCredentials,
      headers: headers,
      observe: observe,
      reportProgress: reportProgress
    });
  };
  DefaultService.prototype.deleteAlternateSpelling = function (text, language, dependency, clientId, publish, observe, reportProgress) {
    if (observe === void 0) {
      observe = 'body';
    }
    if (reportProgress === void 0) {
      reportProgress = false;
    }
    if (text === null || text === undefined) {
      throw new Error('Required parameter text was null or undefined when calling deleteAlternateSpelling.');
    }
    if (language === null || language === undefined) {
      throw new Error('Required parameter language was null or undefined when calling deleteAlternateSpelling.');
    }
    if (dependency === null || dependency === undefined) {
      throw new Error('Required parameter dependency was null or undefined when calling deleteAlternateSpelling.');
    }
    var queryParameters = new HttpParams({
      encoder: new CustomHttpUrlEncodingCodec()
    });
    if (language !== undefined && language !== null) {
      queryParameters = queryParameters.set('language', language);
    }
    if (clientId !== undefined && clientId !== null) {
      queryParameters = queryParameters.set('clientId', clientId);
    }
    if (publish !== undefined && publish !== null) {
      queryParameters = queryParameters.set('publish', publish);
    }
    var headers = this.defaultHeaders;
    // authentication (bearerAuth) required
    if (this.configuration.accessToken) {
      var accessToken = typeof this.configuration.accessToken === 'function' ?
        this.configuration.accessToken() :
        this.configuration.accessToken;
      headers = headers.set('Authorization', 'Bearer ' + accessToken);
    }
    // to determine the Accept header
    var httpHeaderAccepts = [
      'application/json'
    ];
    var httpHeaderAcceptSelected = this.configuration.selectHeaderAccept(httpHeaderAccepts);
    if (httpHeaderAcceptSelected != undefined) {
      headers = headers.set('Accept', httpHeaderAcceptSelected);
    }
    // to determine the Content-Type header
    var consumes = [];
    return this.httpClient.request('delete', this.basePath + "/rules/text/" + encodeURIComponent(String(text)) + "/alt_spellings/" + encodeURIComponent(String(dependency)), {
      params: queryParameters,
      withCredentials: this.configuration.withCredentials,
      headers: headers,
      observe: observe,
      reportProgress: reportProgress
    });
  };
  DefaultService.prototype.deleteComment = function (text, language, commentId, clientId, observe, reportProgress) {
    if (observe === void 0) {
      observe = 'body';
    }
    if (reportProgress === void 0) {
      reportProgress = false;
    }
    if (text === null || text === undefined) {
      throw new Error('Required parameter text was null or undefined when calling deleteComment.');
    }
    if (language === null || language === undefined) {
      throw new Error('Required parameter language was null or undefined when calling deleteComment.');
    }
    if (commentId === null || commentId === undefined) {
      throw new Error('Required parameter commentId was null or undefined when calling deleteComment.');
    }
    var queryParameters = new HttpParams({
      encoder: new CustomHttpUrlEncodingCodec()
    });
    if (language !== undefined && language !== null) {
      queryParameters = queryParameters.set('language', language);
    }
    if (clientId !== undefined && clientId !== null) {
      queryParameters = queryParameters.set('clientId', clientId);
    }
    var headers = this.defaultHeaders;
    // authentication (bearerAuth) required
    if (this.configuration.accessToken) {
      var accessToken = typeof this.configuration.accessToken === 'function' ?
        this.configuration.accessToken() :
        this.configuration.accessToken;
      headers = headers.set('Authorization', 'Bearer ' + accessToken);
    }
    // to determine the Accept header
    var httpHeaderAccepts = [
      'application/json'
    ];
    var httpHeaderAcceptSelected = this.configuration.selectHeaderAccept(httpHeaderAccepts);
    if (httpHeaderAcceptSelected != undefined) {
      headers = headers.set('Accept', httpHeaderAcceptSelected);
    }
    // to determine the Content-Type header
    var consumes = [];
    return this.httpClient.request('delete', this.basePath + "/rules/text/" + encodeURIComponent(String(text)) + "/comments/" + encodeURIComponent(String(commentId)), {
      params: queryParameters,
      withCredentials: this.configuration.withCredentials,
      headers: headers,
      observe: observe,
      reportProgress: reportProgress
    });
  };
  DefaultService.prototype.deleteFlag = function (text, language, flag, clientId, publish, observe, reportProgress) {
    if (observe === void 0) {
      observe = 'body';
    }
    if (reportProgress === void 0) {
      reportProgress = false;
    }
    if (text === null || text === undefined) {
      throw new Error('Required parameter text was null or undefined when calling deleteFlag.');
    }
    if (language === null || language === undefined) {
      throw new Error('Required parameter language was null or undefined when calling deleteFlag.');
    }
    if (flag === null || flag === undefined) {
      throw new Error('Required parameter flag was null or undefined when calling deleteFlag.');
    }
    var queryParameters = new HttpParams({
      encoder: new CustomHttpUrlEncodingCodec()
    });
    if (language !== undefined && language !== null) {
      queryParameters = queryParameters.set('language', language);
    }
    if (clientId !== undefined && clientId !== null) {
      queryParameters = queryParameters.set('clientId', clientId);
    }
    if (publish !== undefined && publish !== null) {
      queryParameters = queryParameters.set('publish', publish);
    }
    var headers = this.defaultHeaders;
    // authentication (bearerAuth) required
    if (this.configuration.accessToken) {
      var accessToken = typeof this.configuration.accessToken === 'function' ?
        this.configuration.accessToken() :
        this.configuration.accessToken;
      headers = headers.set('Authorization', 'Bearer ' + accessToken);
    }
    // to determine the Accept header
    var httpHeaderAccepts = [
      'application/json'
    ];
    var httpHeaderAcceptSelected = this.configuration.selectHeaderAccept(httpHeaderAccepts);
    if (httpHeaderAcceptSelected != undefined) {
      headers = headers.set('Accept', httpHeaderAcceptSelected);
    }
    // to determine the Content-Type header
    var consumes = [];
    return this.httpClient.request('delete', this.basePath + "/rules/text/" + encodeURIComponent(String(text)) + "/flags/" + encodeURIComponent(String(flag)), {
      params: queryParameters,
      withCredentials: this.configuration.withCredentials,
      headers: headers,
      observe: observe,
      reportProgress: reportProgress
    });
  };
  DefaultService.prototype.deleteLeetMapping = function (text, language, dependency, clientId, publish, observe, reportProgress) {
    if (observe === void 0) {
      observe = 'body';
    }
    if (reportProgress === void 0) {
      reportProgress = false;
    }
    if (text === null || text === undefined) {
      throw new Error('Required parameter text was null or undefined when calling deleteLeetMapping.');
    }
    if (language === null || language === undefined) {
      throw new Error('Required parameter language was null or undefined when calling deleteLeetMapping.');
    }
    if (dependency === null || dependency === undefined) {
      throw new Error('Required parameter dependency was null or undefined when calling deleteLeetMapping.');
    }
    var queryParameters = new HttpParams({
      encoder: new CustomHttpUrlEncodingCodec()
    });
    if (language !== undefined && language !== null) {
      queryParameters = queryParameters.set('language', language);
    }
    if (clientId !== undefined && clientId !== null) {
      queryParameters = queryParameters.set('clientId', clientId);
    }
    if (publish !== undefined && publish !== null) {
      queryParameters = queryParameters.set('publish', publish);
    }
    var headers = this.defaultHeaders;
    // authentication (bearerAuth) required
    if (this.configuration.accessToken) {
      var accessToken = typeof this.configuration.accessToken === 'function' ?
        this.configuration.accessToken() :
        this.configuration.accessToken;
      headers = headers.set('Authorization', 'Bearer ' + accessToken);
    }
    // to determine the Accept header
    var httpHeaderAccepts = [
      'application/json'
    ];
    var httpHeaderAcceptSelected = this.configuration.selectHeaderAccept(httpHeaderAccepts);
    if (httpHeaderAcceptSelected != undefined) {
      headers = headers.set('Accept', httpHeaderAcceptSelected);
    }
    // to determine the Content-Type header
    var consumes = [];
    return this.httpClient.request('delete', this.basePath + "/rules/text/" + encodeURIComponent(String(text)) + "/leet_mappings/" + encodeURIComponent(String(dependency)), {
      params: queryParameters,
      withCredentials: this.configuration.withCredentials,
      headers: headers,
      observe: observe,
      reportProgress: reportProgress
    });
  };
  DefaultService.prototype.deleteRule = function (text, language, clientId, publish, observe, reportProgress) {
    if (observe === void 0) {
      observe = 'body';
    }
    if (reportProgress === void 0) {
      reportProgress = false;
    }
    if (text === null || text === undefined) {
      throw new Error('Required parameter text was null or undefined when calling deleteRule.');
    }
    if (language === null || language === undefined) {
      throw new Error('Required parameter language was null or undefined when calling deleteRule.');
    }
    var queryParameters = new HttpParams({
      encoder: new CustomHttpUrlEncodingCodec()
    });
    if (language !== undefined && language !== null) {
      queryParameters = queryParameters.set('language', language);
    }
    if (clientId !== undefined && clientId !== null) {
      queryParameters = queryParameters.set('clientId', clientId);
    }
    if (publish !== undefined && publish !== null) {
      queryParameters = queryParameters.set('publish', publish);
    }
    var headers = this.defaultHeaders;
    // authentication (bearerAuth) required
    if (this.configuration.accessToken) {
      var accessToken = typeof this.configuration.accessToken === 'function' ?
        this.configuration.accessToken() :
        this.configuration.accessToken;
      headers = headers.set('Authorization', 'Bearer ' + accessToken);
    }
    // to determine the Accept header
    var httpHeaderAccepts = [
      'application/json'
    ];
    var httpHeaderAcceptSelected = this.configuration.selectHeaderAccept(httpHeaderAccepts);
    if (httpHeaderAcceptSelected != undefined) {
      headers = headers.set('Accept', httpHeaderAcceptSelected);
    }
    // to determine the Content-Type header
    var consumes = [];
    return this.httpClient.request('delete', this.basePath + "/rules/text/" + encodeURIComponent(String(text)), {
      params: queryParameters,
      withCredentials: this.configuration.withCredentials,
      headers: headers,
      observe: observe,
      reportProgress: reportProgress
    });
  };
  DefaultService.prototype.deleteTopic = function (text, language, topicId, clientId, publish, observe, reportProgress) {
    if (observe === void 0) {
      observe = 'body';
    }
    if (reportProgress === void 0) {
      reportProgress = false;
    }
    if (text === null || text === undefined) {
      throw new Error('Required parameter text was null or undefined when calling deleteTopic.');
    }
    if (language === null || language === undefined) {
      throw new Error('Required parameter language was null or undefined when calling deleteTopic.');
    }
    if (topicId === null || topicId === undefined) {
      throw new Error('Required parameter topicId was null or undefined when calling deleteTopic.');
    }
    var queryParameters = new HttpParams({
      encoder: new CustomHttpUrlEncodingCodec()
    });
    if (language !== undefined && language !== null) {
      queryParameters = queryParameters.set('language', language);
    }
    if (clientId !== undefined && clientId !== null) {
      queryParameters = queryParameters.set('clientId', clientId);
    }
    if (publish !== undefined && publish !== null) {
      queryParameters = queryParameters.set('publish', publish);
    }
    var headers = this.defaultHeaders;
    // authentication (bearerAuth) required
    if (this.configuration.accessToken) {
      var accessToken = typeof this.configuration.accessToken === 'function' ?
        this.configuration.accessToken() :
        this.configuration.accessToken;
      headers = headers.set('Authorization', 'Bearer ' + accessToken);
    }
    // to determine the Accept header
    var httpHeaderAccepts = [
      'application/json'
    ];
    var httpHeaderAcceptSelected = this.configuration.selectHeaderAccept(httpHeaderAccepts);
    if (httpHeaderAcceptSelected != undefined) {
      headers = headers.set('Accept', httpHeaderAcceptSelected);
    }
    // to determine the Content-Type header
    var consumes = [];
    return this.httpClient.request('delete', this.basePath + "/rules/text/" + encodeURIComponent(String(text)) + "/topic/" + encodeURIComponent(String(topicId)), {
      params: queryParameters,
      withCredentials: this.configuration.withCredentials,
      headers: headers,
      observe: observe,
      reportProgress: reportProgress
    });
  };
  DefaultService.prototype.getAutocomplete = function (prefix, clientIds, languages, limit, observe, reportProgress) {
    if (observe === void 0) {
      observe = 'body';
    }
    if (reportProgress === void 0) {
      reportProgress = false;
    }
    if (prefix === null || prefix === undefined) {
      throw new Error('Required parameter prefix was null or undefined when calling getAutocomplete.');
    }
    var queryParameters = new HttpParams({
      encoder: new CustomHttpUrlEncodingCodec()
    });
    if (clientIds) {
      clientIds.forEach(function (element) {
        queryParameters = queryParameters.append('clientIds', element);
      });
    }
    if (languages) {
      languages.forEach(function (element) {
        queryParameters = queryParameters.append('languages', element);
      });
    }
    if (limit !== undefined && limit !== null) {
      queryParameters = queryParameters.set('limit', limit);
    }
    var headers = this.defaultHeaders;
    // authentication (bearerAuth) required
    if (this.configuration.accessToken) {
      var accessToken = typeof this.configuration.accessToken === 'function' ?
        this.configuration.accessToken() :
        this.configuration.accessToken;
      headers = headers.set('Authorization', 'Bearer ' + accessToken);
    }
    // to determine the Accept header
    var httpHeaderAccepts = [
      'application/json'
    ];
    var httpHeaderAcceptSelected = this.configuration.selectHeaderAccept(httpHeaderAccepts);
    if (httpHeaderAcceptSelected != undefined) {
      headers = headers.set('Accept', httpHeaderAcceptSelected);
    }
    // to determine the Content-Type header
    var consumes = [];
    return this.httpClient.request('get', this.basePath + "/rules/autocomplete/" + encodeURIComponent(String(prefix)), {
      params: queryParameters,
      withCredentials: this.configuration.withCredentials,
      headers: headers,
      observe: observe,
      reportProgress: reportProgress
    });
  };
  DefaultService.prototype.getComment = function (text, language, commentId, clientId, observe, reportProgress) {
    if (observe === void 0) {
      observe = 'body';
    }
    if (reportProgress === void 0) {
      reportProgress = false;
    }
    if (text === null || text === undefined) {
      throw new Error('Required parameter text was null or undefined when calling getComment.');
    }
    if (language === null || language === undefined) {
      throw new Error('Required parameter language was null or undefined when calling getComment.');
    }
    if (commentId === null || commentId === undefined) {
      throw new Error('Required parameter commentId was null or undefined when calling getComment.');
    }
    var queryParameters = new HttpParams({
      encoder: new CustomHttpUrlEncodingCodec()
    });
    if (language !== undefined && language !== null) {
      queryParameters = queryParameters.set('language', language);
    }
    if (clientId !== undefined && clientId !== null) {
      queryParameters = queryParameters.set('clientId', clientId);
    }
    var headers = this.defaultHeaders;
    // authentication (bearerAuth) required
    if (this.configuration.accessToken) {
      var accessToken = typeof this.configuration.accessToken === 'function' ?
        this.configuration.accessToken() :
        this.configuration.accessToken;
      headers = headers.set('Authorization', 'Bearer ' + accessToken);
    }
    // to determine the Accept header
    var httpHeaderAccepts = [
      'application/json'
    ];
    var httpHeaderAcceptSelected = this.configuration.selectHeaderAccept(httpHeaderAccepts);
    if (httpHeaderAcceptSelected != undefined) {
      headers = headers.set('Accept', httpHeaderAcceptSelected);
    }
    // to determine the Content-Type header
    var consumes = [];
    return this.httpClient.request('get', this.basePath + "/rules/text/" + encodeURIComponent(String(text)) + "/comments/" + encodeURIComponent(String(commentId)), {
      params: queryParameters,
      withCredentials: this.configuration.withCredentials,
      headers: headers,
      observe: observe,
      reportProgress: reportProgress
    });
  };
  DefaultService.prototype.getRule = function (text, language, clientId, observe, reportProgress) {
    if (observe === void 0) {
      observe = 'body';
    }
    if (reportProgress === void 0) {
      reportProgress = false;
    }
    if (text === null || text === undefined) {
      throw new Error('Required parameter text was null or undefined when calling getRule.');
    }
    if (language === null || language === undefined) {
      throw new Error('Required parameter language was null or undefined when calling getRule.');
    }
    var queryParameters = new HttpParams({
      encoder: new CustomHttpUrlEncodingCodec()
    });
    if (language !== undefined && language !== null) {
      queryParameters = queryParameters.set('language', language);
    }
    if (clientId !== undefined && clientId !== null) {
      queryParameters = queryParameters.set('clientId', clientId);
    }
    var headers = this.defaultHeaders;
    // authentication (bearerAuth) required
    if (this.configuration.accessToken) {
      var accessToken = typeof this.configuration.accessToken === 'function' ?
        this.configuration.accessToken() :
        this.configuration.accessToken;
      headers = headers.set('Authorization', 'Bearer ' + accessToken);
    }
    // to determine the Accept header
    var httpHeaderAccepts = [
      'application/json'
    ];
    var httpHeaderAcceptSelected = this.configuration.selectHeaderAccept(httpHeaderAccepts);
    if (httpHeaderAcceptSelected != undefined) {
      headers = headers.set('Accept', httpHeaderAcceptSelected);
    }
    // to determine the Content-Type header
    var consumes = [];
    return this.httpClient.request('get', this.basePath + "/rules/text/" + encodeURIComponent(String(text)), {
      params: queryParameters,
      withCredentials: this.configuration.withCredentials,
      headers: headers,
      observe: observe,
      reportProgress: reportProgress
    });
  };
  DefaultService.prototype.getRuleHistory = function (text, languages, clientIds, limit, offset, refresh, observe, reportProgress) {
    if (observe === void 0) {
      observe = 'body';
    }
    if (reportProgress === void 0) {
      reportProgress = false;
    }
    if (text === null || text === undefined) {
      throw new Error('Required parameter text was null or undefined when calling getRuleHistory.');
    }
    var queryParameters = new HttpParams({
      encoder: new CustomHttpUrlEncodingCodec()
    });
    if (languages) {
      languages.forEach(function (element) {
        queryParameters = queryParameters.append('languages', element);
      });
    }
    if (clientIds) {
      queryParameters = queryParameters.set('clientIds', clientIds.join(COLLECTION_FORMATS['csv']));
    }
    if (limit !== undefined && limit !== null) {
      queryParameters = queryParameters.set('limit', limit);
    }
    if (offset !== undefined && offset !== null) {
      queryParameters = queryParameters.set('offset', offset);
    }
    if (refresh !== undefined && refresh !== null) {
      queryParameters = queryParameters.set('refresh', refresh);
    }
    var headers = this.defaultHeaders;
    // authentication (bearerAuth) required
    if (this.configuration.accessToken) {
      var accessToken = typeof this.configuration.accessToken === 'function' ?
        this.configuration.accessToken() :
        this.configuration.accessToken;
      headers = headers.set('Authorization', 'Bearer ' + accessToken);
    }
    // to determine the Accept header
    var httpHeaderAccepts = [
      'application/json'
    ];
    var httpHeaderAcceptSelected = this.configuration.selectHeaderAccept(httpHeaderAccepts);
    if (httpHeaderAcceptSelected != undefined) {
      headers = headers.set('Accept', httpHeaderAcceptSelected);
    }
    // to determine the Content-Type header
    var consumes = [];
    return this.httpClient.request('get', this.basePath + "/rules/text/" + encodeURIComponent(String(text)) + "/changelog", {
      params: queryParameters,
      withCredentials: this.configuration.withCredentials,
      headers: headers,
      observe: observe,
      reportProgress: reportProgress
    });
  };
  DefaultService.prototype.getRules = function (ai, doneByModeratorId, clientIds, endDate, startDate, lastChangedStartDate, lastChangedEndDate, deleted, publishedStartDate, publishedEndDate, languages, limit, offset, altSense, altSpelling, leetMapping, taskId, tags, text, topics, unresolvedComments, observe, reportProgress) {
    if (observe === void 0) {
      observe = 'body';
    }
    if (reportProgress === void 0) {
      reportProgress = false;
    }
    var queryParameters = new HttpParams({
      encoder: new CustomHttpUrlEncodingCodec()
    });
    if (ai) {
      ai.forEach(function (element) {
        queryParameters = queryParameters.append('ai', element);
      });
    }
    if (doneByModeratorId !== undefined && doneByModeratorId !== null) {
      queryParameters = queryParameters.set('doneByModeratorId', doneByModeratorId);
    }
    if (clientIds) {
      clientIds.forEach(function (element) {
        queryParameters = queryParameters.append('clientIds', element);
      });
    }
    if (endDate !== undefined && endDate !== null) {
      queryParameters = queryParameters.set('endDate', endDate);
    }
    if (startDate !== undefined && startDate !== null) {
      queryParameters = queryParameters.set('startDate', startDate);
    }
    if (lastChangedStartDate !== undefined && lastChangedStartDate !== null) {
      queryParameters = queryParameters.set('lastChangedStartDate', lastChangedStartDate);
    }
    if (lastChangedEndDate !== undefined && lastChangedEndDate !== null) {
      queryParameters = queryParameters.set('lastChangedEndDate', lastChangedEndDate);
    }
    if (deleted !== undefined && deleted !== null) {
      queryParameters = queryParameters.set('deleted', deleted);
    }
    if (publishedStartDate !== undefined && publishedStartDate !== null) {
      queryParameters = queryParameters.set('publishedStartDate', publishedStartDate);
    }
    if (publishedEndDate !== undefined && publishedEndDate !== null) {
      queryParameters = queryParameters.set('publishedEndDate', publishedEndDate);
    }
    if (languages) {
      languages.forEach(function (element) {
        queryParameters = queryParameters.append('languages', element);
      });
    }
    if (limit !== undefined && limit !== null) {
      queryParameters = queryParameters.set('limit', limit);
    }
    if (offset !== undefined && offset !== null) {
      queryParameters = queryParameters.set('offset', offset);
    }
    if (altSense !== undefined && altSense !== null) {
      queryParameters = queryParameters.set('altSense', altSense);
    }
    if (altSpelling !== undefined && altSpelling !== null) {
      queryParameters = queryParameters.set('altSpelling', altSpelling);
    }
    if (leetMapping !== undefined && leetMapping !== null) {
      queryParameters = queryParameters.set('leetMapping', leetMapping);
    }
    if (taskId !== undefined && taskId !== null) {
      queryParameters = queryParameters.set('taskId', taskId);
    }
    if (tags) {
      queryParameters = queryParameters.set('tags', tags.join(COLLECTION_FORMATS['csv']));
    }
    if (text !== undefined && text !== null) {
      queryParameters = queryParameters.set('text', text);
    }
    if (topics) {
      topics.forEach(function (element) {
        queryParameters = queryParameters.append('topics', element);
      });
    }
    if (unresolvedComments !== undefined && unresolvedComments !== null) {
      queryParameters = queryParameters.set('unresolvedComments', unresolvedComments);
    }
    var headers = this.defaultHeaders;
    // authentication (bearerAuth) required
    if (this.configuration.accessToken) {
      var accessToken = typeof this.configuration.accessToken === 'function' ?
        this.configuration.accessToken() :
        this.configuration.accessToken;
      headers = headers.set('Authorization', 'Bearer ' + accessToken);
    }
    // to determine the Accept header
    var httpHeaderAccepts = [
      'application/json'
    ];
    var httpHeaderAcceptSelected = this.configuration.selectHeaderAccept(httpHeaderAccepts);
    if (httpHeaderAcceptSelected != undefined) {
      headers = headers.set('Accept', httpHeaderAcceptSelected);
    }
    // to determine the Content-Type header
    var consumes = [];
    return this.httpClient.request('get', this.basePath + "/rules", {
      params: queryParameters,
      withCredentials: this.configuration.withCredentials,
      headers: headers,
      observe: observe,
      reportProgress: reportProgress
    });
  };
  DefaultService.prototype.listComments = function (text, language, clientId, observe, reportProgress) {
    if (observe === void 0) {
      observe = 'body';
    }
    if (reportProgress === void 0) {
      reportProgress = false;
    }
    if (text === null || text === undefined) {
      throw new Error('Required parameter text was null or undefined when calling listComments.');
    }
    if (language === null || language === undefined) {
      throw new Error('Required parameter language was null or undefined when calling listComments.');
    }
    var queryParameters = new HttpParams({
      encoder: new CustomHttpUrlEncodingCodec()
    });
    if (language !== undefined && language !== null) {
      queryParameters = queryParameters.set('language', language);
    }
    if (clientId !== undefined && clientId !== null) {
      queryParameters = queryParameters.set('clientId', clientId);
    }
    var headers = this.defaultHeaders;
    // authentication (bearerAuth) required
    if (this.configuration.accessToken) {
      var accessToken = typeof this.configuration.accessToken === 'function' ?
        this.configuration.accessToken() :
        this.configuration.accessToken;
      headers = headers.set('Authorization', 'Bearer ' + accessToken);
    }
    // to determine the Accept header
    var httpHeaderAccepts = [
      'application/json'
    ];
    var httpHeaderAcceptSelected = this.configuration.selectHeaderAccept(httpHeaderAccepts);
    if (httpHeaderAcceptSelected != undefined) {
      headers = headers.set('Accept', httpHeaderAcceptSelected);
    }
    // to determine the Content-Type header
    var consumes = [];
    return this.httpClient.request('get', this.basePath + "/rules/text/" + encodeURIComponent(String(text)) + "/comments", {
      params: queryParameters,
      withCredentials: this.configuration.withCredentials,
      headers: headers,
      observe: observe,
      reportProgress: reportProgress
    });
  };
  DefaultService.prototype.resolveComment = function (language, text, commentId, body, clientId, observe, reportProgress) {
    if (observe === void 0) {
      observe = 'body';
    }
    if (reportProgress === void 0) {
      reportProgress = false;
    }
    if (language === null || language === undefined) {
      throw new Error('Required parameter language was null or undefined when calling resolveComment.');
    }
    if (text === null || text === undefined) {
      throw new Error('Required parameter text was null or undefined when calling resolveComment.');
    }
    if (commentId === null || commentId === undefined) {
      throw new Error('Required parameter commentId was null or undefined when calling resolveComment.');
    }
    var queryParameters = new HttpParams({
      encoder: new CustomHttpUrlEncodingCodec()
    });
    if (language !== undefined && language !== null) {
      queryParameters = queryParameters.set('language', language);
    }
    if (clientId !== undefined && clientId !== null) {
      queryParameters = queryParameters.set('clientId', clientId);
    }
    var headers = this.defaultHeaders;
    // authentication (bearerAuth) required
    if (this.configuration.accessToken) {
      var accessToken = typeof this.configuration.accessToken === 'function' ?
        this.configuration.accessToken() :
        this.configuration.accessToken;
      headers = headers.set('Authorization', 'Bearer ' + accessToken);
    }
    // to determine the Accept header
    var httpHeaderAccepts = [
      'application/json'
    ];
    var httpHeaderAcceptSelected = this.configuration.selectHeaderAccept(httpHeaderAccepts);
    if (httpHeaderAcceptSelected != undefined) {
      headers = headers.set('Accept', httpHeaderAcceptSelected);
    }
    // to determine the Content-Type header
    var consumes = [
      'application/json'
    ];
    var httpContentTypeSelected = this.configuration.selectHeaderContentType(consumes);
    if (httpContentTypeSelected != undefined) {
      headers = headers.set('Content-Type', httpContentTypeSelected);
    }
    return this.httpClient.request('put', this.basePath + "/rules/text/" + encodeURIComponent(String(text)) + "/comments/" + encodeURIComponent(String(commentId)) + "/resolved", {
      body: body,
      params: queryParameters,
      withCredentials: this.configuration.withCredentials,
      headers: headers,
      observe: observe,
      reportProgress: reportProgress
    });
  };
  DefaultService.prototype.testRules = function (body, examplesPerRule, clientIds, observe, reportProgress) {
    if (observe === void 0) {
      observe = 'body';
    }
    if (reportProgress === void 0) {
      reportProgress = false;
    }
    var queryParameters = new HttpParams({
      encoder: new CustomHttpUrlEncodingCodec()
    });
    if (examplesPerRule !== undefined && examplesPerRule !== null) {
      queryParameters = queryParameters.set('examplesPerRule', examplesPerRule);
    }
    if (clientIds) {
      clientIds.forEach(function (element) {
        queryParameters = queryParameters.append('clientIds', element);
      });
    }
    var headers = this.defaultHeaders;
    // authentication (bearerAuth) required
    if (this.configuration.accessToken) {
      var accessToken = typeof this.configuration.accessToken === 'function' ?
        this.configuration.accessToken() :
        this.configuration.accessToken;
      headers = headers.set('Authorization', 'Bearer ' + accessToken);
    }
    // to determine the Accept header
    var httpHeaderAccepts = [
      'application/json'
    ];
    var httpHeaderAcceptSelected = this.configuration.selectHeaderAccept(httpHeaderAccepts);
    if (httpHeaderAcceptSelected != undefined) {
      headers = headers.set('Accept', httpHeaderAcceptSelected);
    }
    // to determine the Content-Type header
    var consumes = [
      'application/json'
    ];
    var httpContentTypeSelected = this.configuration.selectHeaderContentType(consumes);
    if (httpContentTypeSelected != undefined) {
      headers = headers.set('Content-Type', httpContentTypeSelected);
    }
    return this.httpClient.request('put', this.basePath + "/rules/test", {
      body: body,
      params: queryParameters,
      withCredentials: this.configuration.withCredentials,
      headers: headers,
      observe: observe,
      reportProgress: reportProgress
    });
  };
  DefaultService.prototype.updateAlternateSense = function (text, language, dependency, clientId, publish, observe, reportProgress) {
    if (observe === void 0) {
      observe = 'body';
    }
    if (reportProgress === void 0) {
      reportProgress = false;
    }
    if (text === null || text === undefined) {
      throw new Error('Required parameter text was null or undefined when calling updateAlternateSense.');
    }
    if (language === null || language === undefined) {
      throw new Error('Required parameter language was null or undefined when calling updateAlternateSense.');
    }
    if (dependency === null || dependency === undefined) {
      throw new Error('Required parameter dependency was null or undefined when calling updateAlternateSense.');
    }
    var queryParameters = new HttpParams({
      encoder: new CustomHttpUrlEncodingCodec()
    });
    if (language !== undefined && language !== null) {
      queryParameters = queryParameters.set('language', language);
    }
    if (clientId !== undefined && clientId !== null) {
      queryParameters = queryParameters.set('clientId', clientId);
    }
    if (publish !== undefined && publish !== null) {
      queryParameters = queryParameters.set('publish', publish);
    }
    var headers = this.defaultHeaders;
    // authentication (bearerAuth) required
    if (this.configuration.accessToken) {
      var accessToken = typeof this.configuration.accessToken === 'function' ?
        this.configuration.accessToken() :
        this.configuration.accessToken;
      headers = headers.set('Authorization', 'Bearer ' + accessToken);
    }
    // to determine the Accept header
    var httpHeaderAccepts = [
      'application/json'
    ];
    var httpHeaderAcceptSelected = this.configuration.selectHeaderAccept(httpHeaderAccepts);
    if (httpHeaderAcceptSelected != undefined) {
      headers = headers.set('Accept', httpHeaderAcceptSelected);
    }
    // to determine the Content-Type header
    var consumes = [];
    return this.httpClient.request('put', this.basePath + "/rules/text/" + encodeURIComponent(String(text)) + "/alt_senses/" + encodeURIComponent(String(dependency)), {
      params: queryParameters,
      withCredentials: this.configuration.withCredentials,
      headers: headers,
      observe: observe,
      reportProgress: reportProgress
    });
  };
  DefaultService.prototype.updateAlternateSpelling = function (text, language, dependency, clientId, publish, observe, reportProgress) {
    if (observe === void 0) {
      observe = 'body';
    }
    if (reportProgress === void 0) {
      reportProgress = false;
    }
    if (text === null || text === undefined) {
      throw new Error('Required parameter text was null or undefined when calling updateAlternateSpelling.');
    }
    if (language === null || language === undefined) {
      throw new Error('Required parameter language was null or undefined when calling updateAlternateSpelling.');
    }
    if (dependency === null || dependency === undefined) {
      throw new Error('Required parameter dependency was null or undefined when calling updateAlternateSpelling.');
    }
    var queryParameters = new HttpParams({
      encoder: new CustomHttpUrlEncodingCodec()
    });
    if (language !== undefined && language !== null) {
      queryParameters = queryParameters.set('language', language);
    }
    if (clientId !== undefined && clientId !== null) {
      queryParameters = queryParameters.set('clientId', clientId);
    }
    if (publish !== undefined && publish !== null) {
      queryParameters = queryParameters.set('publish', publish);
    }
    var headers = this.defaultHeaders;
    // authentication (bearerAuth) required
    if (this.configuration.accessToken) {
      var accessToken = typeof this.configuration.accessToken === 'function' ?
        this.configuration.accessToken() :
        this.configuration.accessToken;
      headers = headers.set('Authorization', 'Bearer ' + accessToken);
    }
    // to determine the Accept header
    var httpHeaderAccepts = [
      'application/json'
    ];
    var httpHeaderAcceptSelected = this.configuration.selectHeaderAccept(httpHeaderAccepts);
    if (httpHeaderAcceptSelected != undefined) {
      headers = headers.set('Accept', httpHeaderAcceptSelected);
    }
    // to determine the Content-Type header
    var consumes = [];
    return this.httpClient.request('put', this.basePath + "/rules/text/" + encodeURIComponent(String(text)) + "/alt_spellings/" + encodeURIComponent(String(dependency)), {
      params: queryParameters,
      withCredentials: this.configuration.withCredentials,
      headers: headers,
      observe: observe,
      reportProgress: reportProgress
    });
  };
  DefaultService.prototype.updateComment = function (language, text, commentId, body, clientId, observe, reportProgress) {
    if (observe === void 0) {
      observe = 'body';
    }
    if (reportProgress === void 0) {
      reportProgress = false;
    }
    if (language === null || language === undefined) {
      throw new Error('Required parameter language was null or undefined when calling updateComment.');
    }
    if (text === null || text === undefined) {
      throw new Error('Required parameter text was null or undefined when calling updateComment.');
    }
    if (commentId === null || commentId === undefined) {
      throw new Error('Required parameter commentId was null or undefined when calling updateComment.');
    }
    var queryParameters = new HttpParams({
      encoder: new CustomHttpUrlEncodingCodec()
    });
    if (language !== undefined && language !== null) {
      queryParameters = queryParameters.set('language', language);
    }
    if (clientId !== undefined && clientId !== null) {
      queryParameters = queryParameters.set('clientId', clientId);
    }
    var headers = this.defaultHeaders;
    // authentication (bearerAuth) required
    if (this.configuration.accessToken) {
      var accessToken = typeof this.configuration.accessToken === 'function' ?
        this.configuration.accessToken() :
        this.configuration.accessToken;
      headers = headers.set('Authorization', 'Bearer ' + accessToken);
    }
    // to determine the Accept header
    var httpHeaderAccepts = [
      'application/json'
    ];
    var httpHeaderAcceptSelected = this.configuration.selectHeaderAccept(httpHeaderAccepts);
    if (httpHeaderAcceptSelected != undefined) {
      headers = headers.set('Accept', httpHeaderAcceptSelected);
    }
    // to determine the Content-Type header
    var consumes = [
      'application/json'
    ];
    var httpContentTypeSelected = this.configuration.selectHeaderContentType(consumes);
    if (httpContentTypeSelected != undefined) {
      headers = headers.set('Content-Type', httpContentTypeSelected);
    }
    return this.httpClient.request('put', this.basePath + "/rules/text/" + encodeURIComponent(String(text)) + "/comments/" + encodeURIComponent(String(commentId)), {
      body: body,
      params: queryParameters,
      withCredentials: this.configuration.withCredentials,
      headers: headers,
      observe: observe,
      reportProgress: reportProgress
    });
  };
  DefaultService.prototype.updateFlag = function (text, language, flag, clientId, publish, observe, reportProgress) {
    if (observe === void 0) {
      observe = 'body';
    }
    if (reportProgress === void 0) {
      reportProgress = false;
    }
    if (text === null || text === undefined) {
      throw new Error('Required parameter text was null or undefined when calling updateFlag.');
    }
    if (language === null || language === undefined) {
      throw new Error('Required parameter language was null or undefined when calling updateFlag.');
    }
    if (flag === null || flag === undefined) {
      throw new Error('Required parameter flag was null or undefined when calling updateFlag.');
    }
    var queryParameters = new HttpParams({
      encoder: new CustomHttpUrlEncodingCodec()
    });
    if (language !== undefined && language !== null) {
      queryParameters = queryParameters.set('language', language);
    }
    if (clientId !== undefined && clientId !== null) {
      queryParameters = queryParameters.set('clientId', clientId);
    }
    if (publish !== undefined && publish !== null) {
      queryParameters = queryParameters.set('publish', publish);
    }
    var headers = this.defaultHeaders;
    // authentication (bearerAuth) required
    if (this.configuration.accessToken) {
      var accessToken = typeof this.configuration.accessToken === 'function' ?
        this.configuration.accessToken() :
        this.configuration.accessToken;
      headers = headers.set('Authorization', 'Bearer ' + accessToken);
    }
    // to determine the Accept header
    var httpHeaderAccepts = [
      'application/json'
    ];
    var httpHeaderAcceptSelected = this.configuration.selectHeaderAccept(httpHeaderAccepts);
    if (httpHeaderAcceptSelected != undefined) {
      headers = headers.set('Accept', httpHeaderAcceptSelected);
    }
    // to determine the Content-Type header
    var consumes = [];
    return this.httpClient.request('put', this.basePath + "/rules/text/" + encodeURIComponent(String(text)) + "/flags/" + encodeURIComponent(String(flag)), {
      params: queryParameters,
      withCredentials: this.configuration.withCredentials,
      headers: headers,
      observe: observe,
      reportProgress: reportProgress
    });
  };
  DefaultService.prototype.updateLeetMapping = function (text, language, dependency, clientId, publish, observe, reportProgress) {
    if (observe === void 0) {
      observe = 'body';
    }
    if (reportProgress === void 0) {
      reportProgress = false;
    }
    if (text === null || text === undefined) {
      throw new Error('Required parameter text was null or undefined when calling updateLeetMapping.');
    }
    if (language === null || language === undefined) {
      throw new Error('Required parameter language was null or undefined when calling updateLeetMapping.');
    }
    if (dependency === null || dependency === undefined) {
      throw new Error('Required parameter dependency was null or undefined when calling updateLeetMapping.');
    }
    var queryParameters = new HttpParams({
      encoder: new CustomHttpUrlEncodingCodec()
    });
    if (language !== undefined && language !== null) {
      queryParameters = queryParameters.set('language', language);
    }
    if (clientId !== undefined && clientId !== null) {
      queryParameters = queryParameters.set('clientId', clientId);
    }
    if (publish !== undefined && publish !== null) {
      queryParameters = queryParameters.set('publish', publish);
    }
    var headers = this.defaultHeaders;
    // authentication (bearerAuth) required
    if (this.configuration.accessToken) {
      var accessToken = typeof this.configuration.accessToken === 'function' ?
        this.configuration.accessToken() :
        this.configuration.accessToken;
      headers = headers.set('Authorization', 'Bearer ' + accessToken);
    }
    // to determine the Accept header
    var httpHeaderAccepts = [
      'application/json'
    ];
    var httpHeaderAcceptSelected = this.configuration.selectHeaderAccept(httpHeaderAccepts);
    if (httpHeaderAcceptSelected != undefined) {
      headers = headers.set('Accept', httpHeaderAcceptSelected);
    }
    // to determine the Content-Type header
    var consumes = [];
    return this.httpClient.request('put', this.basePath + "/rules/text/" + encodeURIComponent(String(text)) + "/leet_mappings/" + encodeURIComponent(String(dependency)), {
      params: queryParameters,
      withCredentials: this.configuration.withCredentials,
      headers: headers,
      observe: observe,
      reportProgress: reportProgress
    });
  };
  DefaultService.prototype.updateRule = function (language, text, body, clientId, publish, observe, reportProgress) {
    if (observe === void 0) {
      observe = 'body';
    }
    if (reportProgress === void 0) {
      reportProgress = false;
    }
    if (language === null || language === undefined) {
      throw new Error('Required parameter language was null or undefined when calling updateRule.');
    }
    if (text === null || text === undefined) {
      throw new Error('Required parameter text was null or undefined when calling updateRule.');
    }
    var queryParameters = new HttpParams({
      encoder: new CustomHttpUrlEncodingCodec()
    });
    if (language !== undefined && language !== null) {
      queryParameters = queryParameters.set('language', language);
    }
    if (clientId !== undefined && clientId !== null) {
      queryParameters = queryParameters.set('clientId', clientId);
    }
    if (publish !== undefined && publish !== null) {
      queryParameters = queryParameters.set('publish', publish);
    }
    var headers = this.defaultHeaders;
    // authentication (bearerAuth) required
    if (this.configuration.accessToken) {
      var accessToken = typeof this.configuration.accessToken === 'function' ?
        this.configuration.accessToken() :
        this.configuration.accessToken;
      headers = headers.set('Authorization', 'Bearer ' + accessToken);
    }
    // to determine the Accept header
    var httpHeaderAccepts = [
      'application/json'
    ];
    var httpHeaderAcceptSelected = this.configuration.selectHeaderAccept(httpHeaderAccepts);
    if (httpHeaderAcceptSelected != undefined) {
      headers = headers.set('Accept', httpHeaderAcceptSelected);
    }
    // to determine the Content-Type header
    var consumes = [
      'application/json'
    ];
    var httpContentTypeSelected = this.configuration.selectHeaderContentType(consumes);
    if (httpContentTypeSelected != undefined) {
      headers = headers.set('Content-Type', httpContentTypeSelected);
    }
    return this.httpClient.request('put', this.basePath + "/rules/text/" + encodeURIComponent(String(text)), {
      body: body,
      params: queryParameters,
      withCredentials: this.configuration.withCredentials,
      headers: headers,
      observe: observe,
      reportProgress: reportProgress
    });
  };
  DefaultService.prototype.updateRules = function (body, publish, observe, reportProgress) {
    if (observe === void 0) {
      observe = 'body';
    }
    if (reportProgress === void 0) {
      reportProgress = false;
    }
    var queryParameters = new HttpParams({
      encoder: new CustomHttpUrlEncodingCodec()
    });
    if (publish !== undefined && publish !== null) {
      queryParameters = queryParameters.set('publish', publish);
    }
    var headers = this.defaultHeaders;
    // authentication (bearerAuth) required
    if (this.configuration.accessToken) {
      var accessToken = typeof this.configuration.accessToken === 'function' ?
        this.configuration.accessToken() :
        this.configuration.accessToken;
      headers = headers.set('Authorization', 'Bearer ' + accessToken);
    }
    // to determine the Accept header
    var httpHeaderAccepts = [
      'application/json'
    ];
    var httpHeaderAcceptSelected = this.configuration.selectHeaderAccept(httpHeaderAccepts);
    if (httpHeaderAcceptSelected != undefined) {
      headers = headers.set('Accept', httpHeaderAcceptSelected);
    }
    // to determine the Content-Type header
    var consumes = [
      'application/json'
    ];
    var httpContentTypeSelected = this.configuration.selectHeaderContentType(consumes);
    if (httpContentTypeSelected != undefined) {
      headers = headers.set('Content-Type', httpContentTypeSelected);
    }
    return this.httpClient.request('put', this.basePath + "/rules", {
      body: body,
      params: queryParameters,
      withCredentials: this.configuration.withCredentials,
      headers: headers,
      observe: observe,
      reportProgress: reportProgress
    });
  };
  DefaultService.prototype.updateTopic = function (language, text, topicId, body, clientId, publish, observe, reportProgress) {
    if (observe === void 0) {
      observe = 'body';
    }
    if (reportProgress === void 0) {
      reportProgress = false;
    }
    if (language === null || language === undefined) {
      throw new Error('Required parameter language was null or undefined when calling updateTopic.');
    }
    if (text === null || text === undefined) {
      throw new Error('Required parameter text was null or undefined when calling updateTopic.');
    }
    if (topicId === null || topicId === undefined) {
      throw new Error('Required parameter topicId was null or undefined when calling updateTopic.');
    }
    var queryParameters = new HttpParams({
      encoder: new CustomHttpUrlEncodingCodec()
    });
    if (language !== undefined && language !== null) {
      queryParameters = queryParameters.set('language', language);
    }
    if (clientId !== undefined && clientId !== null) {
      queryParameters = queryParameters.set('clientId', clientId);
    }
    if (publish !== undefined && publish !== null) {
      queryParameters = queryParameters.set('publish', publish);
    }
    var headers = this.defaultHeaders;
    // authentication (bearerAuth) required
    if (this.configuration.accessToken) {
      var accessToken = typeof this.configuration.accessToken === 'function' ?
        this.configuration.accessToken() :
        this.configuration.accessToken;
      headers = headers.set('Authorization', 'Bearer ' + accessToken);
    }
    // to determine the Accept header
    var httpHeaderAccepts = [
      'application/json'
    ];
    var httpHeaderAcceptSelected = this.configuration.selectHeaderAccept(httpHeaderAccepts);
    if (httpHeaderAcceptSelected != undefined) {
      headers = headers.set('Accept', httpHeaderAcceptSelected);
    }
    // to determine the Content-Type header
    var consumes = [
      'application/json'
    ];
    var httpContentTypeSelected = this.configuration.selectHeaderContentType(consumes);
    if (httpContentTypeSelected != undefined) {
      headers = headers.set('Content-Type', httpContentTypeSelected);
    }
    return this.httpClient.request('put', this.basePath + "/rules/text/" + encodeURIComponent(String(text)) + "/topic/" + encodeURIComponent(String(topicId)), {
      body: body,
      params: queryParameters,
      withCredentials: this.configuration.withCredentials,
      headers: headers,
      observe: observe,
      reportProgress: reportProgress
    });
  };
  DefaultService.fac = function DefaultService_Factory(t) {
    return new(t || DefaultService)(i0.inject(i1.HttpClient), i0.inject(BASE_PATH, 8), i0.inject(i2.Configuration, 8));
  };
  DefaultService.prov = i0.defineInjectable({
    token: DefaultService,
    factory: DefaultService.fac
  });
  return DefaultService;
}());
export {
  DefaultService
};
/*@__PURE__*/
(function () {
  i0.setClassMetadata(DefaultService, [{
    type: Injectable
  }], function () {
    return [{
      type: i1.HttpClient
    }, {
      type: undefined,
      decorators: [{
        type: Optional
      }, {
        type: Inject,
        args: [BASE_PATH]
      }]
    }, {
      type: i2.Configuration,
      decorators: [{
        type: Optional
      }]
    }];
  }, null);
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGVmYXVsdC5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vcnVsZXMtc3dhZ2dlci1jbGllbnQvIiwic291cmNlcyI6WyJhcGkvZGVmYXVsdC5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7Ozs7OztHQVVHLENBQUEsdURBQXVEO0FBRTFELE9BQU8sRUFBRSxNQUFNLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxNQUEyQixlQUFlLENBQUM7QUFDbEYsT0FBTyxFQUFjLFdBQVcsRUFBRSxVQUFVLEVBQ1YsTUFBZ0Msc0JBQXNCLENBQUM7QUFDekYsT0FBTyxFQUFFLDBCQUEwQixFQUFFLE1BQTZCLFlBQVksQ0FBQztBQW9CL0UsT0FBTyxFQUFFLFNBQVMsRUFBRSxrQkFBa0IsRUFBRSxNQUEwQixjQUFjLENBQUM7QUFDakYsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUEwQyxrQkFBa0IsQ0FBQzs7OztBQUdyRjtJQU9JLHdCQUFzQixVQUFzQixFQUFnQyxRQUFnQixFQUFjLGFBQTRCO1FBQWhILGVBQVUsR0FBVixVQUFVLENBQVk7UUFKbEMsYUFBUSxHQUFHLHNEQUFzRCxDQUFDO1FBQ3JFLG1CQUFjLEdBQUcsSUFBSSxXQUFXLEVBQUUsQ0FBQztRQUNuQyxrQkFBYSxHQUFHLElBQUksYUFBYSxFQUFFLENBQUM7UUFHdkMsSUFBSSxRQUFRLEVBQUU7WUFDVixJQUFJLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQztTQUM1QjtRQUNELElBQUksYUFBYSxFQUFFO1lBQ2YsSUFBSSxDQUFDLGFBQWEsR0FBRyxhQUFhLENBQUM7WUFDbkMsSUFBSSxDQUFDLFFBQVEsR0FBRyxRQUFRLElBQUksYUFBYSxDQUFDLFFBQVEsSUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDO1NBQ3ZFO0lBQ0wsQ0FBQztJQUVEOzs7T0FHRztJQUNLLHVDQUFjLEdBQXRCLFVBQXVCLFFBQWtCOztRQUNyQyxJQUFNLElBQUksR0FBRyxxQkFBcUIsQ0FBQzs7WUFD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QUFJLFNBQVMsRUFBRTtZQUN0QyxPQUFPLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxjQUFjLEVBQUUsdUJBQXVCLENBQUMsQ0FBQztTQUNsRTtRQUVELE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQU8sS0FBSyxFQUFJLElBQUksQ0FBQyxRQUFRLG9CQUFlLGtCQUFrQixDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxlQUFVLGtCQUFrQixDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBRyxFQUNySjtZQUNJLElBQUksRUFBRSxJQUFJO1lBQ1YsTUFBTSxFQUFFLGVBQWU7WUFDdkIsZUFBZSxFQUFFLElBQUksQ0FBQyxhQUFhLENBQUMsZUFBZTtZQUNuRCxPQUFPLEVBQUUsT0FBTztZQUNoQixPQUFPLEVBQUUsT0FBTztZQUNoQixjQUFjLEVBQUUsY0FBYztTQUNqQyxDQUNKLENBQUM7SUFDTixDQUFDO2dGQXZ6RFEsY0FBYywwQ0FNMEMsU0FBUzswREFOakUsY0FBYyxXQUFkLGNBQWM7eUJBeEMzQjtDQWkyREMsQUExekRELElBMHpEQztTQXp6RFksY0FBYztrREFBZCxjQUFjO2NBRDFCLFVBQVU7O3NCQU93QyxRQUFROztzQkFBRyxNQUFNO3VCQUFDLFNBQVM7O3NCQUFxQixRQUFRIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBSdWxlc1xuICogVGhlIGZpbHRlciB3b3JrcyBhcyBhIHNlcmllcyBvZiBydWxlcyBzbyB0aGF0IGVhY2ggd29yZCBjYW4gYmUgbWFwcGVkIHRvIGEgcnVsZS4gIFNvIFxcXCJIYXBweVxcXCIgY2FuIGJlY29tZSBcXFwiaGFwcHlcXFwiIGFuZCBcXFwiYjRkXFxcIiBhbmQgYmVjb21lIFxcXCJiYWRcXFwiLiAgICBXaXRoIHRoaXMgQVBJIHlvdSBjYW4gbWFuYWdlIHlvdXIgcnVsZXMuIFxuICpcbiAqIE9wZW5BUEkgc3BlYyB2ZXJzaW9uOiAyLjAuM1xuICogQ29udGFjdDogc3VwcG9ydEB0d29oYXQuY29tXG4gKlxuICogTk9URTogVGhpcyBjbGFzcyBpcyBhdXRvIGdlbmVyYXRlZCBieSB0aGUgc3dhZ2dlciBjb2RlIGdlbmVyYXRvciBwcm9ncmFtLlxuICogaHR0cHM6Ly9naXRodWIuY29tL3N3YWdnZXItYXBpL3N3YWdnZXItY29kZWdlbi5naXRcbiAqIERvIG5vdCBlZGl0IHRoZSBjbGFzcyBtYW51YWxseS5cbiAqLy8qIHRzbGludDpkaXNhYmxlOm5vLXVudXNlZC12YXJpYWJsZSBtZW1iZXItb3JkZXJpbmcgKi9cblxuaW1wb3J0IHsgSW5qZWN0LCBJbmplY3RhYmxlLCBPcHRpb25hbCB9ICAgICAgICAgICAgICAgICAgICAgIGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgSHR0cENsaWVudCwgSHR0cEhlYWRlcnMsIEh0dHBQYXJhbXMsXG4gICAgICAgICBIdHRwUmVzcG9uc2UsIEh0dHBFdmVudCB9ICAgICAgICAgICAgICAgICAgICAgICAgICAgZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuaW1wb3J0IHsgQ3VzdG9tSHR0cFVybEVuY29kaW5nQ29kZWMgfSAgICAgICAgICAgICAgICAgICAgICAgIGZyb20gJy4uL2VuY29kZXInO1xuXG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnJvbSAncnhqcyc7XG5cbmltcG9ydCB7IEFpIH0gZnJvbSAnLi4vbW9kZWwvYWknO1xuaW1wb3J0IHsgQm9keSB9IGZyb20gJy4uL21vZGVsL2JvZHknO1xuaW1wb3J0IHsgQ2hhbmdlTG9nIH0gZnJvbSAnLi4vbW9kZWwvY2hhbmdlTG9nJztcbmltcG9ydCB7IENsaWVudElkIH0gZnJvbSAnLi4vbW9kZWwvY2xpZW50SWQnO1xuaW1wb3J0IHsgQ29tbWVudCB9IGZyb20gJy4uL21vZGVsL2NvbW1lbnQnO1xuaW1wb3J0IHsgQ29tbWVudElucHV0IH0gZnJvbSAnLi4vbW9kZWwvY29tbWVudElucHV0JztcbmltcG9ydCB7IEV4YW1wbGVEaWZmIH0gZnJvbSAnLi4vbW9kZWwvZXhhbXBsZURpZmYnO1xuaW1wb3J0IHsgRmxhZyB9IGZyb20gJy4uL21vZGVsL2ZsYWcnO1xuaW1wb3J0IHsgSW5saW5lUmVzcG9uc2UyMDAgfSBmcm9tICcuLi9tb2RlbC9pbmxpbmVSZXNwb25zZTIwMCc7XG5pbXBvcnQgeyBNb2RlcmF0b3JJZCB9IGZyb20gJy4uL21vZGVsL21vZGVyYXRvcklkJztcbmltcG9ydCB7IFJ1bGUgfSBmcm9tICcuLi9tb2RlbC9ydWxlJztcbmltcG9ydCB7IFJ1bGVUZXh0IH0gZnJvbSAnLi4vbW9kZWwvcnVsZVRleHQnO1xuaW1wb3J0IHsgVGltZXN0YW1wIH0gZnJvbSAnLi4vbW9kZWwvdGltZXN0YW1wJztcbmltcG9ydCB7IFRvcGljcyB9IGZyb20gJy4uL21vZGVsL3RvcGljcyc7XG5pbXBvcnQgeyBVcGRhdGVUb3BpYyB9IGZyb20gJy4uL21vZGVsL3VwZGF0ZVRvcGljJztcblxuaW1wb3J0IHsgQkFTRV9QQVRILCBDT0xMRUNUSU9OX0ZPUk1BVFMgfSAgICAgICAgICAgICAgICAgICAgIGZyb20gJy4uL3ZhcmlhYmxlcyc7XG5pbXBvcnQgeyBDb25maWd1cmF0aW9uIH0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnJvbSAnLi4vY29uZmlndXJhdGlvbic7XG5cblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIERlZmF1bHRTZXJ2aWNlIHtcblxuICAgIHByb3RlY3RlZCBiYXNlUGF0aCA9ICdodHRwczovL3ZpcnRzZXJ2ZXIuc3dhZ2dlcmh1Yi5jb20vdHdvaGF0L3J1bGVzLzIuMC4zJztcbiAgICBwdWJsaWMgZGVmYXVsdEhlYWRlcnMgPSBuZXcgSHR0cEhlYWRlcnMoKTtcbiAgICBwdWJsaWMgY29uZmlndXJhdGlvbiA9IG5ldyBDb25maWd1cmF0aW9uKCk7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcm90ZWN0ZWQgaHR0cENsaWVudDogSHR0cENsaWVudCwgQE9wdGlvbmFsKClASW5qZWN0KEJBU0VfUEFUSCkgYmFzZVBhdGg6IHN0cmluZywgQE9wdGlvbmFsKCkgY29uZmlndXJhdGlvbjogQ29uZmlndXJhdGlvbikge1xuICAgICAgICBpZiAoYmFzZVBhdGgpIHtcbiAgICAgICAgICAgIHRoaXMuYmFzZVBhdGggPSBiYXNlUGF0aDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29uZmlndXJhdGlvbikge1xuICAgICAgICAgICAgdGhpcy5jb25maWd1cmF0aW9uID0gY29uZmlndXJhdGlvbjtcbiAgICAgICAgICAgIHRoaXMuYmFzZVBhdGggPSBiYXNlUGF0aCB8fCBjb25maWd1cmF0aW9uLmJhc2VQYXRoIHx8IHRoaXMuYmFzZVBhdGg7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0gY29uc3VtZXMgc3RyaW5nW10gbWltZS10eXBlc1xuICAgICAqIEByZXR1cm4gdHJ1ZTogY29uc3VtZXMgY29udGFpbnMgJ211bHRpcGFydC9mb3JtLWRhdGEnLCBmYWxzZTogb3RoZXJ3aXNlXG4gICAgICovXG4gICAgcHJpdmF0ZSBjYW5Db25zdW1lRm9ybShjb25zdW1lczogc3RyaW5nW10pOiBib29sZWFuIHtcbiAgICAgICAgY29uc3QgZm9ybSA9ICdtdWx0aXBhcnQvZm9ybS1kYXRhJztcbiAgICAgICAgZm9yIChjb25zdCBjb25zdW1lIG9mIGNvbnN1bWVzKSB7XG4gICAgICAgICAgICBpZiAoZm9ybSA9PT0gY29uc3VtZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cblxuICAgIC8qKlxuICAgICAqIEFkZCBhIGNvbW1lbnQgdG8gdGhpcyBydWxlXG4gICAgICogQ29tbWVudHMgYXJlIHdheXMgdG8gbGVhdmUgYSBub3RlIHRvIHNheSB3aHkgYSBwZXJzb24gbWFkZSB0aGUgZGVjaXNpb24gdGhleSBkaWQuICBPciBpdCBjb3VsZCBiZSBhIHF1ZXN0aW9uIG9yIGFuc3dlciB0cnlpbmcgdG8gZ2V0IGhlbHAgb24gYW4gaXRlbS4gXG4gICAgICogQHBhcmFtIGxhbmd1YWdlIFNob3cgcmVzdWx0cyBmb3IgdGhlIGdpdmVuIGxhbmd1YWdlIG9ubHkuICAgVGhpcyBpcyB0aGUgbGFuZ3VhZ2UgdXNlZCwgY291bGQgaGF2ZSBiZWVuIHNldCBieSB0aGUgdXNlciBvciBkZXRlY3RlZCBieSBsYW5ndWFnZSBpZC5cbiAgICAgKiBAcGFyYW0gdGV4dCBUaGUgdGV4dCBvZiB0aGUgcnVsZSB5b3Ugd2FudCB0byB3b3JrIG9uXG4gICAgICogQHBhcmFtIGJvZHkgXG4gICAgICogQHBhcmFtIGNsaWVudElkIFNob3cgcmVzdWx0cyBmb3IgYSBnaXZlbiBjbGllbnQuICBUeXBpY2FsbHkgdGhpcyBpcyBzZXQgZm9yIHlvdSBieSB0aGUgaW50ZXJuYWwgc3lzdGVtIGJhc2VkIG9uIHRoZSBBUElfS0VZIHlvdSBhcmUgdXNpbmcuICBIb3dldmVyIHNvbWUgY2xpZW50cyBhcmUgYWxsb3dlZCB0byB2aWV3IG90aGVyIGNsaWVudHMgc3VjaCBhcyB3aGVuIHRoZXkgaGF2ZSBhIHNhbmRib3ggb3Igd2hlbiB0aGV5IGFyZSBhIGxhcmdlIGVudGVycHJpc2UgYW5kIGhhdmUgbXVsdGlwbGUgY2xpZW50cyB0aGV5IG1hbmFnZS4gIEl0IHdpbGwgb25seSBhbGxvdyB5b3UgdG8gdmlldyBjbGllbnQgZGF0YSB5b3UgaGF2ZSBhY2Nlc3MgdG8uXG4gICAgICogQHBhcmFtIG9ic2VydmUgc2V0IHdoZXRoZXIgb3Igbm90IHRvIHJldHVybiB0aGUgZGF0YSBPYnNlcnZhYmxlIGFzIHRoZSBib2R5LCByZXNwb25zZSBvciBldmVudHMuIGRlZmF1bHRzIHRvIHJldHVybmluZyB0aGUgYm9keS5cbiAgICAgKiBAcGFyYW0gcmVwb3J0UHJvZ3Jlc3MgZmxhZyB0byByZXBvcnQgcmVxdWVzdCBhbmQgcmVzcG9uc2UgcHJvZ3Jlc3MuXG4gICAgICovXG4gICAgcHVibGljIGFkZENvbW1lbnQobGFuZ3VhZ2U6IHN0cmluZywgdGV4dDogc3RyaW5nLCBib2R5PzogQ29tbWVudElucHV0LCBjbGllbnRJZD86IG51bWJlciwgb2JzZXJ2ZT86ICdib2R5JywgcmVwb3J0UHJvZ3Jlc3M/OiBib29sZWFuKTogT2JzZXJ2YWJsZTxDb21tZW50PjtcbiAgICBwdWJsaWMgYWRkQ29tbWVudChsYW5ndWFnZTogc3RyaW5nLCB0ZXh0OiBzdHJpbmcsIGJvZHk/OiBDb21tZW50SW5wdXQsIGNsaWVudElkPzogbnVtYmVyLCBvYnNlcnZlPzogJ3Jlc3BvbnNlJywgcmVwb3J0UHJvZ3Jlc3M/OiBib29sZWFuKTogT2JzZXJ2YWJsZTxIdHRwUmVzcG9uc2U8Q29tbWVudD4+O1xuICAgIHB1YmxpYyBhZGRDb21tZW50KGxhbmd1YWdlOiBzdHJpbmcsIHRleHQ6IHN0cmluZywgYm9keT86IENvbW1lbnRJbnB1dCwgY2xpZW50SWQ/OiBudW1iZXIsIG9ic2VydmU/OiAnZXZlbnRzJywgcmVwb3J0UHJvZ3Jlc3M/OiBib29sZWFuKTogT2JzZXJ2YWJsZTxIdHRwRXZlbnQ8Q29tbWVudD4+O1xuICAgIHB1YmxpYyBhZGRDb21tZW50KGxhbmd1YWdlOiBzdHJpbmcsIHRleHQ6IHN0cmluZywgYm9keT86IENvbW1lbnRJbnB1dCwgY2xpZW50SWQ/OiBudW1iZXIsIG9ic2VydmU6IGFueSA9ICdib2R5JywgcmVwb3J0UHJvZ3Jlc3M6IGJvb2xlYW4gPSBmYWxzZSApOiBPYnNlcnZhYmxlPGFueT4ge1xuXG4gICAgICAgIGlmIChsYW5ndWFnZSA9PT0gbnVsbCB8fCBsYW5ndWFnZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1JlcXVpcmVkIHBhcmFtZXRlciBsYW5ndWFnZSB3YXMgbnVsbCBvciB1bmRlZmluZWQgd2hlbiBjYWxsaW5nIGFkZENvbW1lbnQuJyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGV4dCA9PT0gbnVsbCB8fCB0ZXh0ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignUmVxdWlyZWQgcGFyYW1ldGVyIHRleHQgd2FzIG51bGwgb3IgdW5kZWZpbmVkIHdoZW4gY2FsbGluZyBhZGRDb21tZW50LicpO1xuICAgICAgICB9XG5cblxuXG4gICAgICAgIGxldCBxdWVyeVBhcmFtZXRlcnMgPSBuZXcgSHR0cFBhcmFtcyh7ZW5jb2RlcjogbmV3IEN1c3RvbUh0dHBVcmxFbmNvZGluZ0NvZGVjKCl9KTtcbiAgICAgICAgaWYgKGxhbmd1YWdlICE9PSB1bmRlZmluZWQgJiYgbGFuZ3VhZ2UgIT09IG51bGwpIHtcbiAgICAgICAgICAgIHF1ZXJ5UGFyYW1ldGVycyA9IHF1ZXJ5UGFyYW1ldGVycy5zZXQoJ2xhbmd1YWdlJywgPGFueT5sYW5ndWFnZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNsaWVudElkICE9PSB1bmRlZmluZWQgJiYgY2xpZW50SWQgIT09IG51bGwpIHtcbiAgICAgICAgICAgIHF1ZXJ5UGFyYW1ldGVycyA9IHF1ZXJ5UGFyYW1ldGVycy5zZXQoJ2NsaWVudElkJywgPGFueT5jbGllbnRJZCk7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgaGVhZGVycyA9IHRoaXMuZGVmYXVsdEhlYWRlcnM7XG5cbiAgICAgICAgLy8gYXV0aGVudGljYXRpb24gKGJlYXJlckF1dGgpIHJlcXVpcmVkXG4gICAgICAgIGlmICh0aGlzLmNvbmZpZ3VyYXRpb24uYWNjZXNzVG9rZW4pIHtcbiAgICAgICAgICAgIGNvbnN0IGFjY2Vzc1Rva2VuID0gdHlwZW9mIHRoaXMuY29uZmlndXJhdGlvbi5hY2Nlc3NUb2tlbiA9PT0gJ2Z1bmN0aW9uJ1xuICAgICAgICAgICAgICAgID8gdGhpcy5jb25maWd1cmF0aW9uLmFjY2Vzc1Rva2VuKClcbiAgICAgICAgICAgICAgICA6IHRoaXMuY29uZmlndXJhdGlvbi5hY2Nlc3NUb2tlbjtcbiAgICAgICAgICAgIGhlYWRlcnMgPSBoZWFkZXJzLnNldCgnQXV0aG9yaXphdGlvbicsICdCZWFyZXIgJyArIGFjY2Vzc1Rva2VuKTtcbiAgICAgICAgfVxuICAgICAgICAvLyB0byBkZXRlcm1pbmUgdGhlIEFjY2VwdCBoZWFkZXJcbiAgICAgICAgbGV0IGh0dHBIZWFkZXJBY2NlcHRzOiBzdHJpbmdbXSA9IFtcbiAgICAgICAgICAgICdhcHBsaWNhdGlvbi9qc29uJ1xuICAgICAgICBdO1xuICAgICAgICBjb25zdCBodHRwSGVhZGVyQWNjZXB0U2VsZWN0ZWQ6IHN0cmluZyB8IHVuZGVmaW5lZCA9IHRoaXMuY29uZmlndXJhdGlvbi5zZWxlY3RIZWFkZXJBY2NlcHQoaHR0cEhlYWRlckFjY2VwdHMpO1xuICAgICAgICBpZiAoaHR0cEhlYWRlckFjY2VwdFNlbGVjdGVkICE9IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgaGVhZGVycyA9IGhlYWRlcnMuc2V0KCdBY2NlcHQnLCBodHRwSGVhZGVyQWNjZXB0U2VsZWN0ZWQpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gdG8gZGV0ZXJtaW5lIHRoZSBDb250ZW50LVR5cGUgaGVhZGVyXG4gICAgICAgIGNvbnN0IGNvbnN1bWVzOiBzdHJpbmdbXSA9IFtcbiAgICAgICAgICAgICdhcHBsaWNhdGlvbi9qc29uJ1xuICAgICAgICBdO1xuICAgICAgICBjb25zdCBodHRwQ29udGVudFR5cGVTZWxlY3RlZDogc3RyaW5nIHwgdW5kZWZpbmVkID0gdGhpcy5jb25maWd1cmF0aW9uLnNlbGVjdEhlYWRlckNvbnRlbnRUeXBlKGNvbnN1bWVzKTtcbiAgICAgICAgaWYgKGh0dHBDb250ZW50VHlwZVNlbGVjdGVkICE9IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgaGVhZGVycyA9IGhlYWRlcnMuc2V0KCdDb250ZW50LVR5cGUnLCBodHRwQ29udGVudFR5cGVTZWxlY3RlZCk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcy5odHRwQ2xpZW50LnJlcXVlc3Q8Q29tbWVudD4oJ3Bvc3QnLGAke3RoaXMuYmFzZVBhdGh9L3J1bGVzL3RleHQvJHtlbmNvZGVVUklDb21wb25lbnQoU3RyaW5nKHRleHQpKX0vY29tbWVudHNgLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGJvZHk6IGJvZHksXG4gICAgICAgICAgICAgICAgcGFyYW1zOiBxdWVyeVBhcmFtZXRlcnMsXG4gICAgICAgICAgICAgICAgd2l0aENyZWRlbnRpYWxzOiB0aGlzLmNvbmZpZ3VyYXRpb24ud2l0aENyZWRlbnRpYWxzLFxuICAgICAgICAgICAgICAgIGhlYWRlcnM6IGhlYWRlcnMsXG4gICAgICAgICAgICAgICAgb2JzZXJ2ZTogb2JzZXJ2ZSxcbiAgICAgICAgICAgICAgICByZXBvcnRQcm9ncmVzczogcmVwb3J0UHJvZ3Jlc3NcbiAgICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBEZWxldGUgYW4gYWx0ZXJuYXRlIHNlbnNlIGZvciBhIHJ1bGVcbiAgICAgKiBUaGlzIHdpbGwgZGVsZXRlIGFuIGFsdGVybmF0ZSBzZW5zZSBmb3IgcnVsZSBhbmQgbG9nIHRoZSBjaGFuZ2VcbiAgICAgKiBAcGFyYW0gdGV4dCBUaGUgdGV4dCBvZiB0aGUgcnVsZSB5b3Ugd2FudCB0byB3b3JrIG9uXG4gICAgICogQHBhcmFtIGxhbmd1YWdlIFNob3cgcmVzdWx0cyBmb3IgdGhlIGdpdmVuIGxhbmd1YWdlIG9ubHkuICAgVGhpcyBpcyB0aGUgbGFuZ3VhZ2UgdXNlZCwgY291bGQgaGF2ZSBiZWVuIHNldCBieSB0aGUgdXNlciBvciBkZXRlY3RlZCBieSBsYW5ndWFnZSBpZC5cbiAgICAgKiBAcGFyYW0gZGVwZW5kZW5jeSBUaGlzIGlzIHRoZSByZWxhdGVkIHRleHQgeW91IHdhbnQgdG8gd29yayBvbi5cbiAgICAgKiBAcGFyYW0gY2xpZW50SWQgU2hvdyByZXN1bHRzIGZvciBhIGdpdmVuIGNsaWVudC4gIFR5cGljYWxseSB0aGlzIGlzIHNldCBmb3IgeW91IGJ5IHRoZSBpbnRlcm5hbCBzeXN0ZW0gYmFzZWQgb24gdGhlIEFQSV9LRVkgeW91IGFyZSB1c2luZy4gIEhvd2V2ZXIgc29tZSBjbGllbnRzIGFyZSBhbGxvd2VkIHRvIHZpZXcgb3RoZXIgY2xpZW50cyBzdWNoIGFzIHdoZW4gdGhleSBoYXZlIGEgc2FuZGJveCBvciB3aGVuIHRoZXkgYXJlIGEgbGFyZ2UgZW50ZXJwcmlzZSBhbmQgaGF2ZSBtdWx0aXBsZSBjbGllbnRzIHRoZXkgbWFuYWdlLiAgSXQgd2lsbCBvbmx5IGFsbG93IHlvdSB0byB2aWV3IGNsaWVudCBkYXRhIHlvdSBoYXZlIGFjY2VzcyB0by5cbiAgICAgKiBAcGFyYW0gcHVibGlzaCBUaGlzIHdpbGwgYWxzbyBtYWtlIHRoZSBydWxlIGxpdmVcbiAgICAgKiBAcGFyYW0gb2JzZXJ2ZSBzZXQgd2hldGhlciBvciBub3QgdG8gcmV0dXJuIHRoZSBkYXRhIE9ic2VydmFibGUgYXMgdGhlIGJvZHksIHJlc3BvbnNlIG9yIGV2ZW50cy4gZGVmYXVsdHMgdG8gcmV0dXJuaW5nIHRoZSBib2R5LlxuICAgICAqIEBwYXJhbSByZXBvcnRQcm9ncmVzcyBmbGFnIHRvIHJlcG9ydCByZXF1ZXN0IGFuZCByZXNwb25zZSBwcm9ncmVzcy5cbiAgICAgKi9cbiAgICBwdWJsaWMgZGVsZXRlQWx0ZXJuYXRlU2Vuc2UodGV4dDogc3RyaW5nLCBsYW5ndWFnZTogc3RyaW5nLCBkZXBlbmRlbmN5OiBSdWxlVGV4dCwgY2xpZW50SWQ/OiBudW1iZXIsIHB1Ymxpc2g/OiBib29sZWFuLCBvYnNlcnZlPzogJ2JvZHknLCByZXBvcnRQcm9ncmVzcz86IGJvb2xlYW4pOiBPYnNlcnZhYmxlPFJ1bGU+O1xuICAgIHB1YmxpYyBkZWxldGVBbHRlcm5hdGVTZW5zZSh0ZXh0OiBzdHJpbmcsIGxhbmd1YWdlOiBzdHJpbmcsIGRlcGVuZGVuY3k6IFJ1bGVUZXh0LCBjbGllbnRJZD86IG51bWJlciwgcHVibGlzaD86IGJvb2xlYW4sIG9ic2VydmU/OiAncmVzcG9uc2UnLCByZXBvcnRQcm9ncmVzcz86IGJvb2xlYW4pOiBPYnNlcnZhYmxlPEh0dHBSZXNwb25zZTxSdWxlPj47XG4gICAgcHVibGljIGRlbGV0ZUFsdGVybmF0ZVNlbnNlKHRleHQ6IHN0cmluZywgbGFuZ3VhZ2U6IHN0cmluZywgZGVwZW5kZW5jeTogUnVsZVRleHQsIGNsaWVudElkPzogbnVtYmVyLCBwdWJsaXNoPzogYm9vbGVhbiwgb2JzZXJ2ZT86ICdldmVudHMnLCByZXBvcnRQcm9ncmVzcz86IGJvb2xlYW4pOiBPYnNlcnZhYmxlPEh0dHBFdmVudDxSdWxlPj47XG4gICAgcHVibGljIGRlbGV0ZUFsdGVybmF0ZVNlbnNlKHRleHQ6IHN0cmluZywgbGFuZ3VhZ2U6IHN0cmluZywgZGVwZW5kZW5jeTogUnVsZVRleHQsIGNsaWVudElkPzogbnVtYmVyLCBwdWJsaXNoPzogYm9vbGVhbiwgb2JzZXJ2ZTogYW55ID0gJ2JvZHknLCByZXBvcnRQcm9ncmVzczogYm9vbGVhbiA9IGZhbHNlICk6IE9ic2VydmFibGU8YW55PiB7XG5cbiAgICAgICAgaWYgKHRleHQgPT09IG51bGwgfHwgdGV4dCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1JlcXVpcmVkIHBhcmFtZXRlciB0ZXh0IHdhcyBudWxsIG9yIHVuZGVmaW5lZCB3aGVuIGNhbGxpbmcgZGVsZXRlQWx0ZXJuYXRlU2Vuc2UuJyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAobGFuZ3VhZ2UgPT09IG51bGwgfHwgbGFuZ3VhZ2UgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZXF1aXJlZCBwYXJhbWV0ZXIgbGFuZ3VhZ2Ugd2FzIG51bGwgb3IgdW5kZWZpbmVkIHdoZW4gY2FsbGluZyBkZWxldGVBbHRlcm5hdGVTZW5zZS4nKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChkZXBlbmRlbmN5ID09PSBudWxsIHx8IGRlcGVuZGVuY3kgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZXF1aXJlZCBwYXJhbWV0ZXIgZGVwZW5kZW5jeSB3YXMgbnVsbCBvciB1bmRlZmluZWQgd2hlbiBjYWxsaW5nIGRlbGV0ZUFsdGVybmF0ZVNlbnNlLicpO1xuICAgICAgICB9XG5cblxuXG4gICAgICAgIGxldCBxdWVyeVBhcmFtZXRlcnMgPSBuZXcgSHR0cFBhcmFtcyh7ZW5jb2RlcjogbmV3IEN1c3RvbUh0dHBVcmxFbmNvZGluZ0NvZGVjKCl9KTtcbiAgICAgICAgaWYgKGxhbmd1YWdlICE9PSB1bmRlZmluZWQgJiYgbGFuZ3VhZ2UgIT09IG51bGwpIHtcbiAgICAgICAgICAgIHF1ZXJ5UGFyYW1ldGVycyA9IHF1ZXJ5UGFyYW1ldGVycy5zZXQoJ2xhbmd1YWdlJywgPGFueT5sYW5ndWFnZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNsaWVudElkICE9PSB1bmRlZmluZWQgJiYgY2xpZW50SWQgIT09IG51bGwpIHtcbiAgICAgICAgICAgIHF1ZXJ5UGFyYW1ldGVycyA9IHF1ZXJ5UGFyYW1ldGVycy5zZXQoJ2NsaWVudElkJywgPGFueT5jbGllbnRJZCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHB1Ymxpc2ggIT09IHVuZGVmaW5lZCAmJiBwdWJsaXNoICE9PSBudWxsKSB7XG4gICAgICAgICAgICBxdWVyeVBhcmFtZXRlcnMgPSBxdWVyeVBhcmFtZXRlcnMuc2V0KCdwdWJsaXNoJywgPGFueT5wdWJsaXNoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBoZWFkZXJzID0gdGhpcy5kZWZhdWx0SGVhZGVycztcblxuICAgICAgICAvLyBhdXRoZW50aWNhdGlvbiAoYmVhcmVyQXV0aCkgcmVxdWlyZWRcbiAgICAgICAgaWYgKHRoaXMuY29uZmlndXJhdGlvbi5hY2Nlc3NUb2tlbikge1xuICAgICAgICAgICAgY29uc3QgYWNjZXNzVG9rZW4gPSB0eXBlb2YgdGhpcy5jb25maWd1cmF0aW9uLmFjY2Vzc1Rva2VuID09PSAnZnVuY3Rpb24nXG4gICAgICAgICAgICAgICAgPyB0aGlzLmNvbmZpZ3VyYXRpb24uYWNjZXNzVG9rZW4oKVxuICAgICAgICAgICAgICAgIDogdGhpcy5jb25maWd1cmF0aW9uLmFjY2Vzc1Rva2VuO1xuICAgICAgICAgICAgaGVhZGVycyA9IGhlYWRlcnMuc2V0KCdBdXRob3JpemF0aW9uJywgJ0JlYXJlciAnICsgYWNjZXNzVG9rZW4pO1xuICAgICAgICB9XG4gICAgICAgIC8vIHRvIGRldGVybWluZSB0aGUgQWNjZXB0IGhlYWRlclxuICAgICAgICBsZXQgaHR0cEhlYWRlckFjY2VwdHM6IHN0cmluZ1tdID0gW1xuICAgICAgICAgICAgJ2FwcGxpY2F0aW9uL2pzb24nXG4gICAgICAgIF07XG4gICAgICAgIGNvbnN0IGh0dHBIZWFkZXJBY2NlcHRTZWxlY3RlZDogc3RyaW5nIHwgdW5kZWZpbmVkID0gdGhpcy5jb25maWd1cmF0aW9uLnNlbGVjdEhlYWRlckFjY2VwdChodHRwSGVhZGVyQWNjZXB0cyk7XG4gICAgICAgIGlmIChodHRwSGVhZGVyQWNjZXB0U2VsZWN0ZWQgIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBoZWFkZXJzID0gaGVhZGVycy5zZXQoJ0FjY2VwdCcsIGh0dHBIZWFkZXJBY2NlcHRTZWxlY3RlZCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyB0byBkZXRlcm1pbmUgdGhlIENvbnRlbnQtVHlwZSBoZWFkZXJcbiAgICAgICAgY29uc3QgY29uc3VtZXM6IHN0cmluZ1tdID0gW1xuICAgICAgICBdO1xuXG4gICAgICAgIHJldHVybiB0aGlzLmh0dHBDbGllbnQucmVxdWVzdDxSdWxlPignZGVsZXRlJyxgJHt0aGlzLmJhc2VQYXRofS9ydWxlcy90ZXh0LyR7ZW5jb2RlVVJJQ29tcG9uZW50KFN0cmluZyh0ZXh0KSl9L2FsdF9zZW5zZXMvJHtlbmNvZGVVUklDb21wb25lbnQoU3RyaW5nKGRlcGVuZGVuY3kpKX1gLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHBhcmFtczogcXVlcnlQYXJhbWV0ZXJzLFxuICAgICAgICAgICAgICAgIHdpdGhDcmVkZW50aWFsczogdGhpcy5jb25maWd1cmF0aW9uLndpdGhDcmVkZW50aWFscyxcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiBoZWFkZXJzLFxuICAgICAgICAgICAgICAgIG9ic2VydmU6IG9ic2VydmUsXG4gICAgICAgICAgICAgICAgcmVwb3J0UHJvZ3Jlc3M6IHJlcG9ydFByb2dyZXNzXG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRGVsZXRlIGFuIGFsdGVybmF0ZSBzcGVsbGluZyBmb3IgYSBydWxlXG4gICAgICogVGhpcyB3aWxsIGRlbGV0ZSBhbiBhbHRlcm5hdGUgc3BlbGxpbmcgZm9yIHJ1bGUgYW5kIGxvZyB0aGUgY2hhbmdlXG4gICAgICogQHBhcmFtIHRleHQgVGhlIHRleHQgb2YgdGhlIHJ1bGUgeW91IHdhbnQgdG8gd29yayBvblxuICAgICAqIEBwYXJhbSBsYW5ndWFnZSBTaG93IHJlc3VsdHMgZm9yIHRoZSBnaXZlbiBsYW5ndWFnZSBvbmx5LiAgIFRoaXMgaXMgdGhlIGxhbmd1YWdlIHVzZWQsIGNvdWxkIGhhdmUgYmVlbiBzZXQgYnkgdGhlIHVzZXIgb3IgZGV0ZWN0ZWQgYnkgbGFuZ3VhZ2UgaWQuXG4gICAgICogQHBhcmFtIGRlcGVuZGVuY3kgVGhpcyBpcyB0aGUgcmVsYXRlZCB0ZXh0IHlvdSB3YW50IHRvIHdvcmsgb24uXG4gICAgICogQHBhcmFtIGNsaWVudElkIFNob3cgcmVzdWx0cyBmb3IgYSBnaXZlbiBjbGllbnQuICBUeXBpY2FsbHkgdGhpcyBpcyBzZXQgZm9yIHlvdSBieSB0aGUgaW50ZXJuYWwgc3lzdGVtIGJhc2VkIG9uIHRoZSBBUElfS0VZIHlvdSBhcmUgdXNpbmcuICBIb3dldmVyIHNvbWUgY2xpZW50cyBhcmUgYWxsb3dlZCB0byB2aWV3IG90aGVyIGNsaWVudHMgc3VjaCBhcyB3aGVuIHRoZXkgaGF2ZSBhIHNhbmRib3ggb3Igd2hlbiB0aGV5IGFyZSBhIGxhcmdlIGVudGVycHJpc2UgYW5kIGhhdmUgbXVsdGlwbGUgY2xpZW50cyB0aGV5IG1hbmFnZS4gIEl0IHdpbGwgb25seSBhbGxvdyB5b3UgdG8gdmlldyBjbGllbnQgZGF0YSB5b3UgaGF2ZSBhY2Nlc3MgdG8uXG4gICAgICogQHBhcmFtIHB1Ymxpc2ggVGhpcyB3aWxsIGFsc28gbWFrZSB0aGUgcnVsZSBsaXZlXG4gICAgICogQHBhcmFtIG9ic2VydmUgc2V0IHdoZXRoZXIgb3Igbm90IHRvIHJldHVybiB0aGUgZGF0YSBPYnNlcnZhYmxlIGFzIHRoZSBib2R5LCByZXNwb25zZSBvciBldmVudHMuIGRlZmF1bHRzIHRvIHJldHVybmluZyB0aGUgYm9keS5cbiAgICAgKiBAcGFyYW0gcmVwb3J0UHJvZ3Jlc3MgZmxhZyB0byByZXBvcnQgcmVxdWVzdCBhbmQgcmVzcG9uc2UgcHJvZ3Jlc3MuXG4gICAgICovXG4gICAgcHVibGljIGRlbGV0ZUFsdGVybmF0ZVNwZWxsaW5nKHRleHQ6IHN0cmluZywgbGFuZ3VhZ2U6IHN0cmluZywgZGVwZW5kZW5jeTogUnVsZVRleHQsIGNsaWVudElkPzogbnVtYmVyLCBwdWJsaXNoPzogYm9vbGVhbiwgb2JzZXJ2ZT86ICdib2R5JywgcmVwb3J0UHJvZ3Jlc3M/OiBib29sZWFuKTogT2JzZXJ2YWJsZTxSdWxlPjtcbiAgICBwdWJsaWMgZGVsZXRlQWx0ZXJuYXRlU3BlbGxpbmcodGV4dDogc3RyaW5nLCBsYW5ndWFnZTogc3RyaW5nLCBkZXBlbmRlbmN5OiBSdWxlVGV4dCwgY2xpZW50SWQ/OiBudW1iZXIsIHB1Ymxpc2g/OiBib29sZWFuLCBvYnNlcnZlPzogJ3Jlc3BvbnNlJywgcmVwb3J0UHJvZ3Jlc3M/OiBib29sZWFuKTogT2JzZXJ2YWJsZTxIdHRwUmVzcG9uc2U8UnVsZT4+O1xuICAgIHB1YmxpYyBkZWxldGVBbHRlcm5hdGVTcGVsbGluZyh0ZXh0OiBzdHJpbmcsIGxhbmd1YWdlOiBzdHJpbmcsIGRlcGVuZGVuY3k6IFJ1bGVUZXh0LCBjbGllbnRJZD86IG51bWJlciwgcHVibGlzaD86IGJvb2xlYW4sIG9ic2VydmU/OiAnZXZlbnRzJywgcmVwb3J0UHJvZ3Jlc3M/OiBib29sZWFuKTogT2JzZXJ2YWJsZTxIdHRwRXZlbnQ8UnVsZT4+O1xuICAgIHB1YmxpYyBkZWxldGVBbHRlcm5hdGVTcGVsbGluZyh0ZXh0OiBzdHJpbmcsIGxhbmd1YWdlOiBzdHJpbmcsIGRlcGVuZGVuY3k6IFJ1bGVUZXh0LCBjbGllbnRJZD86IG51bWJlciwgcHVibGlzaD86IGJvb2xlYW4sIG9ic2VydmU6IGFueSA9ICdib2R5JywgcmVwb3J0UHJvZ3Jlc3M6IGJvb2xlYW4gPSBmYWxzZSApOiBPYnNlcnZhYmxlPGFueT4ge1xuXG4gICAgICAgIGlmICh0ZXh0ID09PSBudWxsIHx8IHRleHQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZXF1aXJlZCBwYXJhbWV0ZXIgdGV4dCB3YXMgbnVsbCBvciB1bmRlZmluZWQgd2hlbiBjYWxsaW5nIGRlbGV0ZUFsdGVybmF0ZVNwZWxsaW5nLicpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGxhbmd1YWdlID09PSBudWxsIHx8IGxhbmd1YWdlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignUmVxdWlyZWQgcGFyYW1ldGVyIGxhbmd1YWdlIHdhcyBudWxsIG9yIHVuZGVmaW5lZCB3aGVuIGNhbGxpbmcgZGVsZXRlQWx0ZXJuYXRlU3BlbGxpbmcuJyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZGVwZW5kZW5jeSA9PT0gbnVsbCB8fCBkZXBlbmRlbmN5ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignUmVxdWlyZWQgcGFyYW1ldGVyIGRlcGVuZGVuY3kgd2FzIG51bGwgb3IgdW5kZWZpbmVkIHdoZW4gY2FsbGluZyBkZWxldGVBbHRlcm5hdGVTcGVsbGluZy4nKTtcbiAgICAgICAgfVxuXG5cblxuICAgICAgICBsZXQgcXVlcnlQYXJhbWV0ZXJzID0gbmV3IEh0dHBQYXJhbXMoe2VuY29kZXI6IG5ldyBDdXN0b21IdHRwVXJsRW5jb2RpbmdDb2RlYygpfSk7XG4gICAgICAgIGlmIChsYW5ndWFnZSAhPT0gdW5kZWZpbmVkICYmIGxhbmd1YWdlICE9PSBudWxsKSB7XG4gICAgICAgICAgICBxdWVyeVBhcmFtZXRlcnMgPSBxdWVyeVBhcmFtZXRlcnMuc2V0KCdsYW5ndWFnZScsIDxhbnk+bGFuZ3VhZ2UpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjbGllbnRJZCAhPT0gdW5kZWZpbmVkICYmIGNsaWVudElkICE9PSBudWxsKSB7XG4gICAgICAgICAgICBxdWVyeVBhcmFtZXRlcnMgPSBxdWVyeVBhcmFtZXRlcnMuc2V0KCdjbGllbnRJZCcsIDxhbnk+Y2xpZW50SWQpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChwdWJsaXNoICE9PSB1bmRlZmluZWQgJiYgcHVibGlzaCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgcXVlcnlQYXJhbWV0ZXJzID0gcXVlcnlQYXJhbWV0ZXJzLnNldCgncHVibGlzaCcsIDxhbnk+cHVibGlzaCk7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgaGVhZGVycyA9IHRoaXMuZGVmYXVsdEhlYWRlcnM7XG5cbiAgICAgICAgLy8gYXV0aGVudGljYXRpb24gKGJlYXJlckF1dGgpIHJlcXVpcmVkXG4gICAgICAgIGlmICh0aGlzLmNvbmZpZ3VyYXRpb24uYWNjZXNzVG9rZW4pIHtcbiAgICAgICAgICAgIGNvbnN0IGFjY2Vzc1Rva2VuID0gdHlwZW9mIHRoaXMuY29uZmlndXJhdGlvbi5hY2Nlc3NUb2tlbiA9PT0gJ2Z1bmN0aW9uJ1xuICAgICAgICAgICAgICAgID8gdGhpcy5jb25maWd1cmF0aW9uLmFjY2Vzc1Rva2VuKClcbiAgICAgICAgICAgICAgICA6IHRoaXMuY29uZmlndXJhdGlvbi5hY2Nlc3NUb2tlbjtcbiAgICAgICAgICAgIGhlYWRlcnMgPSBoZWFkZXJzLnNldCgnQXV0aG9yaXphdGlvbicsICdCZWFyZXIgJyArIGFjY2Vzc1Rva2VuKTtcbiAgICAgICAgfVxuICAgICAgICAvLyB0byBkZXRlcm1pbmUgdGhlIEFjY2VwdCBoZWFkZXJcbiAgICAgICAgbGV0IGh0dHBIZWFkZXJBY2NlcHRzOiBzdHJpbmdbXSA9IFtcbiAgICAgICAgICAgICdhcHBsaWNhdGlvbi9qc29uJ1xuICAgICAgICBdO1xuICAgICAgICBjb25zdCBodHRwSGVhZGVyQWNjZXB0U2VsZWN0ZWQ6IHN0cmluZyB8IHVuZGVmaW5lZCA9IHRoaXMuY29uZmlndXJhdGlvbi5zZWxlY3RIZWFkZXJBY2NlcHQoaHR0cEhlYWRlckFjY2VwdHMpO1xuICAgICAgICBpZiAoaHR0cEhlYWRlckFjY2VwdFNlbGVjdGVkICE9IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgaGVhZGVycyA9IGhlYWRlcnMuc2V0KCdBY2NlcHQnLCBodHRwSGVhZGVyQWNjZXB0U2VsZWN0ZWQpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gdG8gZGV0ZXJtaW5lIHRoZSBDb250ZW50LVR5cGUgaGVhZGVyXG4gICAgICAgIGNvbnN0IGNvbnN1bWVzOiBzdHJpbmdbXSA9IFtcbiAgICAgICAgXTtcblxuICAgICAgICByZXR1cm4gdGhpcy5odHRwQ2xpZW50LnJlcXVlc3Q8UnVsZT4oJ2RlbGV0ZScsYCR7dGhpcy5iYXNlUGF0aH0vcnVsZXMvdGV4dC8ke2VuY29kZVVSSUNvbXBvbmVudChTdHJpbmcodGV4dCkpfS9hbHRfc3BlbGxpbmdzLyR7ZW5jb2RlVVJJQ29tcG9uZW50KFN0cmluZyhkZXBlbmRlbmN5KSl9YCxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBwYXJhbXM6IHF1ZXJ5UGFyYW1ldGVycyxcbiAgICAgICAgICAgICAgICB3aXRoQ3JlZGVudGlhbHM6IHRoaXMuY29uZmlndXJhdGlvbi53aXRoQ3JlZGVudGlhbHMsXG4gICAgICAgICAgICAgICAgaGVhZGVyczogaGVhZGVycyxcbiAgICAgICAgICAgICAgICBvYnNlcnZlOiBvYnNlcnZlLFxuICAgICAgICAgICAgICAgIHJlcG9ydFByb2dyZXNzOiByZXBvcnRQcm9ncmVzc1xuICAgICAgICAgICAgfVxuICAgICAgICApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIERlbGV0ZSBhIGNvbW1lbnRcbiAgICAgKiBSZW1vdmUgYSBjb21tZW50XG4gICAgICogQHBhcmFtIHRleHQgVGhlIHRleHQgb2YgdGhlIHJ1bGUgeW91IHdhbnQgdG8gd29yayBvblxuICAgICAqIEBwYXJhbSBsYW5ndWFnZSBTaG93IHJlc3VsdHMgZm9yIHRoZSBnaXZlbiBsYW5ndWFnZSBvbmx5LiAgIFRoaXMgaXMgdGhlIGxhbmd1YWdlIHVzZWQsIGNvdWxkIGhhdmUgYmVlbiBzZXQgYnkgdGhlIHVzZXIgb3IgZGV0ZWN0ZWQgYnkgbGFuZ3VhZ2UgaWQuXG4gICAgICogQHBhcmFtIGNvbW1lbnRJZCBUaGUgdW5pcXVlIGlkZW50aWZpZXIgZm9yIHRoZSBjb21tZW50XG4gICAgICogQHBhcmFtIGNsaWVudElkIFNob3cgcmVzdWx0cyBmb3IgYSBnaXZlbiBjbGllbnQuICBUeXBpY2FsbHkgdGhpcyBpcyBzZXQgZm9yIHlvdSBieSB0aGUgaW50ZXJuYWwgc3lzdGVtIGJhc2VkIG9uIHRoZSBBUElfS0VZIHlvdSBhcmUgdXNpbmcuICBIb3dldmVyIHNvbWUgY2xpZW50cyBhcmUgYWxsb3dlZCB0byB2aWV3IG90aGVyIGNsaWVudHMgc3VjaCBhcyB3aGVuIHRoZXkgaGF2ZSBhIHNhbmRib3ggb3Igd2hlbiB0aGV5IGFyZSBhIGxhcmdlIGVudGVycHJpc2UgYW5kIGhhdmUgbXVsdGlwbGUgY2xpZW50cyB0aGV5IG1hbmFnZS4gIEl0IHdpbGwgb25seSBhbGxvdyB5b3UgdG8gdmlldyBjbGllbnQgZGF0YSB5b3UgaGF2ZSBhY2Nlc3MgdG8uXG4gICAgICogQHBhcmFtIG9ic2VydmUgc2V0IHdoZXRoZXIgb3Igbm90IHRvIHJldHVybiB0aGUgZGF0YSBPYnNlcnZhYmxlIGFzIHRoZSBib2R5LCByZXNwb25zZSBvciBldmVudHMuIGRlZmF1bHRzIHRvIHJldHVybmluZyB0aGUgYm9keS5cbiAgICAgKiBAcGFyYW0gcmVwb3J0UHJvZ3Jlc3MgZmxhZyB0byByZXBvcnQgcmVxdWVzdCBhbmQgcmVzcG9uc2UgcHJvZ3Jlc3MuXG4gICAgICovXG4gICAgcHVibGljIGRlbGV0ZUNvbW1lbnQodGV4dDogc3RyaW5nLCBsYW5ndWFnZTogc3RyaW5nLCBjb21tZW50SWQ6IHN0cmluZywgY2xpZW50SWQ/OiBudW1iZXIsIG9ic2VydmU/OiAnYm9keScsIHJlcG9ydFByb2dyZXNzPzogYm9vbGVhbik6IE9ic2VydmFibGU8SW5saW5lUmVzcG9uc2UyMDA+O1xuICAgIHB1YmxpYyBkZWxldGVDb21tZW50KHRleHQ6IHN0cmluZywgbGFuZ3VhZ2U6IHN0cmluZywgY29tbWVudElkOiBzdHJpbmcsIGNsaWVudElkPzogbnVtYmVyLCBvYnNlcnZlPzogJ3Jlc3BvbnNlJywgcmVwb3J0UHJvZ3Jlc3M/OiBib29sZWFuKTogT2JzZXJ2YWJsZTxIdHRwUmVzcG9uc2U8SW5saW5lUmVzcG9uc2UyMDA+PjtcbiAgICBwdWJsaWMgZGVsZXRlQ29tbWVudCh0ZXh0OiBzdHJpbmcsIGxhbmd1YWdlOiBzdHJpbmcsIGNvbW1lbnRJZDogc3RyaW5nLCBjbGllbnRJZD86IG51bWJlciwgb2JzZXJ2ZT86ICdldmVudHMnLCByZXBvcnRQcm9ncmVzcz86IGJvb2xlYW4pOiBPYnNlcnZhYmxlPEh0dHBFdmVudDxJbmxpbmVSZXNwb25zZTIwMD4+O1xuICAgIHB1YmxpYyBkZWxldGVDb21tZW50KHRleHQ6IHN0cmluZywgbGFuZ3VhZ2U6IHN0cmluZywgY29tbWVudElkOiBzdHJpbmcsIGNsaWVudElkPzogbnVtYmVyLCBvYnNlcnZlOiBhbnkgPSAnYm9keScsIHJlcG9ydFByb2dyZXNzOiBib29sZWFuID0gZmFsc2UgKTogT2JzZXJ2YWJsZTxhbnk+IHtcblxuICAgICAgICBpZiAodGV4dCA9PT0gbnVsbCB8fCB0ZXh0ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignUmVxdWlyZWQgcGFyYW1ldGVyIHRleHQgd2FzIG51bGwgb3IgdW5kZWZpbmVkIHdoZW4gY2FsbGluZyBkZWxldGVDb21tZW50LicpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGxhbmd1YWdlID09PSBudWxsIHx8IGxhbmd1YWdlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignUmVxdWlyZWQgcGFyYW1ldGVyIGxhbmd1YWdlIHdhcyBudWxsIG9yIHVuZGVmaW5lZCB3aGVuIGNhbGxpbmcgZGVsZXRlQ29tbWVudC4nKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChjb21tZW50SWQgPT09IG51bGwgfHwgY29tbWVudElkID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignUmVxdWlyZWQgcGFyYW1ldGVyIGNvbW1lbnRJZCB3YXMgbnVsbCBvciB1bmRlZmluZWQgd2hlbiBjYWxsaW5nIGRlbGV0ZUNvbW1lbnQuJyk7XG4gICAgICAgIH1cblxuXG4gICAgICAgIGxldCBxdWVyeVBhcmFtZXRlcnMgPSBuZXcgSHR0cFBhcmFtcyh7ZW5jb2RlcjogbmV3IEN1c3RvbUh0dHBVcmxFbmNvZGluZ0NvZGVjKCl9KTtcbiAgICAgICAgaWYgKGxhbmd1YWdlICE9PSB1bmRlZmluZWQgJiYgbGFuZ3VhZ2UgIT09IG51bGwpIHtcbiAgICAgICAgICAgIHF1ZXJ5UGFyYW1ldGVycyA9IHF1ZXJ5UGFyYW1ldGVycy5zZXQoJ2xhbmd1YWdlJywgPGFueT5sYW5ndWFnZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNsaWVudElkICE9PSB1bmRlZmluZWQgJiYgY2xpZW50SWQgIT09IG51bGwpIHtcbiAgICAgICAgICAgIHF1ZXJ5UGFyYW1ldGVycyA9IHF1ZXJ5UGFyYW1ldGVycy5zZXQoJ2NsaWVudElkJywgPGFueT5jbGllbnRJZCk7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgaGVhZGVycyA9IHRoaXMuZGVmYXVsdEhlYWRlcnM7XG5cbiAgICAgICAgLy8gYXV0aGVudGljYXRpb24gKGJlYXJlckF1dGgpIHJlcXVpcmVkXG4gICAgICAgIGlmICh0aGlzLmNvbmZpZ3VyYXRpb24uYWNjZXNzVG9rZW4pIHtcbiAgICAgICAgICAgIGNvbnN0IGFjY2Vzc1Rva2VuID0gdHlwZW9mIHRoaXMuY29uZmlndXJhdGlvbi5hY2Nlc3NUb2tlbiA9PT0gJ2Z1bmN0aW9uJ1xuICAgICAgICAgICAgICAgID8gdGhpcy5jb25maWd1cmF0aW9uLmFjY2Vzc1Rva2VuKClcbiAgICAgICAgICAgICAgICA6IHRoaXMuY29uZmlndXJhdGlvbi5hY2Nlc3NUb2tlbjtcbiAgICAgICAgICAgIGhlYWRlcnMgPSBoZWFkZXJzLnNldCgnQXV0aG9yaXphdGlvbicsICdCZWFyZXIgJyArIGFjY2Vzc1Rva2VuKTtcbiAgICAgICAgfVxuICAgICAgICAvLyB0byBkZXRlcm1pbmUgdGhlIEFjY2VwdCBoZWFkZXJcbiAgICAgICAgbGV0IGh0dHBIZWFkZXJBY2NlcHRzOiBzdHJpbmdbXSA9IFtcbiAgICAgICAgICAgICdhcHBsaWNhdGlvbi9qc29uJ1xuICAgICAgICBdO1xuICAgICAgICBjb25zdCBodHRwSGVhZGVyQWNjZXB0U2VsZWN0ZWQ6IHN0cmluZyB8IHVuZGVmaW5lZCA9IHRoaXMuY29uZmlndXJhdGlvbi5zZWxlY3RIZWFkZXJBY2NlcHQoaHR0cEhlYWRlckFjY2VwdHMpO1xuICAgICAgICBpZiAoaHR0cEhlYWRlckFjY2VwdFNlbGVjdGVkICE9IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgaGVhZGVycyA9IGhlYWRlcnMuc2V0KCdBY2NlcHQnLCBodHRwSGVhZGVyQWNjZXB0U2VsZWN0ZWQpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gdG8gZGV0ZXJtaW5lIHRoZSBDb250ZW50LVR5cGUgaGVhZGVyXG4gICAgICAgIGNvbnN0IGNvbnN1bWVzOiBzdHJpbmdbXSA9IFtcbiAgICAgICAgXTtcblxuICAgICAgICByZXR1cm4gdGhpcy5odHRwQ2xpZW50LnJlcXVlc3Q8SW5saW5lUmVzcG9uc2UyMDA+KCdkZWxldGUnLGAke3RoaXMuYmFzZVBhdGh9L3J1bGVzL3RleHQvJHtlbmNvZGVVUklDb21wb25lbnQoU3RyaW5nKHRleHQpKX0vY29tbWVudHMvJHtlbmNvZGVVUklDb21wb25lbnQoU3RyaW5nKGNvbW1lbnRJZCkpfWAsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgcGFyYW1zOiBxdWVyeVBhcmFtZXRlcnMsXG4gICAgICAgICAgICAgICAgd2l0aENyZWRlbnRpYWxzOiB0aGlzLmNvbmZpZ3VyYXRpb24ud2l0aENyZWRlbnRpYWxzLFxuICAgICAgICAgICAgICAgIGhlYWRlcnM6IGhlYWRlcnMsXG4gICAgICAgICAgICAgICAgb2JzZXJ2ZTogb2JzZXJ2ZSxcbiAgICAgICAgICAgICAgICByZXBvcnRQcm9ncmVzczogcmVwb3J0UHJvZ3Jlc3NcbiAgICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBEZWxldGUgYW4gZmxhZyBmb3IgYSBydWxlXG4gICAgICogVGhpcyB3aWxsIGRlbGV0ZSBhIGZsYWcgZm9yIHJ1bGUgYW5kIGxvZyB0aGUgY2hhbmdlXG4gICAgICogQHBhcmFtIHRleHQgVGhlIHRleHQgb2YgdGhlIHJ1bGUgeW91IHdhbnQgdG8gd29yayBvblxuICAgICAqIEBwYXJhbSBsYW5ndWFnZSBTaG93IHJlc3VsdHMgZm9yIHRoZSBnaXZlbiBsYW5ndWFnZSBvbmx5LiAgIFRoaXMgaXMgdGhlIGxhbmd1YWdlIHVzZWQsIGNvdWxkIGhhdmUgYmVlbiBzZXQgYnkgdGhlIHVzZXIgb3IgZGV0ZWN0ZWQgYnkgbGFuZ3VhZ2UgaWQuXG4gICAgICogQHBhcmFtIGZsYWcgVGhlIG5hbWUgb2YgdGhlIGZsYWcgdG8gY2hhbmdlXG4gICAgICogQHBhcmFtIGNsaWVudElkIFNob3cgcmVzdWx0cyBmb3IgYSBnaXZlbiBjbGllbnQuICBUeXBpY2FsbHkgdGhpcyBpcyBzZXQgZm9yIHlvdSBieSB0aGUgaW50ZXJuYWwgc3lzdGVtIGJhc2VkIG9uIHRoZSBBUElfS0VZIHlvdSBhcmUgdXNpbmcuICBIb3dldmVyIHNvbWUgY2xpZW50cyBhcmUgYWxsb3dlZCB0byB2aWV3IG90aGVyIGNsaWVudHMgc3VjaCBhcyB3aGVuIHRoZXkgaGF2ZSBhIHNhbmRib3ggb3Igd2hlbiB0aGV5IGFyZSBhIGxhcmdlIGVudGVycHJpc2UgYW5kIGhhdmUgbXVsdGlwbGUgY2xpZW50cyB0aGV5IG1hbmFnZS4gIEl0IHdpbGwgb25seSBhbGxvdyB5b3UgdG8gdmlldyBjbGllbnQgZGF0YSB5b3UgaGF2ZSBhY2Nlc3MgdG8uXG4gICAgICogQHBhcmFtIHB1Ymxpc2ggVGhpcyB3aWxsIGFsc28gbWFrZSB0aGUgcnVsZSBsaXZlXG4gICAgICogQHBhcmFtIG9ic2VydmUgc2V0IHdoZXRoZXIgb3Igbm90IHRvIHJldHVybiB0aGUgZGF0YSBPYnNlcnZhYmxlIGFzIHRoZSBib2R5LCByZXNwb25zZSBvciBldmVudHMuIGRlZmF1bHRzIHRvIHJldHVybmluZyB0aGUgYm9keS5cbiAgICAgKiBAcGFyYW0gcmVwb3J0UHJvZ3Jlc3MgZmxhZyB0byByZXBvcnQgcmVxdWVzdCBhbmQgcmVzcG9uc2UgcHJvZ3Jlc3MuXG4gICAgICovXG4gICAgcHVibGljIGRlbGV0ZUZsYWcodGV4dDogc3RyaW5nLCBsYW5ndWFnZTogc3RyaW5nLCBmbGFnOiBGbGFnLCBjbGllbnRJZD86IG51bWJlciwgcHVibGlzaD86IGJvb2xlYW4sIG9ic2VydmU/OiAnYm9keScsIHJlcG9ydFByb2dyZXNzPzogYm9vbGVhbik6IE9ic2VydmFibGU8UnVsZT47XG4gICAgcHVibGljIGRlbGV0ZUZsYWcodGV4dDogc3RyaW5nLCBsYW5ndWFnZTogc3RyaW5nLCBmbGFnOiBGbGFnLCBjbGllbnRJZD86IG51bWJlciwgcHVibGlzaD86IGJvb2xlYW4sIG9ic2VydmU/OiAncmVzcG9uc2UnLCByZXBvcnRQcm9ncmVzcz86IGJvb2xlYW4pOiBPYnNlcnZhYmxlPEh0dHBSZXNwb25zZTxSdWxlPj47XG4gICAgcHVibGljIGRlbGV0ZUZsYWcodGV4dDogc3RyaW5nLCBsYW5ndWFnZTogc3RyaW5nLCBmbGFnOiBGbGFnLCBjbGllbnRJZD86IG51bWJlciwgcHVibGlzaD86IGJvb2xlYW4sIG9ic2VydmU/OiAnZXZlbnRzJywgcmVwb3J0UHJvZ3Jlc3M/OiBib29sZWFuKTogT2JzZXJ2YWJsZTxIdHRwRXZlbnQ8UnVsZT4+O1xuICAgIHB1YmxpYyBkZWxldGVGbGFnKHRleHQ6IHN0cmluZywgbGFuZ3VhZ2U6IHN0cmluZywgZmxhZzogRmxhZywgY2xpZW50SWQ/OiBudW1iZXIsIHB1Ymxpc2g/OiBib29sZWFuLCBvYnNlcnZlOiBhbnkgPSAnYm9keScsIHJlcG9ydFByb2dyZXNzOiBib29sZWFuID0gZmFsc2UgKTogT2JzZXJ2YWJsZTxhbnk+IHtcblxuICAgICAgICBpZiAodGV4dCA9PT0gbnVsbCB8fCB0ZXh0ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignUmVxdWlyZWQgcGFyYW1ldGVyIHRleHQgd2FzIG51bGwgb3IgdW5kZWZpbmVkIHdoZW4gY2FsbGluZyBkZWxldGVGbGFnLicpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGxhbmd1YWdlID09PSBudWxsIHx8IGxhbmd1YWdlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignUmVxdWlyZWQgcGFyYW1ldGVyIGxhbmd1YWdlIHdhcyBudWxsIG9yIHVuZGVmaW5lZCB3aGVuIGNhbGxpbmcgZGVsZXRlRmxhZy4nKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChmbGFnID09PSBudWxsIHx8IGZsYWcgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZXF1aXJlZCBwYXJhbWV0ZXIgZmxhZyB3YXMgbnVsbCBvciB1bmRlZmluZWQgd2hlbiBjYWxsaW5nIGRlbGV0ZUZsYWcuJyk7XG4gICAgICAgIH1cblxuXG5cbiAgICAgICAgbGV0IHF1ZXJ5UGFyYW1ldGVycyA9IG5ldyBIdHRwUGFyYW1zKHtlbmNvZGVyOiBuZXcgQ3VzdG9tSHR0cFVybEVuY29kaW5nQ29kZWMoKX0pO1xuICAgICAgICBpZiAobGFuZ3VhZ2UgIT09IHVuZGVmaW5lZCAmJiBsYW5ndWFnZSAhPT0gbnVsbCkge1xuICAgICAgICAgICAgcXVlcnlQYXJhbWV0ZXJzID0gcXVlcnlQYXJhbWV0ZXJzLnNldCgnbGFuZ3VhZ2UnLCA8YW55Pmxhbmd1YWdlKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY2xpZW50SWQgIT09IHVuZGVmaW5lZCAmJiBjbGllbnRJZCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgcXVlcnlQYXJhbWV0ZXJzID0gcXVlcnlQYXJhbWV0ZXJzLnNldCgnY2xpZW50SWQnLCA8YW55PmNsaWVudElkKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocHVibGlzaCAhPT0gdW5kZWZpbmVkICYmIHB1Ymxpc2ggIT09IG51bGwpIHtcbiAgICAgICAgICAgIHF1ZXJ5UGFyYW1ldGVycyA9IHF1ZXJ5UGFyYW1ldGVycy5zZXQoJ3B1Ymxpc2gnLCA8YW55PnB1Ymxpc2gpO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IGhlYWRlcnMgPSB0aGlzLmRlZmF1bHRIZWFkZXJzO1xuXG4gICAgICAgIC8vIGF1dGhlbnRpY2F0aW9uIChiZWFyZXJBdXRoKSByZXF1aXJlZFxuICAgICAgICBpZiAodGhpcy5jb25maWd1cmF0aW9uLmFjY2Vzc1Rva2VuKSB7XG4gICAgICAgICAgICBjb25zdCBhY2Nlc3NUb2tlbiA9IHR5cGVvZiB0aGlzLmNvbmZpZ3VyYXRpb24uYWNjZXNzVG9rZW4gPT09ICdmdW5jdGlvbidcbiAgICAgICAgICAgICAgICA/IHRoaXMuY29uZmlndXJhdGlvbi5hY2Nlc3NUb2tlbigpXG4gICAgICAgICAgICAgICAgOiB0aGlzLmNvbmZpZ3VyYXRpb24uYWNjZXNzVG9rZW47XG4gICAgICAgICAgICBoZWFkZXJzID0gaGVhZGVycy5zZXQoJ0F1dGhvcml6YXRpb24nLCAnQmVhcmVyICcgKyBhY2Nlc3NUb2tlbik7XG4gICAgICAgIH1cbiAgICAgICAgLy8gdG8gZGV0ZXJtaW5lIHRoZSBBY2NlcHQgaGVhZGVyXG4gICAgICAgIGxldCBodHRwSGVhZGVyQWNjZXB0czogc3RyaW5nW10gPSBbXG4gICAgICAgICAgICAnYXBwbGljYXRpb24vanNvbidcbiAgICAgICAgXTtcbiAgICAgICAgY29uc3QgaHR0cEhlYWRlckFjY2VwdFNlbGVjdGVkOiBzdHJpbmcgfCB1bmRlZmluZWQgPSB0aGlzLmNvbmZpZ3VyYXRpb24uc2VsZWN0SGVhZGVyQWNjZXB0KGh0dHBIZWFkZXJBY2NlcHRzKTtcbiAgICAgICAgaWYgKGh0dHBIZWFkZXJBY2NlcHRTZWxlY3RlZCAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGhlYWRlcnMgPSBoZWFkZXJzLnNldCgnQWNjZXB0JywgaHR0cEhlYWRlckFjY2VwdFNlbGVjdGVkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHRvIGRldGVybWluZSB0aGUgQ29udGVudC1UeXBlIGhlYWRlclxuICAgICAgICBjb25zdCBjb25zdW1lczogc3RyaW5nW10gPSBbXG4gICAgICAgIF07XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cENsaWVudC5yZXF1ZXN0PFJ1bGU+KCdkZWxldGUnLGAke3RoaXMuYmFzZVBhdGh9L3J1bGVzL3RleHQvJHtlbmNvZGVVUklDb21wb25lbnQoU3RyaW5nKHRleHQpKX0vZmxhZ3MvJHtlbmNvZGVVUklDb21wb25lbnQoU3RyaW5nKGZsYWcpKX1gLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHBhcmFtczogcXVlcnlQYXJhbWV0ZXJzLFxuICAgICAgICAgICAgICAgIHdpdGhDcmVkZW50aWFsczogdGhpcy5jb25maWd1cmF0aW9uLndpdGhDcmVkZW50aWFscyxcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiBoZWFkZXJzLFxuICAgICAgICAgICAgICAgIG9ic2VydmU6IG9ic2VydmUsXG4gICAgICAgICAgICAgICAgcmVwb3J0UHJvZ3Jlc3M6IHJlcG9ydFByb2dyZXNzXG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRGVsZXRlIGEgbGVldCBtYXBwaW5nIGZvciBhIHJ1bGVcbiAgICAgKiBUaGlzIHdpbGwgZGVsZXRlIGEgbGVldCBtYXBwaW5nIGZvciBydWxlIGFuZCBsb2cgdGhlIGNoYW5nZVxuICAgICAqIEBwYXJhbSB0ZXh0IFRoZSB0ZXh0IG9mIHRoZSBydWxlIHlvdSB3YW50IHRvIHdvcmsgb25cbiAgICAgKiBAcGFyYW0gbGFuZ3VhZ2UgU2hvdyByZXN1bHRzIGZvciB0aGUgZ2l2ZW4gbGFuZ3VhZ2Ugb25seS4gICBUaGlzIGlzIHRoZSBsYW5ndWFnZSB1c2VkLCBjb3VsZCBoYXZlIGJlZW4gc2V0IGJ5IHRoZSB1c2VyIG9yIGRldGVjdGVkIGJ5IGxhbmd1YWdlIGlkLlxuICAgICAqIEBwYXJhbSBkZXBlbmRlbmN5IFRoaXMgaXMgdGhlIHJlbGF0ZWQgdGV4dCB5b3Ugd2FudCB0byB3b3JrIG9uLlxuICAgICAqIEBwYXJhbSBjbGllbnRJZCBTaG93IHJlc3VsdHMgZm9yIGEgZ2l2ZW4gY2xpZW50LiAgVHlwaWNhbGx5IHRoaXMgaXMgc2V0IGZvciB5b3UgYnkgdGhlIGludGVybmFsIHN5c3RlbSBiYXNlZCBvbiB0aGUgQVBJX0tFWSB5b3UgYXJlIHVzaW5nLiAgSG93ZXZlciBzb21lIGNsaWVudHMgYXJlIGFsbG93ZWQgdG8gdmlldyBvdGhlciBjbGllbnRzIHN1Y2ggYXMgd2hlbiB0aGV5IGhhdmUgYSBzYW5kYm94IG9yIHdoZW4gdGhleSBhcmUgYSBsYXJnZSBlbnRlcnByaXNlIGFuZCBoYXZlIG11bHRpcGxlIGNsaWVudHMgdGhleSBtYW5hZ2UuICBJdCB3aWxsIG9ubHkgYWxsb3cgeW91IHRvIHZpZXcgY2xpZW50IGRhdGEgeW91IGhhdmUgYWNjZXNzIHRvLlxuICAgICAqIEBwYXJhbSBwdWJsaXNoIFRoaXMgd2lsbCBhbHNvIG1ha2UgdGhlIHJ1bGUgbGl2ZVxuICAgICAqIEBwYXJhbSBvYnNlcnZlIHNldCB3aGV0aGVyIG9yIG5vdCB0byByZXR1cm4gdGhlIGRhdGEgT2JzZXJ2YWJsZSBhcyB0aGUgYm9keSwgcmVzcG9uc2Ugb3IgZXZlbnRzLiBkZWZhdWx0cyB0byByZXR1cm5pbmcgdGhlIGJvZHkuXG4gICAgICogQHBhcmFtIHJlcG9ydFByb2dyZXNzIGZsYWcgdG8gcmVwb3J0IHJlcXVlc3QgYW5kIHJlc3BvbnNlIHByb2dyZXNzLlxuICAgICAqL1xuICAgIHB1YmxpYyBkZWxldGVMZWV0TWFwcGluZyh0ZXh0OiBzdHJpbmcsIGxhbmd1YWdlOiBzdHJpbmcsIGRlcGVuZGVuY3k6IFJ1bGVUZXh0LCBjbGllbnRJZD86IG51bWJlciwgcHVibGlzaD86IGJvb2xlYW4sIG9ic2VydmU/OiAnYm9keScsIHJlcG9ydFByb2dyZXNzPzogYm9vbGVhbik6IE9ic2VydmFibGU8UnVsZT47XG4gICAgcHVibGljIGRlbGV0ZUxlZXRNYXBwaW5nKHRleHQ6IHN0cmluZywgbGFuZ3VhZ2U6IHN0cmluZywgZGVwZW5kZW5jeTogUnVsZVRleHQsIGNsaWVudElkPzogbnVtYmVyLCBwdWJsaXNoPzogYm9vbGVhbiwgb2JzZXJ2ZT86ICdyZXNwb25zZScsIHJlcG9ydFByb2dyZXNzPzogYm9vbGVhbik6IE9ic2VydmFibGU8SHR0cFJlc3BvbnNlPFJ1bGU+PjtcbiAgICBwdWJsaWMgZGVsZXRlTGVldE1hcHBpbmcodGV4dDogc3RyaW5nLCBsYW5ndWFnZTogc3RyaW5nLCBkZXBlbmRlbmN5OiBSdWxlVGV4dCwgY2xpZW50SWQ/OiBudW1iZXIsIHB1Ymxpc2g/OiBib29sZWFuLCBvYnNlcnZlPzogJ2V2ZW50cycsIHJlcG9ydFByb2dyZXNzPzogYm9vbGVhbik6IE9ic2VydmFibGU8SHR0cEV2ZW50PFJ1bGU+PjtcbiAgICBwdWJsaWMgZGVsZXRlTGVldE1hcHBpbmcodGV4dDogc3RyaW5nLCBsYW5ndWFnZTogc3RyaW5nLCBkZXBlbmRlbmN5OiBSdWxlVGV4dCwgY2xpZW50SWQ/OiBudW1iZXIsIHB1Ymxpc2g/OiBib29sZWFuLCBvYnNlcnZlOiBhbnkgPSAnYm9keScsIHJlcG9ydFByb2dyZXNzOiBib29sZWFuID0gZmFsc2UgKTogT2JzZXJ2YWJsZTxhbnk+IHtcblxuICAgICAgICBpZiAodGV4dCA9PT0gbnVsbCB8fCB0ZXh0ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignUmVxdWlyZWQgcGFyYW1ldGVyIHRleHQgd2FzIG51bGwgb3IgdW5kZWZpbmVkIHdoZW4gY2FsbGluZyBkZWxldGVMZWV0TWFwcGluZy4nKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChsYW5ndWFnZSA9PT0gbnVsbCB8fCBsYW5ndWFnZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1JlcXVpcmVkIHBhcmFtZXRlciBsYW5ndWFnZSB3YXMgbnVsbCBvciB1bmRlZmluZWQgd2hlbiBjYWxsaW5nIGRlbGV0ZUxlZXRNYXBwaW5nLicpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGRlcGVuZGVuY3kgPT09IG51bGwgfHwgZGVwZW5kZW5jeSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1JlcXVpcmVkIHBhcmFtZXRlciBkZXBlbmRlbmN5IHdhcyBudWxsIG9yIHVuZGVmaW5lZCB3aGVuIGNhbGxpbmcgZGVsZXRlTGVldE1hcHBpbmcuJyk7XG4gICAgICAgIH1cblxuXG5cbiAgICAgICAgbGV0IHF1ZXJ5UGFyYW1ldGVycyA9IG5ldyBIdHRwUGFyYW1zKHtlbmNvZGVyOiBuZXcgQ3VzdG9tSHR0cFVybEVuY29kaW5nQ29kZWMoKX0pO1xuICAgICAgICBpZiAobGFuZ3VhZ2UgIT09IHVuZGVmaW5lZCAmJiBsYW5ndWFnZSAhPT0gbnVsbCkge1xuICAgICAgICAgICAgcXVlcnlQYXJhbWV0ZXJzID0gcXVlcnlQYXJhbWV0ZXJzLnNldCgnbGFuZ3VhZ2UnLCA8YW55Pmxhbmd1YWdlKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY2xpZW50SWQgIT09IHVuZGVmaW5lZCAmJiBjbGllbnRJZCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgcXVlcnlQYXJhbWV0ZXJzID0gcXVlcnlQYXJhbWV0ZXJzLnNldCgnY2xpZW50SWQnLCA8YW55PmNsaWVudElkKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocHVibGlzaCAhPT0gdW5kZWZpbmVkICYmIHB1Ymxpc2ggIT09IG51bGwpIHtcbiAgICAgICAgICAgIHF1ZXJ5UGFyYW1ldGVycyA9IHF1ZXJ5UGFyYW1ldGVycy5zZXQoJ3B1Ymxpc2gnLCA8YW55PnB1Ymxpc2gpO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IGhlYWRlcnMgPSB0aGlzLmRlZmF1bHRIZWFkZXJzO1xuXG4gICAgICAgIC8vIGF1dGhlbnRpY2F0aW9uIChiZWFyZXJBdXRoKSByZXF1aXJlZFxuICAgICAgICBpZiAodGhpcy5jb25maWd1cmF0aW9uLmFjY2Vzc1Rva2VuKSB7XG4gICAgICAgICAgICBjb25zdCBhY2Nlc3NUb2tlbiA9IHR5cGVvZiB0aGlzLmNvbmZpZ3VyYXRpb24uYWNjZXNzVG9rZW4gPT09ICdmdW5jdGlvbidcbiAgICAgICAgICAgICAgICA/IHRoaXMuY29uZmlndXJhdGlvbi5hY2Nlc3NUb2tlbigpXG4gICAgICAgICAgICAgICAgOiB0aGlzLmNvbmZpZ3VyYXRpb24uYWNjZXNzVG9rZW47XG4gICAgICAgICAgICBoZWFkZXJzID0gaGVhZGVycy5zZXQoJ0F1dGhvcml6YXRpb24nLCAnQmVhcmVyICcgKyBhY2Nlc3NUb2tlbik7XG4gICAgICAgIH1cbiAgICAgICAgLy8gdG8gZGV0ZXJtaW5lIHRoZSBBY2NlcHQgaGVhZGVyXG4gICAgICAgIGxldCBodHRwSGVhZGVyQWNjZXB0czogc3RyaW5nW10gPSBbXG4gICAgICAgICAgICAnYXBwbGljYXRpb24vanNvbidcbiAgICAgICAgXTtcbiAgICAgICAgY29uc3QgaHR0cEhlYWRlckFjY2VwdFNlbGVjdGVkOiBzdHJpbmcgfCB1bmRlZmluZWQgPSB0aGlzLmNvbmZpZ3VyYXRpb24uc2VsZWN0SGVhZGVyQWNjZXB0KGh0dHBIZWFkZXJBY2NlcHRzKTtcbiAgICAgICAgaWYgKGh0dHBIZWFkZXJBY2NlcHRTZWxlY3RlZCAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGhlYWRlcnMgPSBoZWFkZXJzLnNldCgnQWNjZXB0JywgaHR0cEhlYWRlckFjY2VwdFNlbGVjdGVkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHRvIGRldGVybWluZSB0aGUgQ29udGVudC1UeXBlIGhlYWRlclxuICAgICAgICBjb25zdCBjb25zdW1lczogc3RyaW5nW10gPSBbXG4gICAgICAgIF07XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cENsaWVudC5yZXF1ZXN0PFJ1bGU+KCdkZWxldGUnLGAke3RoaXMuYmFzZVBhdGh9L3J1bGVzL3RleHQvJHtlbmNvZGVVUklDb21wb25lbnQoU3RyaW5nKHRleHQpKX0vbGVldF9tYXBwaW5ncy8ke2VuY29kZVVSSUNvbXBvbmVudChTdHJpbmcoZGVwZW5kZW5jeSkpfWAsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgcGFyYW1zOiBxdWVyeVBhcmFtZXRlcnMsXG4gICAgICAgICAgICAgICAgd2l0aENyZWRlbnRpYWxzOiB0aGlzLmNvbmZpZ3VyYXRpb24ud2l0aENyZWRlbnRpYWxzLFxuICAgICAgICAgICAgICAgIGhlYWRlcnM6IGhlYWRlcnMsXG4gICAgICAgICAgICAgICAgb2JzZXJ2ZTogb2JzZXJ2ZSxcbiAgICAgICAgICAgICAgICByZXBvcnRQcm9ncmVzczogcmVwb3J0UHJvZ3Jlc3NcbiAgICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBEZWxldGUgYSBydWxlXG4gICAgICogVGhpcyB3aWxsIGRlbGV0ZSBhIHJ1bGUgYW5kIGxvZyB0aGUgY2hhbmdlXG4gICAgICogQHBhcmFtIHRleHQgVGhlIHRleHQgb2YgdGhlIHJ1bGUgeW91IHdhbnQgdG8gd29yayBvblxuICAgICAqIEBwYXJhbSBsYW5ndWFnZSBTaG93IHJlc3VsdHMgZm9yIHRoZSBnaXZlbiBsYW5ndWFnZSBvbmx5LiAgIFRoaXMgaXMgdGhlIGxhbmd1YWdlIHVzZWQsIGNvdWxkIGhhdmUgYmVlbiBzZXQgYnkgdGhlIHVzZXIgb3IgZGV0ZWN0ZWQgYnkgbGFuZ3VhZ2UgaWQuXG4gICAgICogQHBhcmFtIGNsaWVudElkIFNob3cgcmVzdWx0cyBmb3IgYSBnaXZlbiBjbGllbnQuICBUeXBpY2FsbHkgdGhpcyBpcyBzZXQgZm9yIHlvdSBieSB0aGUgaW50ZXJuYWwgc3lzdGVtIGJhc2VkIG9uIHRoZSBBUElfS0VZIHlvdSBhcmUgdXNpbmcuICBIb3dldmVyIHNvbWUgY2xpZW50cyBhcmUgYWxsb3dlZCB0byB2aWV3IG90aGVyIGNsaWVudHMgc3VjaCBhcyB3aGVuIHRoZXkgaGF2ZSBhIHNhbmRib3ggb3Igd2hlbiB0aGV5IGFyZSBhIGxhcmdlIGVudGVycHJpc2UgYW5kIGhhdmUgbXVsdGlwbGUgY2xpZW50cyB0aGV5IG1hbmFnZS4gIEl0IHdpbGwgb25seSBhbGxvdyB5b3UgdG8gdmlldyBjbGllbnQgZGF0YSB5b3UgaGF2ZSBhY2Nlc3MgdG8uXG4gICAgICogQHBhcmFtIHB1Ymxpc2ggVGhpcyB3aWxsIGFsc28gbWFrZSB0aGUgcnVsZSBsaXZlXG4gICAgICogQHBhcmFtIG9ic2VydmUgc2V0IHdoZXRoZXIgb3Igbm90IHRvIHJldHVybiB0aGUgZGF0YSBPYnNlcnZhYmxlIGFzIHRoZSBib2R5LCByZXNwb25zZSBvciBldmVudHMuIGRlZmF1bHRzIHRvIHJldHVybmluZyB0aGUgYm9keS5cbiAgICAgKiBAcGFyYW0gcmVwb3J0UHJvZ3Jlc3MgZmxhZyB0byByZXBvcnQgcmVxdWVzdCBhbmQgcmVzcG9uc2UgcHJvZ3Jlc3MuXG4gICAgICovXG4gICAgcHVibGljIGRlbGV0ZVJ1bGUodGV4dDogc3RyaW5nLCBsYW5ndWFnZTogc3RyaW5nLCBjbGllbnRJZD86IG51bWJlciwgcHVibGlzaD86IGJvb2xlYW4sIG9ic2VydmU/OiAnYm9keScsIHJlcG9ydFByb2dyZXNzPzogYm9vbGVhbik6IE9ic2VydmFibGU8YW55PjtcbiAgICBwdWJsaWMgZGVsZXRlUnVsZSh0ZXh0OiBzdHJpbmcsIGxhbmd1YWdlOiBzdHJpbmcsIGNsaWVudElkPzogbnVtYmVyLCBwdWJsaXNoPzogYm9vbGVhbiwgb2JzZXJ2ZT86ICdyZXNwb25zZScsIHJlcG9ydFByb2dyZXNzPzogYm9vbGVhbik6IE9ic2VydmFibGU8SHR0cFJlc3BvbnNlPGFueT4+O1xuICAgIHB1YmxpYyBkZWxldGVSdWxlKHRleHQ6IHN0cmluZywgbGFuZ3VhZ2U6IHN0cmluZywgY2xpZW50SWQ/OiBudW1iZXIsIHB1Ymxpc2g/OiBib29sZWFuLCBvYnNlcnZlPzogJ2V2ZW50cycsIHJlcG9ydFByb2dyZXNzPzogYm9vbGVhbik6IE9ic2VydmFibGU8SHR0cEV2ZW50PGFueT4+O1xuICAgIHB1YmxpYyBkZWxldGVSdWxlKHRleHQ6IHN0cmluZywgbGFuZ3VhZ2U6IHN0cmluZywgY2xpZW50SWQ/OiBudW1iZXIsIHB1Ymxpc2g/OiBib29sZWFuLCBvYnNlcnZlOiBhbnkgPSAnYm9keScsIHJlcG9ydFByb2dyZXNzOiBib29sZWFuID0gZmFsc2UgKTogT2JzZXJ2YWJsZTxhbnk+IHtcblxuICAgICAgICBpZiAodGV4dCA9PT0gbnVsbCB8fCB0ZXh0ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignUmVxdWlyZWQgcGFyYW1ldGVyIHRleHQgd2FzIG51bGwgb3IgdW5kZWZpbmVkIHdoZW4gY2FsbGluZyBkZWxldGVSdWxlLicpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGxhbmd1YWdlID09PSBudWxsIHx8IGxhbmd1YWdlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignUmVxdWlyZWQgcGFyYW1ldGVyIGxhbmd1YWdlIHdhcyBudWxsIG9yIHVuZGVmaW5lZCB3aGVuIGNhbGxpbmcgZGVsZXRlUnVsZS4nKTtcbiAgICAgICAgfVxuXG5cblxuICAgICAgICBsZXQgcXVlcnlQYXJhbWV0ZXJzID0gbmV3IEh0dHBQYXJhbXMoe2VuY29kZXI6IG5ldyBDdXN0b21IdHRwVXJsRW5jb2RpbmdDb2RlYygpfSk7XG4gICAgICAgIGlmIChsYW5ndWFnZSAhPT0gdW5kZWZpbmVkICYmIGxhbmd1YWdlICE9PSBudWxsKSB7XG4gICAgICAgICAgICBxdWVyeVBhcmFtZXRlcnMgPSBxdWVyeVBhcmFtZXRlcnMuc2V0KCdsYW5ndWFnZScsIDxhbnk+bGFuZ3VhZ2UpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjbGllbnRJZCAhPT0gdW5kZWZpbmVkICYmIGNsaWVudElkICE9PSBudWxsKSB7XG4gICAgICAgICAgICBxdWVyeVBhcmFtZXRlcnMgPSBxdWVyeVBhcmFtZXRlcnMuc2V0KCdjbGllbnRJZCcsIDxhbnk+Y2xpZW50SWQpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChwdWJsaXNoICE9PSB1bmRlZmluZWQgJiYgcHVibGlzaCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgcXVlcnlQYXJhbWV0ZXJzID0gcXVlcnlQYXJhbWV0ZXJzLnNldCgncHVibGlzaCcsIDxhbnk+cHVibGlzaCk7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgaGVhZGVycyA9IHRoaXMuZGVmYXVsdEhlYWRlcnM7XG5cbiAgICAgICAgLy8gYXV0aGVudGljYXRpb24gKGJlYXJlckF1dGgpIHJlcXVpcmVkXG4gICAgICAgIGlmICh0aGlzLmNvbmZpZ3VyYXRpb24uYWNjZXNzVG9rZW4pIHtcbiAgICAgICAgICAgIGNvbnN0IGFjY2Vzc1Rva2VuID0gdHlwZW9mIHRoaXMuY29uZmlndXJhdGlvbi5hY2Nlc3NUb2tlbiA9PT0gJ2Z1bmN0aW9uJ1xuICAgICAgICAgICAgICAgID8gdGhpcy5jb25maWd1cmF0aW9uLmFjY2Vzc1Rva2VuKClcbiAgICAgICAgICAgICAgICA6IHRoaXMuY29uZmlndXJhdGlvbi5hY2Nlc3NUb2tlbjtcbiAgICAgICAgICAgIGhlYWRlcnMgPSBoZWFkZXJzLnNldCgnQXV0aG9yaXphdGlvbicsICdCZWFyZXIgJyArIGFjY2Vzc1Rva2VuKTtcbiAgICAgICAgfVxuICAgICAgICAvLyB0byBkZXRlcm1pbmUgdGhlIEFjY2VwdCBoZWFkZXJcbiAgICAgICAgbGV0IGh0dHBIZWFkZXJBY2NlcHRzOiBzdHJpbmdbXSA9IFtcbiAgICAgICAgICAgICdhcHBsaWNhdGlvbi9qc29uJ1xuICAgICAgICBdO1xuICAgICAgICBjb25zdCBodHRwSGVhZGVyQWNjZXB0U2VsZWN0ZWQ6IHN0cmluZyB8IHVuZGVmaW5lZCA9IHRoaXMuY29uZmlndXJhdGlvbi5zZWxlY3RIZWFkZXJBY2NlcHQoaHR0cEhlYWRlckFjY2VwdHMpO1xuICAgICAgICBpZiAoaHR0cEhlYWRlckFjY2VwdFNlbGVjdGVkICE9IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgaGVhZGVycyA9IGhlYWRlcnMuc2V0KCdBY2NlcHQnLCBodHRwSGVhZGVyQWNjZXB0U2VsZWN0ZWQpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gdG8gZGV0ZXJtaW5lIHRoZSBDb250ZW50LVR5cGUgaGVhZGVyXG4gICAgICAgIGNvbnN0IGNvbnN1bWVzOiBzdHJpbmdbXSA9IFtcbiAgICAgICAgXTtcblxuICAgICAgICByZXR1cm4gdGhpcy5odHRwQ2xpZW50LnJlcXVlc3Q8YW55PignZGVsZXRlJyxgJHt0aGlzLmJhc2VQYXRofS9ydWxlcy90ZXh0LyR7ZW5jb2RlVVJJQ29tcG9uZW50KFN0cmluZyh0ZXh0KSl9YCxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBwYXJhbXM6IHF1ZXJ5UGFyYW1ldGVycyxcbiAgICAgICAgICAgICAgICB3aXRoQ3JlZGVudGlhbHM6IHRoaXMuY29uZmlndXJhdGlvbi53aXRoQ3JlZGVudGlhbHMsXG4gICAgICAgICAgICAgICAgaGVhZGVyczogaGVhZGVycyxcbiAgICAgICAgICAgICAgICBvYnNlcnZlOiBvYnNlcnZlLFxuICAgICAgICAgICAgICAgIHJlcG9ydFByb2dyZXNzOiByZXBvcnRQcm9ncmVzc1xuICAgICAgICAgICAgfVxuICAgICAgICApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIERlbGV0ZSBhIHRvcGljIGZvciBhIHJ1bGVcbiAgICAgKiBUaGlzIHdpbGwgZGVsZXRlIGEgdG9waWMgZm9yIHJ1bGUgYW5kIGxvZyB0aGUgY2hhbmdlXG4gICAgICogQHBhcmFtIHRleHQgVGhlIHRleHQgb2YgdGhlIHJ1bGUgeW91IHdhbnQgdG8gd29yayBvblxuICAgICAqIEBwYXJhbSBsYW5ndWFnZSBTaG93IHJlc3VsdHMgZm9yIHRoZSBnaXZlbiBsYW5ndWFnZSBvbmx5LiAgIFRoaXMgaXMgdGhlIGxhbmd1YWdlIHVzZWQsIGNvdWxkIGhhdmUgYmVlbiBzZXQgYnkgdGhlIHVzZXIgb3IgZGV0ZWN0ZWQgYnkgbGFuZ3VhZ2UgaWQuXG4gICAgICogQHBhcmFtIHRvcGljSWQgVGhlIHRvcGljIGlzIHRoZSBpZCBmb3IgdG9waWMuICBTZWUgZG9jdW1lbnRhdGlvbiBvbiBUb3BpYyBmb3Igd2hhdCB0aGUgaWRzIGFyZVxuICAgICAqIEBwYXJhbSBjbGllbnRJZCBTaG93IHJlc3VsdHMgZm9yIGEgZ2l2ZW4gY2xpZW50LiAgVHlwaWNhbGx5IHRoaXMgaXMgc2V0IGZvciB5b3UgYnkgdGhlIGludGVybmFsIHN5c3RlbSBiYXNlZCBvbiB0aGUgQVBJX0tFWSB5b3UgYXJlIHVzaW5nLiAgSG93ZXZlciBzb21lIGNsaWVudHMgYXJlIGFsbG93ZWQgdG8gdmlldyBvdGhlciBjbGllbnRzIHN1Y2ggYXMgd2hlbiB0aGV5IGhhdmUgYSBzYW5kYm94IG9yIHdoZW4gdGhleSBhcmUgYSBsYXJnZSBlbnRlcnByaXNlIGFuZCBoYXZlIG11bHRpcGxlIGNsaWVudHMgdGhleSBtYW5hZ2UuICBJdCB3aWxsIG9ubHkgYWxsb3cgeW91IHRvIHZpZXcgY2xpZW50IGRhdGEgeW91IGhhdmUgYWNjZXNzIHRvLlxuICAgICAqIEBwYXJhbSBwdWJsaXNoIFRoaXMgd2lsbCBhbHNvIG1ha2UgdGhlIHJ1bGUgbGl2ZVxuICAgICAqIEBwYXJhbSBvYnNlcnZlIHNldCB3aGV0aGVyIG9yIG5vdCB0byByZXR1cm4gdGhlIGRhdGEgT2JzZXJ2YWJsZSBhcyB0aGUgYm9keSwgcmVzcG9uc2Ugb3IgZXZlbnRzLiBkZWZhdWx0cyB0byByZXR1cm5pbmcgdGhlIGJvZHkuXG4gICAgICogQHBhcmFtIHJlcG9ydFByb2dyZXNzIGZsYWcgdG8gcmVwb3J0IHJlcXVlc3QgYW5kIHJlc3BvbnNlIHByb2dyZXNzLlxuICAgICAqL1xuICAgIHB1YmxpYyBkZWxldGVUb3BpYyh0ZXh0OiBzdHJpbmcsIGxhbmd1YWdlOiBzdHJpbmcsIHRvcGljSWQ6IG51bWJlciwgY2xpZW50SWQ/OiBudW1iZXIsIHB1Ymxpc2g/OiBib29sZWFuLCBvYnNlcnZlPzogJ2JvZHknLCByZXBvcnRQcm9ncmVzcz86IGJvb2xlYW4pOiBPYnNlcnZhYmxlPFJ1bGU+O1xuICAgIHB1YmxpYyBkZWxldGVUb3BpYyh0ZXh0OiBzdHJpbmcsIGxhbmd1YWdlOiBzdHJpbmcsIHRvcGljSWQ6IG51bWJlciwgY2xpZW50SWQ/OiBudW1iZXIsIHB1Ymxpc2g/OiBib29sZWFuLCBvYnNlcnZlPzogJ3Jlc3BvbnNlJywgcmVwb3J0UHJvZ3Jlc3M/OiBib29sZWFuKTogT2JzZXJ2YWJsZTxIdHRwUmVzcG9uc2U8UnVsZT4+O1xuICAgIHB1YmxpYyBkZWxldGVUb3BpYyh0ZXh0OiBzdHJpbmcsIGxhbmd1YWdlOiBzdHJpbmcsIHRvcGljSWQ6IG51bWJlciwgY2xpZW50SWQ/OiBudW1iZXIsIHB1Ymxpc2g/OiBib29sZWFuLCBvYnNlcnZlPzogJ2V2ZW50cycsIHJlcG9ydFByb2dyZXNzPzogYm9vbGVhbik6IE9ic2VydmFibGU8SHR0cEV2ZW50PFJ1bGU+PjtcbiAgICBwdWJsaWMgZGVsZXRlVG9waWModGV4dDogc3RyaW5nLCBsYW5ndWFnZTogc3RyaW5nLCB0b3BpY0lkOiBudW1iZXIsIGNsaWVudElkPzogbnVtYmVyLCBwdWJsaXNoPzogYm9vbGVhbiwgb2JzZXJ2ZTogYW55ID0gJ2JvZHknLCByZXBvcnRQcm9ncmVzczogYm9vbGVhbiA9IGZhbHNlICk6IE9ic2VydmFibGU8YW55PiB7XG5cbiAgICAgICAgaWYgKHRleHQgPT09IG51bGwgfHwgdGV4dCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1JlcXVpcmVkIHBhcmFtZXRlciB0ZXh0IHdhcyBudWxsIG9yIHVuZGVmaW5lZCB3aGVuIGNhbGxpbmcgZGVsZXRlVG9waWMuJyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAobGFuZ3VhZ2UgPT09IG51bGwgfHwgbGFuZ3VhZ2UgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZXF1aXJlZCBwYXJhbWV0ZXIgbGFuZ3VhZ2Ugd2FzIG51bGwgb3IgdW5kZWZpbmVkIHdoZW4gY2FsbGluZyBkZWxldGVUb3BpYy4nKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0b3BpY0lkID09PSBudWxsIHx8IHRvcGljSWQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZXF1aXJlZCBwYXJhbWV0ZXIgdG9waWNJZCB3YXMgbnVsbCBvciB1bmRlZmluZWQgd2hlbiBjYWxsaW5nIGRlbGV0ZVRvcGljLicpO1xuICAgICAgICB9XG5cblxuXG4gICAgICAgIGxldCBxdWVyeVBhcmFtZXRlcnMgPSBuZXcgSHR0cFBhcmFtcyh7ZW5jb2RlcjogbmV3IEN1c3RvbUh0dHBVcmxFbmNvZGluZ0NvZGVjKCl9KTtcbiAgICAgICAgaWYgKGxhbmd1YWdlICE9PSB1bmRlZmluZWQgJiYgbGFuZ3VhZ2UgIT09IG51bGwpIHtcbiAgICAgICAgICAgIHF1ZXJ5UGFyYW1ldGVycyA9IHF1ZXJ5UGFyYW1ldGVycy5zZXQoJ2xhbmd1YWdlJywgPGFueT5sYW5ndWFnZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNsaWVudElkICE9PSB1bmRlZmluZWQgJiYgY2xpZW50SWQgIT09IG51bGwpIHtcbiAgICAgICAgICAgIHF1ZXJ5UGFyYW1ldGVycyA9IHF1ZXJ5UGFyYW1ldGVycy5zZXQoJ2NsaWVudElkJywgPGFueT5jbGllbnRJZCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHB1Ymxpc2ggIT09IHVuZGVmaW5lZCAmJiBwdWJsaXNoICE9PSBudWxsKSB7XG4gICAgICAgICAgICBxdWVyeVBhcmFtZXRlcnMgPSBxdWVyeVBhcmFtZXRlcnMuc2V0KCdwdWJsaXNoJywgPGFueT5wdWJsaXNoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBoZWFkZXJzID0gdGhpcy5kZWZhdWx0SGVhZGVycztcblxuICAgICAgICAvLyBhdXRoZW50aWNhdGlvbiAoYmVhcmVyQXV0aCkgcmVxdWlyZWRcbiAgICAgICAgaWYgKHRoaXMuY29uZmlndXJhdGlvbi5hY2Nlc3NUb2tlbikge1xuICAgICAgICAgICAgY29uc3QgYWNjZXNzVG9rZW4gPSB0eXBlb2YgdGhpcy5jb25maWd1cmF0aW9uLmFjY2Vzc1Rva2VuID09PSAnZnVuY3Rpb24nXG4gICAgICAgICAgICAgICAgPyB0aGlzLmNvbmZpZ3VyYXRpb24uYWNjZXNzVG9rZW4oKVxuICAgICAgICAgICAgICAgIDogdGhpcy5jb25maWd1cmF0aW9uLmFjY2Vzc1Rva2VuO1xuICAgICAgICAgICAgaGVhZGVycyA9IGhlYWRlcnMuc2V0KCdBdXRob3JpemF0aW9uJywgJ0JlYXJlciAnICsgYWNjZXNzVG9rZW4pO1xuICAgICAgICB9XG4gICAgICAgIC8vIHRvIGRldGVybWluZSB0aGUgQWNjZXB0IGhlYWRlclxuICAgICAgICBsZXQgaHR0cEhlYWRlckFjY2VwdHM6IHN0cmluZ1tdID0gW1xuICAgICAgICAgICAgJ2FwcGxpY2F0aW9uL2pzb24nXG4gICAgICAgIF07XG4gICAgICAgIGNvbnN0IGh0dHBIZWFkZXJBY2NlcHRTZWxlY3RlZDogc3RyaW5nIHwgdW5kZWZpbmVkID0gdGhpcy5jb25maWd1cmF0aW9uLnNlbGVjdEhlYWRlckFjY2VwdChodHRwSGVhZGVyQWNjZXB0cyk7XG4gICAgICAgIGlmIChodHRwSGVhZGVyQWNjZXB0U2VsZWN0ZWQgIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBoZWFkZXJzID0gaGVhZGVycy5zZXQoJ0FjY2VwdCcsIGh0dHBIZWFkZXJBY2NlcHRTZWxlY3RlZCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyB0byBkZXRlcm1pbmUgdGhlIENvbnRlbnQtVHlwZSBoZWFkZXJcbiAgICAgICAgY29uc3QgY29uc3VtZXM6IHN0cmluZ1tdID0gW1xuICAgICAgICBdO1xuXG4gICAgICAgIHJldHVybiB0aGlzLmh0dHBDbGllbnQucmVxdWVzdDxSdWxlPignZGVsZXRlJyxgJHt0aGlzLmJhc2VQYXRofS9ydWxlcy90ZXh0LyR7ZW5jb2RlVVJJQ29tcG9uZW50KFN0cmluZyh0ZXh0KSl9L3RvcGljLyR7ZW5jb2RlVVJJQ29tcG9uZW50KFN0cmluZyh0b3BpY0lkKSl9YCxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBwYXJhbXM6IHF1ZXJ5UGFyYW1ldGVycyxcbiAgICAgICAgICAgICAgICB3aXRoQ3JlZGVudGlhbHM6IHRoaXMuY29uZmlndXJhdGlvbi53aXRoQ3JlZGVudGlhbHMsXG4gICAgICAgICAgICAgICAgaGVhZGVyczogaGVhZGVycyxcbiAgICAgICAgICAgICAgICBvYnNlcnZlOiBvYnNlcnZlLFxuICAgICAgICAgICAgICAgIHJlcG9ydFByb2dyZXNzOiByZXBvcnRQcm9ncmVzc1xuICAgICAgICAgICAgfVxuICAgICAgICApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCBydWxlcyB0aGF0IG1hdGNoIHRoaXMgcHJlZml4XG4gICAgICogVXNlZCBmb3IgYXV0b2NvbXBsZXRlIHNvIHlvdSBjYW4gYWRkIGFsdGVybmF0ZSBzZW5zZXMgYW5kIGZpbGwgb3V0IHRoZSBydWxlIFxuICAgICAqIEBwYXJhbSBwcmVmaXggVGhlIHRlcm0geW91IHdhbnQgdG8gc2VhcmNoIGZvclxuICAgICAqIEBwYXJhbSBjbGllbnRJZHMgU2hvdyByZXN1bHRzIGZvciBhIHNldmVyYWwgZ2l2ZW4gY2xpZW50cy4gIFR5cGljYWxseSB0aGlzIGlzIHNldCBmb3IgeW91IGJ5IHRoZSBpbnRlcm5hbCBzeXN0ZW0gYmFzZWQgb24gdGhlIEFQSV9LRVkgeW91IGFyZSB1c2luZy4gIEhvd2V2ZXIgc29tZSBjbGllbnRzIGFyZSBhbGxvd2VkIHRvIHZpZXcgb3RoZXIgY2xpZW50cyBzdWNoIGFzIHdoZW4gdGhleSBoYXZlIGEgc2FuZGJveCBvciB3aGVuIHRoZXkgYXJlIGEgbGFyZ2UgZW50ZXJwcmlzZSBhbmQgaGF2ZSBtdWx0aXBsZSBjbGllbnRzIHRoZXkgbWFuYWdlLiAgSXQgd2lsbCBvbmx5IGFsbG93IHlvdSB0byB2aWV3IGNsaWVudCBkYXRhIHlvdSBoYXZlIGFjY2VzcyB0by5cbiAgICAgKiBAcGFyYW0gbGFuZ3VhZ2VzIFdoaWNoIGxhbmd1YWdlcyBkb2VzIHRoaXMgYXBwbHkgdG9cbiAgICAgKiBAcGFyYW0gbGltaXQgTGltaXQgdGhlIG51bWJlciBvZiByZXN1bHRzXG4gICAgICogQHBhcmFtIG9ic2VydmUgc2V0IHdoZXRoZXIgb3Igbm90IHRvIHJldHVybiB0aGUgZGF0YSBPYnNlcnZhYmxlIGFzIHRoZSBib2R5LCByZXNwb25zZSBvciBldmVudHMuIGRlZmF1bHRzIHRvIHJldHVybmluZyB0aGUgYm9keS5cbiAgICAgKiBAcGFyYW0gcmVwb3J0UHJvZ3Jlc3MgZmxhZyB0byByZXBvcnQgcmVxdWVzdCBhbmQgcmVzcG9uc2UgcHJvZ3Jlc3MuXG4gICAgICovXG4gICAgcHVibGljIGdldEF1dG9jb21wbGV0ZShwcmVmaXg6IHN0cmluZywgY2xpZW50SWRzPzogQXJyYXk8Q2xpZW50SWQ+LCBsYW5ndWFnZXM/OiBBcnJheTxzdHJpbmc+LCBsaW1pdD86IG51bWJlciwgb2JzZXJ2ZT86ICdib2R5JywgcmVwb3J0UHJvZ3Jlc3M/OiBib29sZWFuKTogT2JzZXJ2YWJsZTxBcnJheTxSdWxlVGV4dD4+O1xuICAgIHB1YmxpYyBnZXRBdXRvY29tcGxldGUocHJlZml4OiBzdHJpbmcsIGNsaWVudElkcz86IEFycmF5PENsaWVudElkPiwgbGFuZ3VhZ2VzPzogQXJyYXk8c3RyaW5nPiwgbGltaXQ/OiBudW1iZXIsIG9ic2VydmU/OiAncmVzcG9uc2UnLCByZXBvcnRQcm9ncmVzcz86IGJvb2xlYW4pOiBPYnNlcnZhYmxlPEh0dHBSZXNwb25zZTxBcnJheTxSdWxlVGV4dD4+PjtcbiAgICBwdWJsaWMgZ2V0QXV0b2NvbXBsZXRlKHByZWZpeDogc3RyaW5nLCBjbGllbnRJZHM/OiBBcnJheTxDbGllbnRJZD4sIGxhbmd1YWdlcz86IEFycmF5PHN0cmluZz4sIGxpbWl0PzogbnVtYmVyLCBvYnNlcnZlPzogJ2V2ZW50cycsIHJlcG9ydFByb2dyZXNzPzogYm9vbGVhbik6IE9ic2VydmFibGU8SHR0cEV2ZW50PEFycmF5PFJ1bGVUZXh0Pj4+O1xuICAgIHB1YmxpYyBnZXRBdXRvY29tcGxldGUocHJlZml4OiBzdHJpbmcsIGNsaWVudElkcz86IEFycmF5PENsaWVudElkPiwgbGFuZ3VhZ2VzPzogQXJyYXk8c3RyaW5nPiwgbGltaXQ/OiBudW1iZXIsIG9ic2VydmU6IGFueSA9ICdib2R5JywgcmVwb3J0UHJvZ3Jlc3M6IGJvb2xlYW4gPSBmYWxzZSApOiBPYnNlcnZhYmxlPGFueT4ge1xuXG4gICAgICAgIGlmIChwcmVmaXggPT09IG51bGwgfHwgcHJlZml4ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignUmVxdWlyZWQgcGFyYW1ldGVyIHByZWZpeCB3YXMgbnVsbCBvciB1bmRlZmluZWQgd2hlbiBjYWxsaW5nIGdldEF1dG9jb21wbGV0ZS4nKTtcbiAgICAgICAgfVxuXG5cblxuXG4gICAgICAgIGxldCBxdWVyeVBhcmFtZXRlcnMgPSBuZXcgSHR0cFBhcmFtcyh7ZW5jb2RlcjogbmV3IEN1c3RvbUh0dHBVcmxFbmNvZGluZ0NvZGVjKCl9KTtcbiAgICAgICAgaWYgKGNsaWVudElkcykge1xuICAgICAgICAgICAgY2xpZW50SWRzLmZvckVhY2goKGVsZW1lbnQpID0+IHtcbiAgICAgICAgICAgICAgICBxdWVyeVBhcmFtZXRlcnMgPSBxdWVyeVBhcmFtZXRlcnMuYXBwZW5kKCdjbGllbnRJZHMnLCA8YW55PmVsZW1lbnQpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgICAgICBpZiAobGFuZ3VhZ2VzKSB7XG4gICAgICAgICAgICBsYW5ndWFnZXMuZm9yRWFjaCgoZWxlbWVudCkgPT4ge1xuICAgICAgICAgICAgICAgIHF1ZXJ5UGFyYW1ldGVycyA9IHF1ZXJ5UGFyYW1ldGVycy5hcHBlbmQoJ2xhbmd1YWdlcycsIDxhbnk+ZWxlbWVudCk7XG4gICAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgICAgIGlmIChsaW1pdCAhPT0gdW5kZWZpbmVkICYmIGxpbWl0ICE9PSBudWxsKSB7XG4gICAgICAgICAgICBxdWVyeVBhcmFtZXRlcnMgPSBxdWVyeVBhcmFtZXRlcnMuc2V0KCdsaW1pdCcsIDxhbnk+bGltaXQpO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IGhlYWRlcnMgPSB0aGlzLmRlZmF1bHRIZWFkZXJzO1xuXG4gICAgICAgIC8vIGF1dGhlbnRpY2F0aW9uIChiZWFyZXJBdXRoKSByZXF1aXJlZFxuICAgICAgICBpZiAodGhpcy5jb25maWd1cmF0aW9uLmFjY2Vzc1Rva2VuKSB7XG4gICAgICAgICAgICBjb25zdCBhY2Nlc3NUb2tlbiA9IHR5cGVvZiB0aGlzLmNvbmZpZ3VyYXRpb24uYWNjZXNzVG9rZW4gPT09ICdmdW5jdGlvbidcbiAgICAgICAgICAgICAgICA/IHRoaXMuY29uZmlndXJhdGlvbi5hY2Nlc3NUb2tlbigpXG4gICAgICAgICAgICAgICAgOiB0aGlzLmNvbmZpZ3VyYXRpb24uYWNjZXNzVG9rZW47XG4gICAgICAgICAgICBoZWFkZXJzID0gaGVhZGVycy5zZXQoJ0F1dGhvcml6YXRpb24nLCAnQmVhcmVyICcgKyBhY2Nlc3NUb2tlbik7XG4gICAgICAgIH1cbiAgICAgICAgLy8gdG8gZGV0ZXJtaW5lIHRoZSBBY2NlcHQgaGVhZGVyXG4gICAgICAgIGxldCBodHRwSGVhZGVyQWNjZXB0czogc3RyaW5nW10gPSBbXG4gICAgICAgICAgICAnYXBwbGljYXRpb24vanNvbidcbiAgICAgICAgXTtcbiAgICAgICAgY29uc3QgaHR0cEhlYWRlckFjY2VwdFNlbGVjdGVkOiBzdHJpbmcgfCB1bmRlZmluZWQgPSB0aGlzLmNvbmZpZ3VyYXRpb24uc2VsZWN0SGVhZGVyQWNjZXB0KGh0dHBIZWFkZXJBY2NlcHRzKTtcbiAgICAgICAgaWYgKGh0dHBIZWFkZXJBY2NlcHRTZWxlY3RlZCAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGhlYWRlcnMgPSBoZWFkZXJzLnNldCgnQWNjZXB0JywgaHR0cEhlYWRlckFjY2VwdFNlbGVjdGVkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHRvIGRldGVybWluZSB0aGUgQ29udGVudC1UeXBlIGhlYWRlclxuICAgICAgICBjb25zdCBjb25zdW1lczogc3RyaW5nW10gPSBbXG4gICAgICAgIF07XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cENsaWVudC5yZXF1ZXN0PEFycmF5PFJ1bGVUZXh0Pj4oJ2dldCcsYCR7dGhpcy5iYXNlUGF0aH0vcnVsZXMvYXV0b2NvbXBsZXRlLyR7ZW5jb2RlVVJJQ29tcG9uZW50KFN0cmluZyhwcmVmaXgpKX1gLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHBhcmFtczogcXVlcnlQYXJhbWV0ZXJzLFxuICAgICAgICAgICAgICAgIHdpdGhDcmVkZW50aWFsczogdGhpcy5jb25maWd1cmF0aW9uLndpdGhDcmVkZW50aWFscyxcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiBoZWFkZXJzLFxuICAgICAgICAgICAgICAgIG9ic2VydmU6IG9ic2VydmUsXG4gICAgICAgICAgICAgICAgcmVwb3J0UHJvZ3Jlc3M6IHJlcG9ydFByb2dyZXNzXG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IGEgY29tbWVudFxuICAgICAqIEdldCBhIGNvbW1lbnQgYnkgSWQgZm9yIHRoaXMgaXRlbVxuICAgICAqIEBwYXJhbSB0ZXh0IFRoZSB0ZXh0IG9mIHRoZSBydWxlIHlvdSB3YW50IHRvIHdvcmsgb25cbiAgICAgKiBAcGFyYW0gbGFuZ3VhZ2UgU2hvdyByZXN1bHRzIGZvciB0aGUgZ2l2ZW4gbGFuZ3VhZ2Ugb25seS4gICBUaGlzIGlzIHRoZSBsYW5ndWFnZSB1c2VkLCBjb3VsZCBoYXZlIGJlZW4gc2V0IGJ5IHRoZSB1c2VyIG9yIGRldGVjdGVkIGJ5IGxhbmd1YWdlIGlkLlxuICAgICAqIEBwYXJhbSBjb21tZW50SWQgVGhlIHVuaXF1ZSBpZGVudGlmaWVyIGZvciB0aGUgY29tbWVudFxuICAgICAqIEBwYXJhbSBjbGllbnRJZCBTaG93IHJlc3VsdHMgZm9yIGEgZ2l2ZW4gY2xpZW50LiAgVHlwaWNhbGx5IHRoaXMgaXMgc2V0IGZvciB5b3UgYnkgdGhlIGludGVybmFsIHN5c3RlbSBiYXNlZCBvbiB0aGUgQVBJX0tFWSB5b3UgYXJlIHVzaW5nLiAgSG93ZXZlciBzb21lIGNsaWVudHMgYXJlIGFsbG93ZWQgdG8gdmlldyBvdGhlciBjbGllbnRzIHN1Y2ggYXMgd2hlbiB0aGV5IGhhdmUgYSBzYW5kYm94IG9yIHdoZW4gdGhleSBhcmUgYSBsYXJnZSBlbnRlcnByaXNlIGFuZCBoYXZlIG11bHRpcGxlIGNsaWVudHMgdGhleSBtYW5hZ2UuICBJdCB3aWxsIG9ubHkgYWxsb3cgeW91IHRvIHZpZXcgY2xpZW50IGRhdGEgeW91IGhhdmUgYWNjZXNzIHRvLlxuICAgICAqIEBwYXJhbSBvYnNlcnZlIHNldCB3aGV0aGVyIG9yIG5vdCB0byByZXR1cm4gdGhlIGRhdGEgT2JzZXJ2YWJsZSBhcyB0aGUgYm9keSwgcmVzcG9uc2Ugb3IgZXZlbnRzLiBkZWZhdWx0cyB0byByZXR1cm5pbmcgdGhlIGJvZHkuXG4gICAgICogQHBhcmFtIHJlcG9ydFByb2dyZXNzIGZsYWcgdG8gcmVwb3J0IHJlcXVlc3QgYW5kIHJlc3BvbnNlIHByb2dyZXNzLlxuICAgICAqL1xuICAgIHB1YmxpYyBnZXRDb21tZW50KHRleHQ6IHN0cmluZywgbGFuZ3VhZ2U6IHN0cmluZywgY29tbWVudElkOiBzdHJpbmcsIGNsaWVudElkPzogbnVtYmVyLCBvYnNlcnZlPzogJ2JvZHknLCByZXBvcnRQcm9ncmVzcz86IGJvb2xlYW4pOiBPYnNlcnZhYmxlPENvbW1lbnQ+O1xuICAgIHB1YmxpYyBnZXRDb21tZW50KHRleHQ6IHN0cmluZywgbGFuZ3VhZ2U6IHN0cmluZywgY29tbWVudElkOiBzdHJpbmcsIGNsaWVudElkPzogbnVtYmVyLCBvYnNlcnZlPzogJ3Jlc3BvbnNlJywgcmVwb3J0UHJvZ3Jlc3M/OiBib29sZWFuKTogT2JzZXJ2YWJsZTxIdHRwUmVzcG9uc2U8Q29tbWVudD4+O1xuICAgIHB1YmxpYyBnZXRDb21tZW50KHRleHQ6IHN0cmluZywgbGFuZ3VhZ2U6IHN0cmluZywgY29tbWVudElkOiBzdHJpbmcsIGNsaWVudElkPzogbnVtYmVyLCBvYnNlcnZlPzogJ2V2ZW50cycsIHJlcG9ydFByb2dyZXNzPzogYm9vbGVhbik6IE9ic2VydmFibGU8SHR0cEV2ZW50PENvbW1lbnQ+PjtcbiAgICBwdWJsaWMgZ2V0Q29tbWVudCh0ZXh0OiBzdHJpbmcsIGxhbmd1YWdlOiBzdHJpbmcsIGNvbW1lbnRJZDogc3RyaW5nLCBjbGllbnRJZD86IG51bWJlciwgb2JzZXJ2ZTogYW55ID0gJ2JvZHknLCByZXBvcnRQcm9ncmVzczogYm9vbGVhbiA9IGZhbHNlICk6IE9ic2VydmFibGU8YW55PiB7XG5cbiAgICAgICAgaWYgKHRleHQgPT09IG51bGwgfHwgdGV4dCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1JlcXVpcmVkIHBhcmFtZXRlciB0ZXh0IHdhcyBudWxsIG9yIHVuZGVmaW5lZCB3aGVuIGNhbGxpbmcgZ2V0Q29tbWVudC4nKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChsYW5ndWFnZSA9PT0gbnVsbCB8fCBsYW5ndWFnZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1JlcXVpcmVkIHBhcmFtZXRlciBsYW5ndWFnZSB3YXMgbnVsbCBvciB1bmRlZmluZWQgd2hlbiBjYWxsaW5nIGdldENvbW1lbnQuJyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoY29tbWVudElkID09PSBudWxsIHx8IGNvbW1lbnRJZCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1JlcXVpcmVkIHBhcmFtZXRlciBjb21tZW50SWQgd2FzIG51bGwgb3IgdW5kZWZpbmVkIHdoZW4gY2FsbGluZyBnZXRDb21tZW50LicpO1xuICAgICAgICB9XG5cblxuICAgICAgICBsZXQgcXVlcnlQYXJhbWV0ZXJzID0gbmV3IEh0dHBQYXJhbXMoe2VuY29kZXI6IG5ldyBDdXN0b21IdHRwVXJsRW5jb2RpbmdDb2RlYygpfSk7XG4gICAgICAgIGlmIChsYW5ndWFnZSAhPT0gdW5kZWZpbmVkICYmIGxhbmd1YWdlICE9PSBudWxsKSB7XG4gICAgICAgICAgICBxdWVyeVBhcmFtZXRlcnMgPSBxdWVyeVBhcmFtZXRlcnMuc2V0KCdsYW5ndWFnZScsIDxhbnk+bGFuZ3VhZ2UpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjbGllbnRJZCAhPT0gdW5kZWZpbmVkICYmIGNsaWVudElkICE9PSBudWxsKSB7XG4gICAgICAgICAgICBxdWVyeVBhcmFtZXRlcnMgPSBxdWVyeVBhcmFtZXRlcnMuc2V0KCdjbGllbnRJZCcsIDxhbnk+Y2xpZW50SWQpO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IGhlYWRlcnMgPSB0aGlzLmRlZmF1bHRIZWFkZXJzO1xuXG4gICAgICAgIC8vIGF1dGhlbnRpY2F0aW9uIChiZWFyZXJBdXRoKSByZXF1aXJlZFxuICAgICAgICBpZiAodGhpcy5jb25maWd1cmF0aW9uLmFjY2Vzc1Rva2VuKSB7XG4gICAgICAgICAgICBjb25zdCBhY2Nlc3NUb2tlbiA9IHR5cGVvZiB0aGlzLmNvbmZpZ3VyYXRpb24uYWNjZXNzVG9rZW4gPT09ICdmdW5jdGlvbidcbiAgICAgICAgICAgICAgICA/IHRoaXMuY29uZmlndXJhdGlvbi5hY2Nlc3NUb2tlbigpXG4gICAgICAgICAgICAgICAgOiB0aGlzLmNvbmZpZ3VyYXRpb24uYWNjZXNzVG9rZW47XG4gICAgICAgICAgICBoZWFkZXJzID0gaGVhZGVycy5zZXQoJ0F1dGhvcml6YXRpb24nLCAnQmVhcmVyICcgKyBhY2Nlc3NUb2tlbik7XG4gICAgICAgIH1cbiAgICAgICAgLy8gdG8gZGV0ZXJtaW5lIHRoZSBBY2NlcHQgaGVhZGVyXG4gICAgICAgIGxldCBodHRwSGVhZGVyQWNjZXB0czogc3RyaW5nW10gPSBbXG4gICAgICAgICAgICAnYXBwbGljYXRpb24vanNvbidcbiAgICAgICAgXTtcbiAgICAgICAgY29uc3QgaHR0cEhlYWRlckFjY2VwdFNlbGVjdGVkOiBzdHJpbmcgfCB1bmRlZmluZWQgPSB0aGlzLmNvbmZpZ3VyYXRpb24uc2VsZWN0SGVhZGVyQWNjZXB0KGh0dHBIZWFkZXJBY2NlcHRzKTtcbiAgICAgICAgaWYgKGh0dHBIZWFkZXJBY2NlcHRTZWxlY3RlZCAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGhlYWRlcnMgPSBoZWFkZXJzLnNldCgnQWNjZXB0JywgaHR0cEhlYWRlckFjY2VwdFNlbGVjdGVkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHRvIGRldGVybWluZSB0aGUgQ29udGVudC1UeXBlIGhlYWRlclxuICAgICAgICBjb25zdCBjb25zdW1lczogc3RyaW5nW10gPSBbXG4gICAgICAgIF07XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cENsaWVudC5yZXF1ZXN0PENvbW1lbnQ+KCdnZXQnLGAke3RoaXMuYmFzZVBhdGh9L3J1bGVzL3RleHQvJHtlbmNvZGVVUklDb21wb25lbnQoU3RyaW5nKHRleHQpKX0vY29tbWVudHMvJHtlbmNvZGVVUklDb21wb25lbnQoU3RyaW5nKGNvbW1lbnRJZCkpfWAsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgcGFyYW1zOiBxdWVyeVBhcmFtZXRlcnMsXG4gICAgICAgICAgICAgICAgd2l0aENyZWRlbnRpYWxzOiB0aGlzLmNvbmZpZ3VyYXRpb24ud2l0aENyZWRlbnRpYWxzLFxuICAgICAgICAgICAgICAgIGhlYWRlcnM6IGhlYWRlcnMsXG4gICAgICAgICAgICAgICAgb2JzZXJ2ZTogb2JzZXJ2ZSxcbiAgICAgICAgICAgICAgICByZXBvcnRQcm9ncmVzczogcmVwb3J0UHJvZ3Jlc3NcbiAgICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBMb29rdXAgYSBzcGVjaWZpYyBydWxlXG4gICAgICogVGhpcyB3aWxsIGdldCB0aGUgc3BlY2lmaWMgcnVsZSBpbiBKU09OIGZvcm1hdFxuICAgICAqIEBwYXJhbSB0ZXh0IFRoZSB0ZXh0IG9mIHRoZSBydWxlIHlvdSB3YW50IHRvIHdvcmsgb25cbiAgICAgKiBAcGFyYW0gbGFuZ3VhZ2UgU2hvdyByZXN1bHRzIGZvciB0aGUgZ2l2ZW4gbGFuZ3VhZ2Ugb25seS4gICBUaGlzIGlzIHRoZSBsYW5ndWFnZSB1c2VkLCBjb3VsZCBoYXZlIGJlZW4gc2V0IGJ5IHRoZSB1c2VyIG9yIGRldGVjdGVkIGJ5IGxhbmd1YWdlIGlkLlxuICAgICAqIEBwYXJhbSBjbGllbnRJZCBTaG93IHJlc3VsdHMgZm9yIGEgZ2l2ZW4gY2xpZW50LiAgVHlwaWNhbGx5IHRoaXMgaXMgc2V0IGZvciB5b3UgYnkgdGhlIGludGVybmFsIHN5c3RlbSBiYXNlZCBvbiB0aGUgQVBJX0tFWSB5b3UgYXJlIHVzaW5nLiAgSG93ZXZlciBzb21lIGNsaWVudHMgYXJlIGFsbG93ZWQgdG8gdmlldyBvdGhlciBjbGllbnRzIHN1Y2ggYXMgd2hlbiB0aGV5IGhhdmUgYSBzYW5kYm94IG9yIHdoZW4gdGhleSBhcmUgYSBsYXJnZSBlbnRlcnByaXNlIGFuZCBoYXZlIG11bHRpcGxlIGNsaWVudHMgdGhleSBtYW5hZ2UuICBJdCB3aWxsIG9ubHkgYWxsb3cgeW91IHRvIHZpZXcgY2xpZW50IGRhdGEgeW91IGhhdmUgYWNjZXNzIHRvLlxuICAgICAqIEBwYXJhbSBvYnNlcnZlIHNldCB3aGV0aGVyIG9yIG5vdCB0byByZXR1cm4gdGhlIGRhdGEgT2JzZXJ2YWJsZSBhcyB0aGUgYm9keSwgcmVzcG9uc2Ugb3IgZXZlbnRzLiBkZWZhdWx0cyB0byByZXR1cm5pbmcgdGhlIGJvZHkuXG4gICAgICogQHBhcmFtIHJlcG9ydFByb2dyZXNzIGZsYWcgdG8gcmVwb3J0IHJlcXVlc3QgYW5kIHJlc3BvbnNlIHByb2dyZXNzLlxuICAgICAqL1xuICAgIHB1YmxpYyBnZXRSdWxlKHRleHQ6IHN0cmluZywgbGFuZ3VhZ2U6IHN0cmluZywgY2xpZW50SWQ/OiBudW1iZXIsIG9ic2VydmU/OiAnYm9keScsIHJlcG9ydFByb2dyZXNzPzogYm9vbGVhbik6IE9ic2VydmFibGU8UnVsZT47XG4gICAgcHVibGljIGdldFJ1bGUodGV4dDogc3RyaW5nLCBsYW5ndWFnZTogc3RyaW5nLCBjbGllbnRJZD86IG51bWJlciwgb2JzZXJ2ZT86ICdyZXNwb25zZScsIHJlcG9ydFByb2dyZXNzPzogYm9vbGVhbik6IE9ic2VydmFibGU8SHR0cFJlc3BvbnNlPFJ1bGU+PjtcbiAgICBwdWJsaWMgZ2V0UnVsZSh0ZXh0OiBzdHJpbmcsIGxhbmd1YWdlOiBzdHJpbmcsIGNsaWVudElkPzogbnVtYmVyLCBvYnNlcnZlPzogJ2V2ZW50cycsIHJlcG9ydFByb2dyZXNzPzogYm9vbGVhbik6IE9ic2VydmFibGU8SHR0cEV2ZW50PFJ1bGU+PjtcbiAgICBwdWJsaWMgZ2V0UnVsZSh0ZXh0OiBzdHJpbmcsIGxhbmd1YWdlOiBzdHJpbmcsIGNsaWVudElkPzogbnVtYmVyLCBvYnNlcnZlOiBhbnkgPSAnYm9keScsIHJlcG9ydFByb2dyZXNzOiBib29sZWFuID0gZmFsc2UgKTogT2JzZXJ2YWJsZTxhbnk+IHtcblxuICAgICAgICBpZiAodGV4dCA9PT0gbnVsbCB8fCB0ZXh0ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignUmVxdWlyZWQgcGFyYW1ldGVyIHRleHQgd2FzIG51bGwgb3IgdW5kZWZpbmVkIHdoZW4gY2FsbGluZyBnZXRSdWxlLicpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGxhbmd1YWdlID09PSBudWxsIHx8IGxhbmd1YWdlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignUmVxdWlyZWQgcGFyYW1ldGVyIGxhbmd1YWdlIHdhcyBudWxsIG9yIHVuZGVmaW5lZCB3aGVuIGNhbGxpbmcgZ2V0UnVsZS4nKTtcbiAgICAgICAgfVxuXG5cbiAgICAgICAgbGV0IHF1ZXJ5UGFyYW1ldGVycyA9IG5ldyBIdHRwUGFyYW1zKHtlbmNvZGVyOiBuZXcgQ3VzdG9tSHR0cFVybEVuY29kaW5nQ29kZWMoKX0pO1xuICAgICAgICBpZiAobGFuZ3VhZ2UgIT09IHVuZGVmaW5lZCAmJiBsYW5ndWFnZSAhPT0gbnVsbCkge1xuICAgICAgICAgICAgcXVlcnlQYXJhbWV0ZXJzID0gcXVlcnlQYXJhbWV0ZXJzLnNldCgnbGFuZ3VhZ2UnLCA8YW55Pmxhbmd1YWdlKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY2xpZW50SWQgIT09IHVuZGVmaW5lZCAmJiBjbGllbnRJZCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgcXVlcnlQYXJhbWV0ZXJzID0gcXVlcnlQYXJhbWV0ZXJzLnNldCgnY2xpZW50SWQnLCA8YW55PmNsaWVudElkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBoZWFkZXJzID0gdGhpcy5kZWZhdWx0SGVhZGVycztcblxuICAgICAgICAvLyBhdXRoZW50aWNhdGlvbiAoYmVhcmVyQXV0aCkgcmVxdWlyZWRcbiAgICAgICAgaWYgKHRoaXMuY29uZmlndXJhdGlvbi5hY2Nlc3NUb2tlbikge1xuICAgICAgICAgICAgY29uc3QgYWNjZXNzVG9rZW4gPSB0eXBlb2YgdGhpcy5jb25maWd1cmF0aW9uLmFjY2Vzc1Rva2VuID09PSAnZnVuY3Rpb24nXG4gICAgICAgICAgICAgICAgPyB0aGlzLmNvbmZpZ3VyYXRpb24uYWNjZXNzVG9rZW4oKVxuICAgICAgICAgICAgICAgIDogdGhpcy5jb25maWd1cmF0aW9uLmFjY2Vzc1Rva2VuO1xuICAgICAgICAgICAgaGVhZGVycyA9IGhlYWRlcnMuc2V0KCdBdXRob3JpemF0aW9uJywgJ0JlYXJlciAnICsgYWNjZXNzVG9rZW4pO1xuICAgICAgICB9XG4gICAgICAgIC8vIHRvIGRldGVybWluZSB0aGUgQWNjZXB0IGhlYWRlclxuICAgICAgICBsZXQgaHR0cEhlYWRlckFjY2VwdHM6IHN0cmluZ1tdID0gW1xuICAgICAgICAgICAgJ2FwcGxpY2F0aW9uL2pzb24nXG4gICAgICAgIF07XG4gICAgICAgIGNvbnN0IGh0dHBIZWFkZXJBY2NlcHRTZWxlY3RlZDogc3RyaW5nIHwgdW5kZWZpbmVkID0gdGhpcy5jb25maWd1cmF0aW9uLnNlbGVjdEhlYWRlckFjY2VwdChodHRwSGVhZGVyQWNjZXB0cyk7XG4gICAgICAgIGlmIChodHRwSGVhZGVyQWNjZXB0U2VsZWN0ZWQgIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBoZWFkZXJzID0gaGVhZGVycy5zZXQoJ0FjY2VwdCcsIGh0dHBIZWFkZXJBY2NlcHRTZWxlY3RlZCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyB0byBkZXRlcm1pbmUgdGhlIENvbnRlbnQtVHlwZSBoZWFkZXJcbiAgICAgICAgY29uc3QgY29uc3VtZXM6IHN0cmluZ1tdID0gW1xuICAgICAgICBdO1xuXG4gICAgICAgIHJldHVybiB0aGlzLmh0dHBDbGllbnQucmVxdWVzdDxSdWxlPignZ2V0JyxgJHt0aGlzLmJhc2VQYXRofS9ydWxlcy90ZXh0LyR7ZW5jb2RlVVJJQ29tcG9uZW50KFN0cmluZyh0ZXh0KSl9YCxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBwYXJhbXM6IHF1ZXJ5UGFyYW1ldGVycyxcbiAgICAgICAgICAgICAgICB3aXRoQ3JlZGVudGlhbHM6IHRoaXMuY29uZmlndXJhdGlvbi53aXRoQ3JlZGVudGlhbHMsXG4gICAgICAgICAgICAgICAgaGVhZGVyczogaGVhZGVycyxcbiAgICAgICAgICAgICAgICBvYnNlcnZlOiBvYnNlcnZlLFxuICAgICAgICAgICAgICAgIHJlcG9ydFByb2dyZXNzOiByZXBvcnRQcm9ncmVzc1xuICAgICAgICAgICAgfVxuICAgICAgICApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCBhIGxpc3Qgb2YgYWxsIGNoYW5nZXMgb24gdGhpcyBydWxlXG4gICAgICogVGhpcyB3aWxsIGdldCB0aGUgZnVsbCBjaGFuZ2Vsb2cgb2YgYWxsIGNoYW5nZXMgbWFkZSB0byBhIHJ1bGUgZm9yIGFsbCBjbGllbnRzIGFuZCBsYW5ndWFnZXMgeW91IGFyZSBhdXRob3JpemVkIHRvIHZpZXcuIFxuICAgICAqIEBwYXJhbSB0ZXh0IFRoZSB0ZXh0IG9mIHRoZSBydWxlIHlvdSB3YW50IHRvIHdvcmsgb25cbiAgICAgKiBAcGFyYW0gbGFuZ3VhZ2VzIFdoaWNoIGxhbmd1YWdlcyBkb2VzIHRoaXMgYXBwbHkgdG9cbiAgICAgKiBAcGFyYW0gY2xpZW50SWRzIFNob3cgcmVzdWx0cyBmb3IgYSBnaXZlbiBjbGllbnQuICBUeXBpY2FsbHkgdGhpcyBpcyBzZXQgZm9yIHlvdSBieSB0aGUgaW50ZXJuYWwgc3lzdGVtIGJhc2VkIG9uIHRoZSBBUElfS0VZIHlvdSBhcmUgdXNpbmcuICBIb3dldmVyIHNvbWUgY2xpZW50cyBhcmUgYWxsb3dlZCB0byB2aWV3IG90aGVyIGNsaWVudHMgc3VjaCBhcyB3aGVuIHRoZXkgaGF2ZSBhIHNhbmRib3ggb3Igd2hlbiB0aGV5IGFyZSBhIGxhcmdlIGVudGVycHJpc2UgYW5kIGhhdmUgbXVsdGlwbGUgY2xpZW50cyB0aGV5IG1hbmFnZS4gIEl0IHdpbGwgb25seSBhbGxvdyB5b3UgdG8gdmlldyBjbGllbnQgZGF0YSB5b3UgaGF2ZSBhY2Nlc3MgdG8uIFlvdSBjYW4gc2V0IHRoaXMgdG8gLTEgdG8gYXBwbHkgdG8gYWxsIGNsaWVudHMgeW91IGhhdmUgYWNjZXNzIHRvLlxuICAgICAqIEBwYXJhbSBsaW1pdCBMaW1pdCB0aGUgbnVtYmVyIG9mIHJlc3VsdHNcbiAgICAgKiBAcGFyYW0gb2Zmc2V0IFN0YXJ0IHRoZSBzZWFyY2ggZnJvbSBvZmZzZXQgMC4gIEZvciBpbnN0YW5jZSBpZiB5b3VyIHVzaW5nIHBhZ2luYXRpb24gcGFnZSAyIHdvdWxkIGJlIG9uIHRvdGFsSXRlbXNQZXJQYWdlKnBhZ2VOdW0uIFxuICAgICAqIEBwYXJhbSByZWZyZXNoIFNob3VsZCB0aGUgZGF0YWJhc2UgYmUgcmVmcmVzaGVkIHRvIG1ha2Ugc3VyZSBhbGwgdGhlIHJvd3MgYXJlIHVwZGF0ZWQgYmVmb3JlIGNhbGxpbmcuICAgIERvbiYjeDI3O3QgZG8gdGhpcyBpbiBwcm9kdWN0aW9uIGFzIHlvdSB3aWxsIGdldCBsYXRlbmN5IHNwaWtlIGFuZCBpdCBtYXkgbm90IGV2ZW4gYmUgdHVybmVkIG9uIGZvciBwcm9kdWN0aW9uIFVzZWQgcHJpbWFyaWx5IGZvciBpbnRlZ3JhdGlvbiB0ZXN0cy4gXG4gICAgICogQHBhcmFtIG9ic2VydmUgc2V0IHdoZXRoZXIgb3Igbm90IHRvIHJldHVybiB0aGUgZGF0YSBPYnNlcnZhYmxlIGFzIHRoZSBib2R5LCByZXNwb25zZSBvciBldmVudHMuIGRlZmF1bHRzIHRvIHJldHVybmluZyB0aGUgYm9keS5cbiAgICAgKiBAcGFyYW0gcmVwb3J0UHJvZ3Jlc3MgZmxhZyB0byByZXBvcnQgcmVxdWVzdCBhbmQgcmVzcG9uc2UgcHJvZ3Jlc3MuXG4gICAgICovXG4gICAgcHVibGljIGdldFJ1bGVIaXN0b3J5KHRleHQ6IHN0cmluZywgbGFuZ3VhZ2VzPzogQXJyYXk8c3RyaW5nPiwgY2xpZW50SWRzPzogQXJyYXk8bnVtYmVyPiwgbGltaXQ/OiBudW1iZXIsIG9mZnNldD86IG51bWJlciwgcmVmcmVzaD86IGJvb2xlYW4sIG9ic2VydmU/OiAnYm9keScsIHJlcG9ydFByb2dyZXNzPzogYm9vbGVhbik6IE9ic2VydmFibGU8QXJyYXk8Q2hhbmdlTG9nPj47XG4gICAgcHVibGljIGdldFJ1bGVIaXN0b3J5KHRleHQ6IHN0cmluZywgbGFuZ3VhZ2VzPzogQXJyYXk8c3RyaW5nPiwgY2xpZW50SWRzPzogQXJyYXk8bnVtYmVyPiwgbGltaXQ/OiBudW1iZXIsIG9mZnNldD86IG51bWJlciwgcmVmcmVzaD86IGJvb2xlYW4sIG9ic2VydmU/OiAncmVzcG9uc2UnLCByZXBvcnRQcm9ncmVzcz86IGJvb2xlYW4pOiBPYnNlcnZhYmxlPEh0dHBSZXNwb25zZTxBcnJheTxDaGFuZ2VMb2c+Pj47XG4gICAgcHVibGljIGdldFJ1bGVIaXN0b3J5KHRleHQ6IHN0cmluZywgbGFuZ3VhZ2VzPzogQXJyYXk8c3RyaW5nPiwgY2xpZW50SWRzPzogQXJyYXk8bnVtYmVyPiwgbGltaXQ/OiBudW1iZXIsIG9mZnNldD86IG51bWJlciwgcmVmcmVzaD86IGJvb2xlYW4sIG9ic2VydmU/OiAnZXZlbnRzJywgcmVwb3J0UHJvZ3Jlc3M/OiBib29sZWFuKTogT2JzZXJ2YWJsZTxIdHRwRXZlbnQ8QXJyYXk8Q2hhbmdlTG9nPj4+O1xuICAgIHB1YmxpYyBnZXRSdWxlSGlzdG9yeSh0ZXh0OiBzdHJpbmcsIGxhbmd1YWdlcz86IEFycmF5PHN0cmluZz4sIGNsaWVudElkcz86IEFycmF5PG51bWJlcj4sIGxpbWl0PzogbnVtYmVyLCBvZmZzZXQ/OiBudW1iZXIsIHJlZnJlc2g/OiBib29sZWFuLCBvYnNlcnZlOiBhbnkgPSAnYm9keScsIHJlcG9ydFByb2dyZXNzOiBib29sZWFuID0gZmFsc2UgKTogT2JzZXJ2YWJsZTxhbnk+IHtcblxuICAgICAgICBpZiAodGV4dCA9PT0gbnVsbCB8fCB0ZXh0ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignUmVxdWlyZWQgcGFyYW1ldGVyIHRleHQgd2FzIG51bGwgb3IgdW5kZWZpbmVkIHdoZW4gY2FsbGluZyBnZXRSdWxlSGlzdG9yeS4nKTtcbiAgICAgICAgfVxuXG5cblxuXG5cblxuICAgICAgICBsZXQgcXVlcnlQYXJhbWV0ZXJzID0gbmV3IEh0dHBQYXJhbXMoe2VuY29kZXI6IG5ldyBDdXN0b21IdHRwVXJsRW5jb2RpbmdDb2RlYygpfSk7XG4gICAgICAgIGlmIChsYW5ndWFnZXMpIHtcbiAgICAgICAgICAgIGxhbmd1YWdlcy5mb3JFYWNoKChlbGVtZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgcXVlcnlQYXJhbWV0ZXJzID0gcXVlcnlQYXJhbWV0ZXJzLmFwcGVuZCgnbGFuZ3VhZ2VzJywgPGFueT5lbGVtZW50KTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNsaWVudElkcykge1xuICAgICAgICAgICAgcXVlcnlQYXJhbWV0ZXJzID0gcXVlcnlQYXJhbWV0ZXJzLnNldCgnY2xpZW50SWRzJywgY2xpZW50SWRzLmpvaW4oQ09MTEVDVElPTl9GT1JNQVRTWydjc3YnXSkpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChsaW1pdCAhPT0gdW5kZWZpbmVkICYmIGxpbWl0ICE9PSBudWxsKSB7XG4gICAgICAgICAgICBxdWVyeVBhcmFtZXRlcnMgPSBxdWVyeVBhcmFtZXRlcnMuc2V0KCdsaW1pdCcsIDxhbnk+bGltaXQpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChvZmZzZXQgIT09IHVuZGVmaW5lZCAmJiBvZmZzZXQgIT09IG51bGwpIHtcbiAgICAgICAgICAgIHF1ZXJ5UGFyYW1ldGVycyA9IHF1ZXJ5UGFyYW1ldGVycy5zZXQoJ29mZnNldCcsIDxhbnk+b2Zmc2V0KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocmVmcmVzaCAhPT0gdW5kZWZpbmVkICYmIHJlZnJlc2ggIT09IG51bGwpIHtcbiAgICAgICAgICAgIHF1ZXJ5UGFyYW1ldGVycyA9IHF1ZXJ5UGFyYW1ldGVycy5zZXQoJ3JlZnJlc2gnLCA8YW55PnJlZnJlc2gpO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IGhlYWRlcnMgPSB0aGlzLmRlZmF1bHRIZWFkZXJzO1xuXG4gICAgICAgIC8vIGF1dGhlbnRpY2F0aW9uIChiZWFyZXJBdXRoKSByZXF1aXJlZFxuICAgICAgICBpZiAodGhpcy5jb25maWd1cmF0aW9uLmFjY2Vzc1Rva2VuKSB7XG4gICAgICAgICAgICBjb25zdCBhY2Nlc3NUb2tlbiA9IHR5cGVvZiB0aGlzLmNvbmZpZ3VyYXRpb24uYWNjZXNzVG9rZW4gPT09ICdmdW5jdGlvbidcbiAgICAgICAgICAgICAgICA/IHRoaXMuY29uZmlndXJhdGlvbi5hY2Nlc3NUb2tlbigpXG4gICAgICAgICAgICAgICAgOiB0aGlzLmNvbmZpZ3VyYXRpb24uYWNjZXNzVG9rZW47XG4gICAgICAgICAgICBoZWFkZXJzID0gaGVhZGVycy5zZXQoJ0F1dGhvcml6YXRpb24nLCAnQmVhcmVyICcgKyBhY2Nlc3NUb2tlbik7XG4gICAgICAgIH1cbiAgICAgICAgLy8gdG8gZGV0ZXJtaW5lIHRoZSBBY2NlcHQgaGVhZGVyXG4gICAgICAgIGxldCBodHRwSGVhZGVyQWNjZXB0czogc3RyaW5nW10gPSBbXG4gICAgICAgICAgICAnYXBwbGljYXRpb24vanNvbidcbiAgICAgICAgXTtcbiAgICAgICAgY29uc3QgaHR0cEhlYWRlckFjY2VwdFNlbGVjdGVkOiBzdHJpbmcgfCB1bmRlZmluZWQgPSB0aGlzLmNvbmZpZ3VyYXRpb24uc2VsZWN0SGVhZGVyQWNjZXB0KGh0dHBIZWFkZXJBY2NlcHRzKTtcbiAgICAgICAgaWYgKGh0dHBIZWFkZXJBY2NlcHRTZWxlY3RlZCAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGhlYWRlcnMgPSBoZWFkZXJzLnNldCgnQWNjZXB0JywgaHR0cEhlYWRlckFjY2VwdFNlbGVjdGVkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHRvIGRldGVybWluZSB0aGUgQ29udGVudC1UeXBlIGhlYWRlclxuICAgICAgICBjb25zdCBjb25zdW1lczogc3RyaW5nW10gPSBbXG4gICAgICAgIF07XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cENsaWVudC5yZXF1ZXN0PEFycmF5PENoYW5nZUxvZz4+KCdnZXQnLGAke3RoaXMuYmFzZVBhdGh9L3J1bGVzL3RleHQvJHtlbmNvZGVVUklDb21wb25lbnQoU3RyaW5nKHRleHQpKX0vY2hhbmdlbG9nYCxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBwYXJhbXM6IHF1ZXJ5UGFyYW1ldGVycyxcbiAgICAgICAgICAgICAgICB3aXRoQ3JlZGVudGlhbHM6IHRoaXMuY29uZmlndXJhdGlvbi53aXRoQ3JlZGVudGlhbHMsXG4gICAgICAgICAgICAgICAgaGVhZGVyczogaGVhZGVycyxcbiAgICAgICAgICAgICAgICBvYnNlcnZlOiBvYnNlcnZlLFxuICAgICAgICAgICAgICAgIHJlcG9ydFByb2dyZXNzOiByZXBvcnRQcm9ncmVzc1xuICAgICAgICAgICAgfVxuICAgICAgICApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNlYXJjaCBmb3IgcnVsZXNcbiAgICAgKiBXaWxsIGdldCBhbGwgdGhlIHJ1bGVzIHlvdSBoYXZlIGNyZWF0ZWQgaW4gdGhlIHN5c3RlbS4gRm9yIEVudGVycHJpc2UgUGx1cyBjbGllbnRzIHdpdGggYSBzcGVjaWZpYyBjb25maWRlbnRpYWxpdHkgYWdyZWVtZW50IHlvdSBtYXkgYWxzbyBoYXZlIHRoZSBvcHRpb24gdG8gcmV2aWV3IHRoZSBTaWZ0IHJ1bGVzIGFzIHdlbGwuIFxuICAgICAqIEBwYXJhbSBhaSBTaG93IGl0ZW1zIHRoZSBBSSBwcmVkaWN0cyBhcyB1c2VmdWwgYmVjYXVzZSBtb2RlcmF0b3JzIGluIHRoZSBwYXN0IGhhdmUgdGFrZW4gYW4gYWN0aW9uIG9uIHRoaXMgaXRlbXMuICBQYXNzaW5nIGFuIGFycmF5IG9mIG9iamVjdHMgYXMgcGFyYW1zIGNhbiBiZSB0cmlja3kgYXQgZmlyc3Qgc28gaGVyZSBpcyBhbiBleGFtcGxlICZhbXA7YWlbMF1bbWluUHJlZGljdGlvbl0mI3gzRDswLjUwJmFtcDthaVswXVttb2RlbE5hbWVdJiN4M0Q7dG9waWNfdnVsZ2FyJmFtcDthaVswXVttYXhQcmVkaWN0aW9uXSYjeDNEOzAuOTUmYW1wO2FpWzFdW21pblByZWRpY3Rpb25dJiN4M0Q7MC4xMCZhbXA7YWlbMV1bbW9kZWxOYW1lXSYjeDNEO3RvcGljX2ZyYXVkJmFtcDthaVsxXVttYXhQcmVkaWN0aW9uXSYjeDNEOzAuODAgIEluIHVybGVuY29kZWQgZm9ybSB0aGF0IHdvdWxkIGJlICZhbXA7YWklNUIwJTVEJTVCbWluUHJlZGljdGlvbiU1RCYjeDNEOzAuNTAmYW1wO2FpJTVCMCU1RCU1Qm1vZGVsTmFtZSU1RCYjeDNEO3RvcGljX3Z1bGdhciZhbXA7YWklNUIwJTVEJTVCbWF4UHJlZGljdGlvbiU1RCYjeDNEOzAuOTUmYW1wO2FpJTVCMSU1RCU1Qm1pblByZWRpY3Rpb24lNUQmI3gzRDswLjEwJmFtcDthaSU1QjElNUQlNUJtb2RlbE5hbWUlNUQmI3gzRDt0b3BpY19mcmF1ZCZhbXA7YWklNUIxJTVEJTVCbWF4UHJlZGljdGlvbiU1RCYjeDNEOzAuODAgXG4gICAgICogQHBhcmFtIGRvbmVCeU1vZGVyYXRvcklkIE9ubHkgc2hvdyB3b3JrIGRvbmUgYnkgdGhpcyBtb2RlcmF0b3JJZFxuICAgICAqIEBwYXJhbSBjbGllbnRJZHMgU2hvdyByZXN1bHRzIGZvciBhIHNldmVyYWwgZ2l2ZW4gY2xpZW50cy4gIFR5cGljYWxseSB0aGlzIGlzIHNldCBmb3IgeW91IGJ5IHRoZSBpbnRlcm5hbCBzeXN0ZW0gYmFzZWQgb24gdGhlIEFQSV9LRVkgeW91IGFyZSB1c2luZy4gIEhvd2V2ZXIgc29tZSBjbGllbnRzIGFyZSBhbGxvd2VkIHRvIHZpZXcgb3RoZXIgY2xpZW50cyBzdWNoIGFzIHdoZW4gdGhleSBoYXZlIGEgc2FuZGJveCBvciB3aGVuIHRoZXkgYXJlIGEgbGFyZ2UgZW50ZXJwcmlzZSBhbmQgaGF2ZSBtdWx0aXBsZSBjbGllbnRzIHRoZXkgbWFuYWdlLiAgSXQgd2lsbCBvbmx5IGFsbG93IHlvdSB0byB2aWV3IGNsaWVudCBkYXRhIHlvdSBoYXZlIGFjY2VzcyB0by5cbiAgICAgKiBAcGFyYW0gZW5kRGF0ZSBTaG93IHJlc3VsdHMgb2NjdXJyaW5nIGJlZm9yZSB0aGUgZ2l2ZW4gZGF0ZSBpbiB1bml4dGltZXN0YW1wIChtaWxsaXNlY29uZHMgc2luY2UgRXBvY2gpXG4gICAgICogQHBhcmFtIHN0YXJ0RGF0ZSBTaG93IHJlc3VsdHMgb2NjdXJyaW5nIGFmdGVyIHRoZSBnaXZlbiBkYXRlIGluIHVuaXh0aW1lc3RhbXAgKG1pbGxpc2Vjb25kcyBzaW5jZSBFcG9jaClcbiAgICAgKiBAcGFyYW0gbGFzdENoYW5nZWRTdGFydERhdGUgU2hvdyByZXN1bHRzIHdoZXJlIHRoZXJlIHdhcyBhIGNoYW5nZSBiZXR3ZWVuIGdpdmVuIGRhdGUgaW4gdW5peHRpbWVzdGFtcCAobWlsbGlzZWNvbmRzIHNpbmNlIEVwb2NoKVxuICAgICAqIEBwYXJhbSBsYXN0Q2hhbmdlZEVuZERhdGUgU2hvdyByZXN1bHRzIHdoZXJlIHRoZXJlIHdhcyBhIGNoYW5nZSBiZXR3ZWVuIGdpdmVuIGRhdGUgaW4gdW5peHRpbWVzdGFtcCAobWlsbGlzZWNvbmRzIHNpbmNlIEVwb2NoKVxuICAgICAqIEBwYXJhbSBkZWxldGVkIFNob3cgZGVsZXRlZCBpdGVtc1xuICAgICAqIEBwYXJhbSBwdWJsaXNoZWRTdGFydERhdGUgU2hvdyByZXN1bHRzIHdoZXJlIHRoZXJlIHdhcyBhIGNoYW5nZSBiZXR3ZWVuIGdpdmVuIGRhdGUgaW4gdW5peHRpbWVzdGFtcCAobWlsbGlzZWNvbmRzIHNpbmNlIEVwb2NoKVxuICAgICAqIEBwYXJhbSBwdWJsaXNoZWRFbmREYXRlIFNob3cgcmVzdWx0cyB3aGVyZSB0aGVyZSB3YXMgYSBjaGFuZ2UgYmV0d2VlbiBnaXZlbiBkYXRlIGluIHVuaXh0aW1lc3RhbXAgKG1pbGxpc2Vjb25kcyBzaW5jZSBFcG9jaClcbiAgICAgKiBAcGFyYW0gbGFuZ3VhZ2VzIFdoaWNoIGxhbmd1YWdlcyBkb2VzIHRoaXMgYXBwbHkgdG9cbiAgICAgKiBAcGFyYW0gbGltaXQgTGltaXQgdGhlIG51bWJlciBvZiByZXN1bHRzXG4gICAgICogQHBhcmFtIG9mZnNldCBTdGFydCB0aGUgc2VhcmNoIGZyb20gb2Zmc2V0IDAuICBGb3IgaW5zdGFuY2UgaWYgeW91ciB1c2luZyBwYWdpbmF0aW9uIHBhZ2UgMiB3b3VsZCBiZSBvbiB0b3RhbEl0ZW1zUGVyUGFnZSpwYWdlTnVtLiBcbiAgICAgKiBAcGFyYW0gYWx0U2Vuc2UgSGFzIHRoaXMgd29yZCBhcyBhbiBhbHRlcm5hdGUgc2Vuc2VcbiAgICAgKiBAcGFyYW0gYWx0U3BlbGxpbmcgSGFzIHRoaXMgd29yZCBhcyBhbiBhbHRlcm5hdGUgc3BlbGxpbmdcbiAgICAgKiBAcGFyYW0gbGVldE1hcHBpbmcgSGFzIHRoaXMgd29yZCBhcyBhIGxlZXQgbWFwcGluZ1xuICAgICAqIEBwYXJhbSB0YXNrSWQgSXMgYXNzb2NpYXRlZCB3aXRoIGEgdGFza0lkIGZvciBkb2luZyB3b3JrXG4gICAgICogQHBhcmFtIHRhZ3MgT25seSBmaW5kIGl0ZW1zIG1hdGNoaW5nIGEgY2VydGFpbiB0YWdcbiAgICAgKiBAcGFyYW0gdGV4dCBUZXh0IHNlYXJjaC4gIFRoaXMgdXNlcyBmdXp6eSBtYXRjaGluZy5cbiAgICAgKiBAcGFyYW0gdG9waWNzIE9ubHkgc2hvdyBpdGVtcyBmb3IgdGhlc2UgdG9waWNzICh0b3BpY0lkKSBiZXR3ZWVuIHJpc2sgbGV2ZWwgbWluUmlzayBhbmQgbWF4Umlza1xuICAgICAqIEBwYXJhbSB1bnJlc29sdmVkQ29tbWVudHMgV2lsbCBzZWUgaWYgdGhlcmUgYXJlIGFueSB1bnJlc29sdmVkIGNvbW1lbnRzIGZvciB5b3UgYW5kIHNob3cgb25seSB0aG9zZVxuICAgICAqIEBwYXJhbSBvYnNlcnZlIHNldCB3aGV0aGVyIG9yIG5vdCB0byByZXR1cm4gdGhlIGRhdGEgT2JzZXJ2YWJsZSBhcyB0aGUgYm9keSwgcmVzcG9uc2Ugb3IgZXZlbnRzLiBkZWZhdWx0cyB0byByZXR1cm5pbmcgdGhlIGJvZHkuXG4gICAgICogQHBhcmFtIHJlcG9ydFByb2dyZXNzIGZsYWcgdG8gcmVwb3J0IHJlcXVlc3QgYW5kIHJlc3BvbnNlIHByb2dyZXNzLlxuICAgICAqL1xuICAgIHB1YmxpYyBnZXRSdWxlcyhhaT86IEFycmF5PEFpPiwgZG9uZUJ5TW9kZXJhdG9ySWQ/OiBNb2RlcmF0b3JJZCwgY2xpZW50SWRzPzogQXJyYXk8Q2xpZW50SWQ+LCBlbmREYXRlPzogbnVtYmVyLCBzdGFydERhdGU/OiBudW1iZXIsIGxhc3RDaGFuZ2VkU3RhcnREYXRlPzogVGltZXN0YW1wLCBsYXN0Q2hhbmdlZEVuZERhdGU/OiBUaW1lc3RhbXAsIGRlbGV0ZWQ/OiBib29sZWFuLCBwdWJsaXNoZWRTdGFydERhdGU/OiBUaW1lc3RhbXAsIHB1Ymxpc2hlZEVuZERhdGU/OiBUaW1lc3RhbXAsIGxhbmd1YWdlcz86IEFycmF5PHN0cmluZz4sIGxpbWl0PzogbnVtYmVyLCBvZmZzZXQ/OiBudW1iZXIsIGFsdFNlbnNlPzogc3RyaW5nLCBhbHRTcGVsbGluZz86IHN0cmluZywgbGVldE1hcHBpbmc/OiBzdHJpbmcsIHRhc2tJZD86IHN0cmluZywgdGFncz86IEFycmF5PHN0cmluZz4sIHRleHQ/OiBzdHJpbmcsIHRvcGljcz86IEFycmF5PFRvcGljcz4sIHVucmVzb2x2ZWRDb21tZW50cz86IGJvb2xlYW4sIG9ic2VydmU/OiAnYm9keScsIHJlcG9ydFByb2dyZXNzPzogYm9vbGVhbik6IE9ic2VydmFibGU8QXJyYXk8UnVsZT4+O1xuICAgIHB1YmxpYyBnZXRSdWxlcyhhaT86IEFycmF5PEFpPiwgZG9uZUJ5TW9kZXJhdG9ySWQ/OiBNb2RlcmF0b3JJZCwgY2xpZW50SWRzPzogQXJyYXk8Q2xpZW50SWQ+LCBlbmREYXRlPzogbnVtYmVyLCBzdGFydERhdGU/OiBudW1iZXIsIGxhc3RDaGFuZ2VkU3RhcnREYXRlPzogVGltZXN0YW1wLCBsYXN0Q2hhbmdlZEVuZERhdGU/OiBUaW1lc3RhbXAsIGRlbGV0ZWQ/OiBib29sZWFuLCBwdWJsaXNoZWRTdGFydERhdGU/OiBUaW1lc3RhbXAsIHB1Ymxpc2hlZEVuZERhdGU/OiBUaW1lc3RhbXAsIGxhbmd1YWdlcz86IEFycmF5PHN0cmluZz4sIGxpbWl0PzogbnVtYmVyLCBvZmZzZXQ/OiBudW1iZXIsIGFsdFNlbnNlPzogc3RyaW5nLCBhbHRTcGVsbGluZz86IHN0cmluZywgbGVldE1hcHBpbmc/OiBzdHJpbmcsIHRhc2tJZD86IHN0cmluZywgdGFncz86IEFycmF5PHN0cmluZz4sIHRleHQ/OiBzdHJpbmcsIHRvcGljcz86IEFycmF5PFRvcGljcz4sIHVucmVzb2x2ZWRDb21tZW50cz86IGJvb2xlYW4sIG9ic2VydmU/OiAncmVzcG9uc2UnLCByZXBvcnRQcm9ncmVzcz86IGJvb2xlYW4pOiBPYnNlcnZhYmxlPEh0dHBSZXNwb25zZTxBcnJheTxSdWxlPj4+O1xuICAgIHB1YmxpYyBnZXRSdWxlcyhhaT86IEFycmF5PEFpPiwgZG9uZUJ5TW9kZXJhdG9ySWQ/OiBNb2RlcmF0b3JJZCwgY2xpZW50SWRzPzogQXJyYXk8Q2xpZW50SWQ+LCBlbmREYXRlPzogbnVtYmVyLCBzdGFydERhdGU/OiBudW1iZXIsIGxhc3RDaGFuZ2VkU3RhcnREYXRlPzogVGltZXN0YW1wLCBsYXN0Q2hhbmdlZEVuZERhdGU/OiBUaW1lc3RhbXAsIGRlbGV0ZWQ/OiBib29sZWFuLCBwdWJsaXNoZWRTdGFydERhdGU/OiBUaW1lc3RhbXAsIHB1Ymxpc2hlZEVuZERhdGU/OiBUaW1lc3RhbXAsIGxhbmd1YWdlcz86IEFycmF5PHN0cmluZz4sIGxpbWl0PzogbnVtYmVyLCBvZmZzZXQ/OiBudW1iZXIsIGFsdFNlbnNlPzogc3RyaW5nLCBhbHRTcGVsbGluZz86IHN0cmluZywgbGVldE1hcHBpbmc/OiBzdHJpbmcsIHRhc2tJZD86IHN0cmluZywgdGFncz86IEFycmF5PHN0cmluZz4sIHRleHQ/OiBzdHJpbmcsIHRvcGljcz86IEFycmF5PFRvcGljcz4sIHVucmVzb2x2ZWRDb21tZW50cz86IGJvb2xlYW4sIG9ic2VydmU/OiAnZXZlbnRzJywgcmVwb3J0UHJvZ3Jlc3M/OiBib29sZWFuKTogT2JzZXJ2YWJsZTxIdHRwRXZlbnQ8QXJyYXk8UnVsZT4+PjtcbiAgICBwdWJsaWMgZ2V0UnVsZXMoYWk/OiBBcnJheTxBaT4sIGRvbmVCeU1vZGVyYXRvcklkPzogTW9kZXJhdG9ySWQsIGNsaWVudElkcz86IEFycmF5PENsaWVudElkPiwgZW5kRGF0ZT86IG51bWJlciwgc3RhcnREYXRlPzogbnVtYmVyLCBsYXN0Q2hhbmdlZFN0YXJ0RGF0ZT86IFRpbWVzdGFtcCwgbGFzdENoYW5nZWRFbmREYXRlPzogVGltZXN0YW1wLCBkZWxldGVkPzogYm9vbGVhbiwgcHVibGlzaGVkU3RhcnREYXRlPzogVGltZXN0YW1wLCBwdWJsaXNoZWRFbmREYXRlPzogVGltZXN0YW1wLCBsYW5ndWFnZXM/OiBBcnJheTxzdHJpbmc+LCBsaW1pdD86IG51bWJlciwgb2Zmc2V0PzogbnVtYmVyLCBhbHRTZW5zZT86IHN0cmluZywgYWx0U3BlbGxpbmc/OiBzdHJpbmcsIGxlZXRNYXBwaW5nPzogc3RyaW5nLCB0YXNrSWQ/OiBzdHJpbmcsIHRhZ3M/OiBBcnJheTxzdHJpbmc+LCB0ZXh0Pzogc3RyaW5nLCB0b3BpY3M/OiBBcnJheTxUb3BpY3M+LCB1bnJlc29sdmVkQ29tbWVudHM/OiBib29sZWFuLCBvYnNlcnZlOiBhbnkgPSAnYm9keScsIHJlcG9ydFByb2dyZXNzOiBib29sZWFuID0gZmFsc2UgKTogT2JzZXJ2YWJsZTxhbnk+IHtcblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuICAgICAgICBsZXQgcXVlcnlQYXJhbWV0ZXJzID0gbmV3IEh0dHBQYXJhbXMoe2VuY29kZXI6IG5ldyBDdXN0b21IdHRwVXJsRW5jb2RpbmdDb2RlYygpfSk7XG4gICAgICAgIGlmIChhaSkge1xuICAgICAgICAgICAgYWkuZm9yRWFjaCgoZWxlbWVudCkgPT4ge1xuICAgICAgICAgICAgICAgIHF1ZXJ5UGFyYW1ldGVycyA9IHF1ZXJ5UGFyYW1ldGVycy5hcHBlbmQoJ2FpJywgPGFueT5lbGVtZW50KTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH1cbiAgICAgICAgaWYgKGRvbmVCeU1vZGVyYXRvcklkICE9PSB1bmRlZmluZWQgJiYgZG9uZUJ5TW9kZXJhdG9ySWQgIT09IG51bGwpIHtcbiAgICAgICAgICAgIHF1ZXJ5UGFyYW1ldGVycyA9IHF1ZXJ5UGFyYW1ldGVycy5zZXQoJ2RvbmVCeU1vZGVyYXRvcklkJywgPGFueT5kb25lQnlNb2RlcmF0b3JJZCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNsaWVudElkcykge1xuICAgICAgICAgICAgY2xpZW50SWRzLmZvckVhY2goKGVsZW1lbnQpID0+IHtcbiAgICAgICAgICAgICAgICBxdWVyeVBhcmFtZXRlcnMgPSBxdWVyeVBhcmFtZXRlcnMuYXBwZW5kKCdjbGllbnRJZHMnLCA8YW55PmVsZW1lbnQpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgICAgICBpZiAoZW5kRGF0ZSAhPT0gdW5kZWZpbmVkICYmIGVuZERhdGUgIT09IG51bGwpIHtcbiAgICAgICAgICAgIHF1ZXJ5UGFyYW1ldGVycyA9IHF1ZXJ5UGFyYW1ldGVycy5zZXQoJ2VuZERhdGUnLCA8YW55PmVuZERhdGUpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzdGFydERhdGUgIT09IHVuZGVmaW5lZCAmJiBzdGFydERhdGUgIT09IG51bGwpIHtcbiAgICAgICAgICAgIHF1ZXJ5UGFyYW1ldGVycyA9IHF1ZXJ5UGFyYW1ldGVycy5zZXQoJ3N0YXJ0RGF0ZScsIDxhbnk+c3RhcnREYXRlKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobGFzdENoYW5nZWRTdGFydERhdGUgIT09IHVuZGVmaW5lZCAmJiBsYXN0Q2hhbmdlZFN0YXJ0RGF0ZSAhPT0gbnVsbCkge1xuICAgICAgICAgICAgcXVlcnlQYXJhbWV0ZXJzID0gcXVlcnlQYXJhbWV0ZXJzLnNldCgnbGFzdENoYW5nZWRTdGFydERhdGUnLCA8YW55Pmxhc3RDaGFuZ2VkU3RhcnREYXRlKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobGFzdENoYW5nZWRFbmREYXRlICE9PSB1bmRlZmluZWQgJiYgbGFzdENoYW5nZWRFbmREYXRlICE9PSBudWxsKSB7XG4gICAgICAgICAgICBxdWVyeVBhcmFtZXRlcnMgPSBxdWVyeVBhcmFtZXRlcnMuc2V0KCdsYXN0Q2hhbmdlZEVuZERhdGUnLCA8YW55Pmxhc3RDaGFuZ2VkRW5kRGF0ZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGRlbGV0ZWQgIT09IHVuZGVmaW5lZCAmJiBkZWxldGVkICE9PSBudWxsKSB7XG4gICAgICAgICAgICBxdWVyeVBhcmFtZXRlcnMgPSBxdWVyeVBhcmFtZXRlcnMuc2V0KCdkZWxldGVkJywgPGFueT5kZWxldGVkKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocHVibGlzaGVkU3RhcnREYXRlICE9PSB1bmRlZmluZWQgJiYgcHVibGlzaGVkU3RhcnREYXRlICE9PSBudWxsKSB7XG4gICAgICAgICAgICBxdWVyeVBhcmFtZXRlcnMgPSBxdWVyeVBhcmFtZXRlcnMuc2V0KCdwdWJsaXNoZWRTdGFydERhdGUnLCA8YW55PnB1Ymxpc2hlZFN0YXJ0RGF0ZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHB1Ymxpc2hlZEVuZERhdGUgIT09IHVuZGVmaW5lZCAmJiBwdWJsaXNoZWRFbmREYXRlICE9PSBudWxsKSB7XG4gICAgICAgICAgICBxdWVyeVBhcmFtZXRlcnMgPSBxdWVyeVBhcmFtZXRlcnMuc2V0KCdwdWJsaXNoZWRFbmREYXRlJywgPGFueT5wdWJsaXNoZWRFbmREYXRlKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobGFuZ3VhZ2VzKSB7XG4gICAgICAgICAgICBsYW5ndWFnZXMuZm9yRWFjaCgoZWxlbWVudCkgPT4ge1xuICAgICAgICAgICAgICAgIHF1ZXJ5UGFyYW1ldGVycyA9IHF1ZXJ5UGFyYW1ldGVycy5hcHBlbmQoJ2xhbmd1YWdlcycsIDxhbnk+ZWxlbWVudCk7XG4gICAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgICAgIGlmIChsaW1pdCAhPT0gdW5kZWZpbmVkICYmIGxpbWl0ICE9PSBudWxsKSB7XG4gICAgICAgICAgICBxdWVyeVBhcmFtZXRlcnMgPSBxdWVyeVBhcmFtZXRlcnMuc2V0KCdsaW1pdCcsIDxhbnk+bGltaXQpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChvZmZzZXQgIT09IHVuZGVmaW5lZCAmJiBvZmZzZXQgIT09IG51bGwpIHtcbiAgICAgICAgICAgIHF1ZXJ5UGFyYW1ldGVycyA9IHF1ZXJ5UGFyYW1ldGVycy5zZXQoJ29mZnNldCcsIDxhbnk+b2Zmc2V0KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoYWx0U2Vuc2UgIT09IHVuZGVmaW5lZCAmJiBhbHRTZW5zZSAhPT0gbnVsbCkge1xuICAgICAgICAgICAgcXVlcnlQYXJhbWV0ZXJzID0gcXVlcnlQYXJhbWV0ZXJzLnNldCgnYWx0U2Vuc2UnLCA8YW55PmFsdFNlbnNlKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoYWx0U3BlbGxpbmcgIT09IHVuZGVmaW5lZCAmJiBhbHRTcGVsbGluZyAhPT0gbnVsbCkge1xuICAgICAgICAgICAgcXVlcnlQYXJhbWV0ZXJzID0gcXVlcnlQYXJhbWV0ZXJzLnNldCgnYWx0U3BlbGxpbmcnLCA8YW55PmFsdFNwZWxsaW5nKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobGVldE1hcHBpbmcgIT09IHVuZGVmaW5lZCAmJiBsZWV0TWFwcGluZyAhPT0gbnVsbCkge1xuICAgICAgICAgICAgcXVlcnlQYXJhbWV0ZXJzID0gcXVlcnlQYXJhbWV0ZXJzLnNldCgnbGVldE1hcHBpbmcnLCA8YW55PmxlZXRNYXBwaW5nKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGFza0lkICE9PSB1bmRlZmluZWQgJiYgdGFza0lkICE9PSBudWxsKSB7XG4gICAgICAgICAgICBxdWVyeVBhcmFtZXRlcnMgPSBxdWVyeVBhcmFtZXRlcnMuc2V0KCd0YXNrSWQnLCA8YW55PnRhc2tJZCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRhZ3MpIHtcbiAgICAgICAgICAgIHF1ZXJ5UGFyYW1ldGVycyA9IHF1ZXJ5UGFyYW1ldGVycy5zZXQoJ3RhZ3MnLCB0YWdzLmpvaW4oQ09MTEVDVElPTl9GT1JNQVRTWydjc3YnXSkpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0ZXh0ICE9PSB1bmRlZmluZWQgJiYgdGV4dCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgcXVlcnlQYXJhbWV0ZXJzID0gcXVlcnlQYXJhbWV0ZXJzLnNldCgndGV4dCcsIDxhbnk+dGV4dCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRvcGljcykge1xuICAgICAgICAgICAgdG9waWNzLmZvckVhY2goKGVsZW1lbnQpID0+IHtcbiAgICAgICAgICAgICAgICBxdWVyeVBhcmFtZXRlcnMgPSBxdWVyeVBhcmFtZXRlcnMuYXBwZW5kKCd0b3BpY3MnLCA8YW55PmVsZW1lbnQpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgICAgICBpZiAodW5yZXNvbHZlZENvbW1lbnRzICE9PSB1bmRlZmluZWQgJiYgdW5yZXNvbHZlZENvbW1lbnRzICE9PSBudWxsKSB7XG4gICAgICAgICAgICBxdWVyeVBhcmFtZXRlcnMgPSBxdWVyeVBhcmFtZXRlcnMuc2V0KCd1bnJlc29sdmVkQ29tbWVudHMnLCA8YW55PnVucmVzb2x2ZWRDb21tZW50cyk7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgaGVhZGVycyA9IHRoaXMuZGVmYXVsdEhlYWRlcnM7XG5cbiAgICAgICAgLy8gYXV0aGVudGljYXRpb24gKGJlYXJlckF1dGgpIHJlcXVpcmVkXG4gICAgICAgIGlmICh0aGlzLmNvbmZpZ3VyYXRpb24uYWNjZXNzVG9rZW4pIHtcbiAgICAgICAgICAgIGNvbnN0IGFjY2Vzc1Rva2VuID0gdHlwZW9mIHRoaXMuY29uZmlndXJhdGlvbi5hY2Nlc3NUb2tlbiA9PT0gJ2Z1bmN0aW9uJ1xuICAgICAgICAgICAgICAgID8gdGhpcy5jb25maWd1cmF0aW9uLmFjY2Vzc1Rva2VuKClcbiAgICAgICAgICAgICAgICA6IHRoaXMuY29uZmlndXJhdGlvbi5hY2Nlc3NUb2tlbjtcbiAgICAgICAgICAgIGhlYWRlcnMgPSBoZWFkZXJzLnNldCgnQXV0aG9yaXphdGlvbicsICdCZWFyZXIgJyArIGFjY2Vzc1Rva2VuKTtcbiAgICAgICAgfVxuICAgICAgICAvLyB0byBkZXRlcm1pbmUgdGhlIEFjY2VwdCBoZWFkZXJcbiAgICAgICAgbGV0IGh0dHBIZWFkZXJBY2NlcHRzOiBzdHJpbmdbXSA9IFtcbiAgICAgICAgICAgICdhcHBsaWNhdGlvbi9qc29uJ1xuICAgICAgICBdO1xuICAgICAgICBjb25zdCBodHRwSGVhZGVyQWNjZXB0U2VsZWN0ZWQ6IHN0cmluZyB8IHVuZGVmaW5lZCA9IHRoaXMuY29uZmlndXJhdGlvbi5zZWxlY3RIZWFkZXJBY2NlcHQoaHR0cEhlYWRlckFjY2VwdHMpO1xuICAgICAgICBpZiAoaHR0cEhlYWRlckFjY2VwdFNlbGVjdGVkICE9IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgaGVhZGVycyA9IGhlYWRlcnMuc2V0KCdBY2NlcHQnLCBodHRwSGVhZGVyQWNjZXB0U2VsZWN0ZWQpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gdG8gZGV0ZXJtaW5lIHRoZSBDb250ZW50LVR5cGUgaGVhZGVyXG4gICAgICAgIGNvbnN0IGNvbnN1bWVzOiBzdHJpbmdbXSA9IFtcbiAgICAgICAgXTtcblxuICAgICAgICByZXR1cm4gdGhpcy5odHRwQ2xpZW50LnJlcXVlc3Q8QXJyYXk8UnVsZT4+KCdnZXQnLGAke3RoaXMuYmFzZVBhdGh9L3J1bGVzYCxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBwYXJhbXM6IHF1ZXJ5UGFyYW1ldGVycyxcbiAgICAgICAgICAgICAgICB3aXRoQ3JlZGVudGlhbHM6IHRoaXMuY29uZmlndXJhdGlvbi53aXRoQ3JlZGVudGlhbHMsXG4gICAgICAgICAgICAgICAgaGVhZGVyczogaGVhZGVycyxcbiAgICAgICAgICAgICAgICBvYnNlcnZlOiBvYnNlcnZlLFxuICAgICAgICAgICAgICAgIHJlcG9ydFByb2dyZXNzOiByZXBvcnRQcm9ncmVzc1xuICAgICAgICAgICAgfVxuICAgICAgICApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIExpc3QgY29tbWVudHMgb24gdGhpcyBjb250ZW50IGl0ZW1cbiAgICAgKiBcbiAgICAgKiBAcGFyYW0gdGV4dCBUaGUgdGV4dCBvZiB0aGUgcnVsZSB5b3Ugd2FudCB0byB3b3JrIG9uXG4gICAgICogQHBhcmFtIGxhbmd1YWdlIFNob3cgcmVzdWx0cyBmb3IgdGhlIGdpdmVuIGxhbmd1YWdlIG9ubHkuICAgVGhpcyBpcyB0aGUgbGFuZ3VhZ2UgdXNlZCwgY291bGQgaGF2ZSBiZWVuIHNldCBieSB0aGUgdXNlciBvciBkZXRlY3RlZCBieSBsYW5ndWFnZSBpZC5cbiAgICAgKiBAcGFyYW0gY2xpZW50SWQgU2hvdyByZXN1bHRzIGZvciBhIGdpdmVuIGNsaWVudC4gIFR5cGljYWxseSB0aGlzIGlzIHNldCBmb3IgeW91IGJ5IHRoZSBpbnRlcm5hbCBzeXN0ZW0gYmFzZWQgb24gdGhlIEFQSV9LRVkgeW91IGFyZSB1c2luZy4gIEhvd2V2ZXIgc29tZSBjbGllbnRzIGFyZSBhbGxvd2VkIHRvIHZpZXcgb3RoZXIgY2xpZW50cyBzdWNoIGFzIHdoZW4gdGhleSBoYXZlIGEgc2FuZGJveCBvciB3aGVuIHRoZXkgYXJlIGEgbGFyZ2UgZW50ZXJwcmlzZSBhbmQgaGF2ZSBtdWx0aXBsZSBjbGllbnRzIHRoZXkgbWFuYWdlLiAgSXQgd2lsbCBvbmx5IGFsbG93IHlvdSB0byB2aWV3IGNsaWVudCBkYXRhIHlvdSBoYXZlIGFjY2VzcyB0by5cbiAgICAgKiBAcGFyYW0gb2JzZXJ2ZSBzZXQgd2hldGhlciBvciBub3QgdG8gcmV0dXJuIHRoZSBkYXRhIE9ic2VydmFibGUgYXMgdGhlIGJvZHksIHJlc3BvbnNlIG9yIGV2ZW50cy4gZGVmYXVsdHMgdG8gcmV0dXJuaW5nIHRoZSBib2R5LlxuICAgICAqIEBwYXJhbSByZXBvcnRQcm9ncmVzcyBmbGFnIHRvIHJlcG9ydCByZXF1ZXN0IGFuZCByZXNwb25zZSBwcm9ncmVzcy5cbiAgICAgKi9cbiAgICBwdWJsaWMgbGlzdENvbW1lbnRzKHRleHQ6IHN0cmluZywgbGFuZ3VhZ2U6IHN0cmluZywgY2xpZW50SWQ/OiBudW1iZXIsIG9ic2VydmU/OiAnYm9keScsIHJlcG9ydFByb2dyZXNzPzogYm9vbGVhbik6IE9ic2VydmFibGU8QXJyYXk8Q29tbWVudD4+O1xuICAgIHB1YmxpYyBsaXN0Q29tbWVudHModGV4dDogc3RyaW5nLCBsYW5ndWFnZTogc3RyaW5nLCBjbGllbnRJZD86IG51bWJlciwgb2JzZXJ2ZT86ICdyZXNwb25zZScsIHJlcG9ydFByb2dyZXNzPzogYm9vbGVhbik6IE9ic2VydmFibGU8SHR0cFJlc3BvbnNlPEFycmF5PENvbW1lbnQ+Pj47XG4gICAgcHVibGljIGxpc3RDb21tZW50cyh0ZXh0OiBzdHJpbmcsIGxhbmd1YWdlOiBzdHJpbmcsIGNsaWVudElkPzogbnVtYmVyLCBvYnNlcnZlPzogJ2V2ZW50cycsIHJlcG9ydFByb2dyZXNzPzogYm9vbGVhbik6IE9ic2VydmFibGU8SHR0cEV2ZW50PEFycmF5PENvbW1lbnQ+Pj47XG4gICAgcHVibGljIGxpc3RDb21tZW50cyh0ZXh0OiBzdHJpbmcsIGxhbmd1YWdlOiBzdHJpbmcsIGNsaWVudElkPzogbnVtYmVyLCBvYnNlcnZlOiBhbnkgPSAnYm9keScsIHJlcG9ydFByb2dyZXNzOiBib29sZWFuID0gZmFsc2UgKTogT2JzZXJ2YWJsZTxhbnk+IHtcblxuICAgICAgICBpZiAodGV4dCA9PT0gbnVsbCB8fCB0ZXh0ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignUmVxdWlyZWQgcGFyYW1ldGVyIHRleHQgd2FzIG51bGwgb3IgdW5kZWZpbmVkIHdoZW4gY2FsbGluZyBsaXN0Q29tbWVudHMuJyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAobGFuZ3VhZ2UgPT09IG51bGwgfHwgbGFuZ3VhZ2UgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZXF1aXJlZCBwYXJhbWV0ZXIgbGFuZ3VhZ2Ugd2FzIG51bGwgb3IgdW5kZWZpbmVkIHdoZW4gY2FsbGluZyBsaXN0Q29tbWVudHMuJyk7XG4gICAgICAgIH1cblxuXG4gICAgICAgIGxldCBxdWVyeVBhcmFtZXRlcnMgPSBuZXcgSHR0cFBhcmFtcyh7ZW5jb2RlcjogbmV3IEN1c3RvbUh0dHBVcmxFbmNvZGluZ0NvZGVjKCl9KTtcbiAgICAgICAgaWYgKGxhbmd1YWdlICE9PSB1bmRlZmluZWQgJiYgbGFuZ3VhZ2UgIT09IG51bGwpIHtcbiAgICAgICAgICAgIHF1ZXJ5UGFyYW1ldGVycyA9IHF1ZXJ5UGFyYW1ldGVycy5zZXQoJ2xhbmd1YWdlJywgPGFueT5sYW5ndWFnZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNsaWVudElkICE9PSB1bmRlZmluZWQgJiYgY2xpZW50SWQgIT09IG51bGwpIHtcbiAgICAgICAgICAgIHF1ZXJ5UGFyYW1ldGVycyA9IHF1ZXJ5UGFyYW1ldGVycy5zZXQoJ2NsaWVudElkJywgPGFueT5jbGllbnRJZCk7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgaGVhZGVycyA9IHRoaXMuZGVmYXVsdEhlYWRlcnM7XG5cbiAgICAgICAgLy8gYXV0aGVudGljYXRpb24gKGJlYXJlckF1dGgpIHJlcXVpcmVkXG4gICAgICAgIGlmICh0aGlzLmNvbmZpZ3VyYXRpb24uYWNjZXNzVG9rZW4pIHtcbiAgICAgICAgICAgIGNvbnN0IGFjY2Vzc1Rva2VuID0gdHlwZW9mIHRoaXMuY29uZmlndXJhdGlvbi5hY2Nlc3NUb2tlbiA9PT0gJ2Z1bmN0aW9uJ1xuICAgICAgICAgICAgICAgID8gdGhpcy5jb25maWd1cmF0aW9uLmFjY2Vzc1Rva2VuKClcbiAgICAgICAgICAgICAgICA6IHRoaXMuY29uZmlndXJhdGlvbi5hY2Nlc3NUb2tlbjtcbiAgICAgICAgICAgIGhlYWRlcnMgPSBoZWFkZXJzLnNldCgnQXV0aG9yaXphdGlvbicsICdCZWFyZXIgJyArIGFjY2Vzc1Rva2VuKTtcbiAgICAgICAgfVxuICAgICAgICAvLyB0byBkZXRlcm1pbmUgdGhlIEFjY2VwdCBoZWFkZXJcbiAgICAgICAgbGV0IGh0dHBIZWFkZXJBY2NlcHRzOiBzdHJpbmdbXSA9IFtcbiAgICAgICAgICAgICdhcHBsaWNhdGlvbi9qc29uJ1xuICAgICAgICBdO1xuICAgICAgICBjb25zdCBodHRwSGVhZGVyQWNjZXB0U2VsZWN0ZWQ6IHN0cmluZyB8IHVuZGVmaW5lZCA9IHRoaXMuY29uZmlndXJhdGlvbi5zZWxlY3RIZWFkZXJBY2NlcHQoaHR0cEhlYWRlckFjY2VwdHMpO1xuICAgICAgICBpZiAoaHR0cEhlYWRlckFjY2VwdFNlbGVjdGVkICE9IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgaGVhZGVycyA9IGhlYWRlcnMuc2V0KCdBY2NlcHQnLCBodHRwSGVhZGVyQWNjZXB0U2VsZWN0ZWQpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gdG8gZGV0ZXJtaW5lIHRoZSBDb250ZW50LVR5cGUgaGVhZGVyXG4gICAgICAgIGNvbnN0IGNvbnN1bWVzOiBzdHJpbmdbXSA9IFtcbiAgICAgICAgXTtcblxuICAgICAgICByZXR1cm4gdGhpcy5odHRwQ2xpZW50LnJlcXVlc3Q8QXJyYXk8Q29tbWVudD4+KCdnZXQnLGAke3RoaXMuYmFzZVBhdGh9L3J1bGVzL3RleHQvJHtlbmNvZGVVUklDb21wb25lbnQoU3RyaW5nKHRleHQpKX0vY29tbWVudHNgLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHBhcmFtczogcXVlcnlQYXJhbWV0ZXJzLFxuICAgICAgICAgICAgICAgIHdpdGhDcmVkZW50aWFsczogdGhpcy5jb25maWd1cmF0aW9uLndpdGhDcmVkZW50aWFscyxcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiBoZWFkZXJzLFxuICAgICAgICAgICAgICAgIG9ic2VydmU6IG9ic2VydmUsXG4gICAgICAgICAgICAgICAgcmVwb3J0UHJvZ3Jlc3M6IHJlcG9ydFByb2dyZXNzXG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogTWFyayBhIGNvbW1lbnQgYXMgcmVzb2x2ZWQgKG9yIHJlb3BlbilcbiAgICAgKiBDb21tZW50cyBjYW4gYmUgbWFya2VkIGFzIG5lZWRpbmcgdG8gYmUgYW5zd2VyZWQuIFxuICAgICAqIEBwYXJhbSBsYW5ndWFnZSBTaG93IHJlc3VsdHMgZm9yIHRoZSBnaXZlbiBsYW5ndWFnZSBvbmx5LiAgIFRoaXMgaXMgdGhlIGxhbmd1YWdlIHVzZWQsIGNvdWxkIGhhdmUgYmVlbiBzZXQgYnkgdGhlIHVzZXIgb3IgZGV0ZWN0ZWQgYnkgbGFuZ3VhZ2UgaWQuXG4gICAgICogQHBhcmFtIHRleHQgVGhlIHRleHQgb2YgdGhlIHJ1bGUgeW91IHdhbnQgdG8gd29yayBvblxuICAgICAqIEBwYXJhbSBjb21tZW50SWQgVGhlIHVuaXF1ZSBpZGVudGlmaWVyIGZvciB0aGUgY29tbWVudFxuICAgICAqIEBwYXJhbSBib2R5IFxuICAgICAqIEBwYXJhbSBjbGllbnRJZCBTaG93IHJlc3VsdHMgZm9yIGEgZ2l2ZW4gY2xpZW50LiAgVHlwaWNhbGx5IHRoaXMgaXMgc2V0IGZvciB5b3UgYnkgdGhlIGludGVybmFsIHN5c3RlbSBiYXNlZCBvbiB0aGUgQVBJX0tFWSB5b3UgYXJlIHVzaW5nLiAgSG93ZXZlciBzb21lIGNsaWVudHMgYXJlIGFsbG93ZWQgdG8gdmlldyBvdGhlciBjbGllbnRzIHN1Y2ggYXMgd2hlbiB0aGV5IGhhdmUgYSBzYW5kYm94IG9yIHdoZW4gdGhleSBhcmUgYSBsYXJnZSBlbnRlcnByaXNlIGFuZCBoYXZlIG11bHRpcGxlIGNsaWVudHMgdGhleSBtYW5hZ2UuICBJdCB3aWxsIG9ubHkgYWxsb3cgeW91IHRvIHZpZXcgY2xpZW50IGRhdGEgeW91IGhhdmUgYWNjZXNzIHRvLlxuICAgICAqIEBwYXJhbSBvYnNlcnZlIHNldCB3aGV0aGVyIG9yIG5vdCB0byByZXR1cm4gdGhlIGRhdGEgT2JzZXJ2YWJsZSBhcyB0aGUgYm9keSwgcmVzcG9uc2Ugb3IgZXZlbnRzLiBkZWZhdWx0cyB0byByZXR1cm5pbmcgdGhlIGJvZHkuXG4gICAgICogQHBhcmFtIHJlcG9ydFByb2dyZXNzIGZsYWcgdG8gcmVwb3J0IHJlcXVlc3QgYW5kIHJlc3BvbnNlIHByb2dyZXNzLlxuICAgICAqL1xuICAgIHB1YmxpYyByZXNvbHZlQ29tbWVudChsYW5ndWFnZTogc3RyaW5nLCB0ZXh0OiBzdHJpbmcsIGNvbW1lbnRJZDogc3RyaW5nLCBib2R5PzogQm9keSwgY2xpZW50SWQ/OiBudW1iZXIsIG9ic2VydmU/OiAnYm9keScsIHJlcG9ydFByb2dyZXNzPzogYm9vbGVhbik6IE9ic2VydmFibGU8Q29tbWVudD47XG4gICAgcHVibGljIHJlc29sdmVDb21tZW50KGxhbmd1YWdlOiBzdHJpbmcsIHRleHQ6IHN0cmluZywgY29tbWVudElkOiBzdHJpbmcsIGJvZHk/OiBCb2R5LCBjbGllbnRJZD86IG51bWJlciwgb2JzZXJ2ZT86ICdyZXNwb25zZScsIHJlcG9ydFByb2dyZXNzPzogYm9vbGVhbik6IE9ic2VydmFibGU8SHR0cFJlc3BvbnNlPENvbW1lbnQ+PjtcbiAgICBwdWJsaWMgcmVzb2x2ZUNvbW1lbnQobGFuZ3VhZ2U6IHN0cmluZywgdGV4dDogc3RyaW5nLCBjb21tZW50SWQ6IHN0cmluZywgYm9keT86IEJvZHksIGNsaWVudElkPzogbnVtYmVyLCBvYnNlcnZlPzogJ2V2ZW50cycsIHJlcG9ydFByb2dyZXNzPzogYm9vbGVhbik6IE9ic2VydmFibGU8SHR0cEV2ZW50PENvbW1lbnQ+PjtcbiAgICBwdWJsaWMgcmVzb2x2ZUNvbW1lbnQobGFuZ3VhZ2U6IHN0cmluZywgdGV4dDogc3RyaW5nLCBjb21tZW50SWQ6IHN0cmluZywgYm9keT86IEJvZHksIGNsaWVudElkPzogbnVtYmVyLCBvYnNlcnZlOiBhbnkgPSAnYm9keScsIHJlcG9ydFByb2dyZXNzOiBib29sZWFuID0gZmFsc2UgKTogT2JzZXJ2YWJsZTxhbnk+IHtcblxuICAgICAgICBpZiAobGFuZ3VhZ2UgPT09IG51bGwgfHwgbGFuZ3VhZ2UgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZXF1aXJlZCBwYXJhbWV0ZXIgbGFuZ3VhZ2Ugd2FzIG51bGwgb3IgdW5kZWZpbmVkIHdoZW4gY2FsbGluZyByZXNvbHZlQ29tbWVudC4nKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0ZXh0ID09PSBudWxsIHx8IHRleHQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZXF1aXJlZCBwYXJhbWV0ZXIgdGV4dCB3YXMgbnVsbCBvciB1bmRlZmluZWQgd2hlbiBjYWxsaW5nIHJlc29sdmVDb21tZW50LicpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGNvbW1lbnRJZCA9PT0gbnVsbCB8fCBjb21tZW50SWQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZXF1aXJlZCBwYXJhbWV0ZXIgY29tbWVudElkIHdhcyBudWxsIG9yIHVuZGVmaW5lZCB3aGVuIGNhbGxpbmcgcmVzb2x2ZUNvbW1lbnQuJyk7XG4gICAgICAgIH1cblxuXG5cbiAgICAgICAgbGV0IHF1ZXJ5UGFyYW1ldGVycyA9IG5ldyBIdHRwUGFyYW1zKHtlbmNvZGVyOiBuZXcgQ3VzdG9tSHR0cFVybEVuY29kaW5nQ29kZWMoKX0pO1xuICAgICAgICBpZiAobGFuZ3VhZ2UgIT09IHVuZGVmaW5lZCAmJiBsYW5ndWFnZSAhPT0gbnVsbCkge1xuICAgICAgICAgICAgcXVlcnlQYXJhbWV0ZXJzID0gcXVlcnlQYXJhbWV0ZXJzLnNldCgnbGFuZ3VhZ2UnLCA8YW55Pmxhbmd1YWdlKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY2xpZW50SWQgIT09IHVuZGVmaW5lZCAmJiBjbGllbnRJZCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgcXVlcnlQYXJhbWV0ZXJzID0gcXVlcnlQYXJhbWV0ZXJzLnNldCgnY2xpZW50SWQnLCA8YW55PmNsaWVudElkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBoZWFkZXJzID0gdGhpcy5kZWZhdWx0SGVhZGVycztcblxuICAgICAgICAvLyBhdXRoZW50aWNhdGlvbiAoYmVhcmVyQXV0aCkgcmVxdWlyZWRcbiAgICAgICAgaWYgKHRoaXMuY29uZmlndXJhdGlvbi5hY2Nlc3NUb2tlbikge1xuICAgICAgICAgICAgY29uc3QgYWNjZXNzVG9rZW4gPSB0eXBlb2YgdGhpcy5jb25maWd1cmF0aW9uLmFjY2Vzc1Rva2VuID09PSAnZnVuY3Rpb24nXG4gICAgICAgICAgICAgICAgPyB0aGlzLmNvbmZpZ3VyYXRpb24uYWNjZXNzVG9rZW4oKVxuICAgICAgICAgICAgICAgIDogdGhpcy5jb25maWd1cmF0aW9uLmFjY2Vzc1Rva2VuO1xuICAgICAgICAgICAgaGVhZGVycyA9IGhlYWRlcnMuc2V0KCdBdXRob3JpemF0aW9uJywgJ0JlYXJlciAnICsgYWNjZXNzVG9rZW4pO1xuICAgICAgICB9XG4gICAgICAgIC8vIHRvIGRldGVybWluZSB0aGUgQWNjZXB0IGhlYWRlclxuICAgICAgICBsZXQgaHR0cEhlYWRlckFjY2VwdHM6IHN0cmluZ1tdID0gW1xuICAgICAgICAgICAgJ2FwcGxpY2F0aW9uL2pzb24nXG4gICAgICAgIF07XG4gICAgICAgIGNvbnN0IGh0dHBIZWFkZXJBY2NlcHRTZWxlY3RlZDogc3RyaW5nIHwgdW5kZWZpbmVkID0gdGhpcy5jb25maWd1cmF0aW9uLnNlbGVjdEhlYWRlckFjY2VwdChodHRwSGVhZGVyQWNjZXB0cyk7XG4gICAgICAgIGlmIChodHRwSGVhZGVyQWNjZXB0U2VsZWN0ZWQgIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBoZWFkZXJzID0gaGVhZGVycy5zZXQoJ0FjY2VwdCcsIGh0dHBIZWFkZXJBY2NlcHRTZWxlY3RlZCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyB0byBkZXRlcm1pbmUgdGhlIENvbnRlbnQtVHlwZSBoZWFkZXJcbiAgICAgICAgY29uc3QgY29uc3VtZXM6IHN0cmluZ1tdID0gW1xuICAgICAgICAgICAgJ2FwcGxpY2F0aW9uL2pzb24nXG4gICAgICAgIF07XG4gICAgICAgIGNvbnN0IGh0dHBDb250ZW50VHlwZVNlbGVjdGVkOiBzdHJpbmcgfCB1bmRlZmluZWQgPSB0aGlzLmNvbmZpZ3VyYXRpb24uc2VsZWN0SGVhZGVyQ29udGVudFR5cGUoY29uc3VtZXMpO1xuICAgICAgICBpZiAoaHR0cENvbnRlbnRUeXBlU2VsZWN0ZWQgIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBoZWFkZXJzID0gaGVhZGVycy5zZXQoJ0NvbnRlbnQtVHlwZScsIGh0dHBDb250ZW50VHlwZVNlbGVjdGVkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzLmh0dHBDbGllbnQucmVxdWVzdDxDb21tZW50PigncHV0JyxgJHt0aGlzLmJhc2VQYXRofS9ydWxlcy90ZXh0LyR7ZW5jb2RlVVJJQ29tcG9uZW50KFN0cmluZyh0ZXh0KSl9L2NvbW1lbnRzLyR7ZW5jb2RlVVJJQ29tcG9uZW50KFN0cmluZyhjb21tZW50SWQpKX0vcmVzb2x2ZWRgLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGJvZHk6IGJvZHksXG4gICAgICAgICAgICAgICAgcGFyYW1zOiBxdWVyeVBhcmFtZXRlcnMsXG4gICAgICAgICAgICAgICAgd2l0aENyZWRlbnRpYWxzOiB0aGlzLmNvbmZpZ3VyYXRpb24ud2l0aENyZWRlbnRpYWxzLFxuICAgICAgICAgICAgICAgIGhlYWRlcnM6IGhlYWRlcnMsXG4gICAgICAgICAgICAgICAgb2JzZXJ2ZTogb2JzZXJ2ZSxcbiAgICAgICAgICAgICAgICByZXBvcnRQcm9ncmVzczogcmVwb3J0UHJvZ3Jlc3NcbiAgICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUZXN0IHRoZSBpbXBhY3QgaWYgeW91IHdoZXJlIHRvIHVwbG9hZCBhIHJ1bGVcbiAgICAgKiBUaGlzIHdpbGwgYWRkIHRoZSBydWxlcyB0ZW1wb3JhcmlseSBpbiBhIHNhbmRib3ggZW52aXJvbm1lbnQgbG9vayBmb3IgZXhhbXBsZXMgb2YgdGV4dCB0aGF0IG1pZ2h0IGJlIGltcGFjdGVkIGFuZCBzZW5kIGl0IHRvIHRoZSBjbGFzc2lmaWVyLiBJZiB0aGUgcnVsZXMgY29udGFpbnMge3tzbWFydF9ydWxlc319IHRoZW4gaXQgd2lsbCBmaW5kIGFsbCB0aGUgd29yZHMgaW4gdGhvc2Ugc21hcnRfcnVsZXMgYW5kIHB1bGwgZXhhbXBsZXMgd2l0aCB0aGVtIEl0IHdpbGwgY29tcGFyZSB0aGUgb2xkIGFuc3dlciBhbmQgdGhlIG5ldyBhbnN3ZXIgYW5kIG91dHB1dCBhIGxpc3Qgb2YgcGhyYXNlcyB0aGF0IGFyZSBkaWZmZXJlbnQuICBUaGUgY2xpZW50SWRzIHBhcmFtIGxldHMgeW91IGNob29zZSB3aGljaCBjbGllbnRzIHRvIGdldCBleGFtcGxlcyBmcm9tLiAgXG4gICAgICogQHBhcmFtIGJvZHkgXG4gICAgICogQHBhcmFtIGV4YW1wbGVzUGVyUnVsZSBob3cgbWFueSBleGFtcGxlcyBzaG91bGQgd2UgZ2V0IHBlciBydWxlIG9yIHNtYXJ0X3J1bGUgcGFydFxuICAgICAqIEBwYXJhbSBjbGllbnRJZHMgU2hvdyByZXN1bHRzIGZvciBhIHNldmVyYWwgZ2l2ZW4gY2xpZW50cy4gIFR5cGljYWxseSB0aGlzIGlzIHNldCBmb3IgeW91IGJ5IHRoZSBpbnRlcm5hbCBzeXN0ZW0gYmFzZWQgb24gdGhlIEFQSV9LRVkgeW91IGFyZSB1c2luZy4gIEhvd2V2ZXIgc29tZSBjbGllbnRzIGFyZSBhbGxvd2VkIHRvIHZpZXcgb3RoZXIgY2xpZW50cyBzdWNoIGFzIHdoZW4gdGhleSBoYXZlIGEgc2FuZGJveCBvciB3aGVuIHRoZXkgYXJlIGEgbGFyZ2UgZW50ZXJwcmlzZSBhbmQgaGF2ZSBtdWx0aXBsZSBjbGllbnRzIHRoZXkgbWFuYWdlLiAgSXQgd2lsbCBvbmx5IGFsbG93IHlvdSB0byB2aWV3IGNsaWVudCBkYXRhIHlvdSBoYXZlIGFjY2VzcyB0by5cbiAgICAgKiBAcGFyYW0gb2JzZXJ2ZSBzZXQgd2hldGhlciBvciBub3QgdG8gcmV0dXJuIHRoZSBkYXRhIE9ic2VydmFibGUgYXMgdGhlIGJvZHksIHJlc3BvbnNlIG9yIGV2ZW50cy4gZGVmYXVsdHMgdG8gcmV0dXJuaW5nIHRoZSBib2R5LlxuICAgICAqIEBwYXJhbSByZXBvcnRQcm9ncmVzcyBmbGFnIHRvIHJlcG9ydCByZXF1ZXN0IGFuZCByZXNwb25zZSBwcm9ncmVzcy5cbiAgICAgKi9cbiAgICBwdWJsaWMgdGVzdFJ1bGVzKGJvZHk/OiBBcnJheTxSdWxlPiwgZXhhbXBsZXNQZXJSdWxlPzogbnVtYmVyLCBjbGllbnRJZHM/OiBBcnJheTxDbGllbnRJZD4sIG9ic2VydmU/OiAnYm9keScsIHJlcG9ydFByb2dyZXNzPzogYm9vbGVhbik6IE9ic2VydmFibGU8QXJyYXk8RXhhbXBsZURpZmY+PjtcbiAgICBwdWJsaWMgdGVzdFJ1bGVzKGJvZHk/OiBBcnJheTxSdWxlPiwgZXhhbXBsZXNQZXJSdWxlPzogbnVtYmVyLCBjbGllbnRJZHM/OiBBcnJheTxDbGllbnRJZD4sIG9ic2VydmU/OiAncmVzcG9uc2UnLCByZXBvcnRQcm9ncmVzcz86IGJvb2xlYW4pOiBPYnNlcnZhYmxlPEh0dHBSZXNwb25zZTxBcnJheTxFeGFtcGxlRGlmZj4+PjtcbiAgICBwdWJsaWMgdGVzdFJ1bGVzKGJvZHk/OiBBcnJheTxSdWxlPiwgZXhhbXBsZXNQZXJSdWxlPzogbnVtYmVyLCBjbGllbnRJZHM/OiBBcnJheTxDbGllbnRJZD4sIG9ic2VydmU/OiAnZXZlbnRzJywgcmVwb3J0UHJvZ3Jlc3M/OiBib29sZWFuKTogT2JzZXJ2YWJsZTxIdHRwRXZlbnQ8QXJyYXk8RXhhbXBsZURpZmY+Pj47XG4gICAgcHVibGljIHRlc3RSdWxlcyhib2R5PzogQXJyYXk8UnVsZT4sIGV4YW1wbGVzUGVyUnVsZT86IG51bWJlciwgY2xpZW50SWRzPzogQXJyYXk8Q2xpZW50SWQ+LCBvYnNlcnZlOiBhbnkgPSAnYm9keScsIHJlcG9ydFByb2dyZXNzOiBib29sZWFuID0gZmFsc2UgKTogT2JzZXJ2YWJsZTxhbnk+IHtcblxuXG5cblxuICAgICAgICBsZXQgcXVlcnlQYXJhbWV0ZXJzID0gbmV3IEh0dHBQYXJhbXMoe2VuY29kZXI6IG5ldyBDdXN0b21IdHRwVXJsRW5jb2RpbmdDb2RlYygpfSk7XG4gICAgICAgIGlmIChleGFtcGxlc1BlclJ1bGUgIT09IHVuZGVmaW5lZCAmJiBleGFtcGxlc1BlclJ1bGUgIT09IG51bGwpIHtcbiAgICAgICAgICAgIHF1ZXJ5UGFyYW1ldGVycyA9IHF1ZXJ5UGFyYW1ldGVycy5zZXQoJ2V4YW1wbGVzUGVyUnVsZScsIDxhbnk+ZXhhbXBsZXNQZXJSdWxlKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY2xpZW50SWRzKSB7XG4gICAgICAgICAgICBjbGllbnRJZHMuZm9yRWFjaCgoZWxlbWVudCkgPT4ge1xuICAgICAgICAgICAgICAgIHF1ZXJ5UGFyYW1ldGVycyA9IHF1ZXJ5UGFyYW1ldGVycy5hcHBlbmQoJ2NsaWVudElkcycsIDxhbnk+ZWxlbWVudCk7XG4gICAgICAgICAgICB9KVxuICAgICAgICB9XG5cbiAgICAgICAgbGV0IGhlYWRlcnMgPSB0aGlzLmRlZmF1bHRIZWFkZXJzO1xuXG4gICAgICAgIC8vIGF1dGhlbnRpY2F0aW9uIChiZWFyZXJBdXRoKSByZXF1aXJlZFxuICAgICAgICBpZiAodGhpcy5jb25maWd1cmF0aW9uLmFjY2Vzc1Rva2VuKSB7XG4gICAgICAgICAgICBjb25zdCBhY2Nlc3NUb2tlbiA9IHR5cGVvZiB0aGlzLmNvbmZpZ3VyYXRpb24uYWNjZXNzVG9rZW4gPT09ICdmdW5jdGlvbidcbiAgICAgICAgICAgICAgICA/IHRoaXMuY29uZmlndXJhdGlvbi5hY2Nlc3NUb2tlbigpXG4gICAgICAgICAgICAgICAgOiB0aGlzLmNvbmZpZ3VyYXRpb24uYWNjZXNzVG9rZW47XG4gICAgICAgICAgICBoZWFkZXJzID0gaGVhZGVycy5zZXQoJ0F1dGhvcml6YXRpb24nLCAnQmVhcmVyICcgKyBhY2Nlc3NUb2tlbik7XG4gICAgICAgIH1cbiAgICAgICAgLy8gdG8gZGV0ZXJtaW5lIHRoZSBBY2NlcHQgaGVhZGVyXG4gICAgICAgIGxldCBodHRwSGVhZGVyQWNjZXB0czogc3RyaW5nW10gPSBbXG4gICAgICAgICAgICAnYXBwbGljYXRpb24vanNvbidcbiAgICAgICAgXTtcbiAgICAgICAgY29uc3QgaHR0cEhlYWRlckFjY2VwdFNlbGVjdGVkOiBzdHJpbmcgfCB1bmRlZmluZWQgPSB0aGlzLmNvbmZpZ3VyYXRpb24uc2VsZWN0SGVhZGVyQWNjZXB0KGh0dHBIZWFkZXJBY2NlcHRzKTtcbiAgICAgICAgaWYgKGh0dHBIZWFkZXJBY2NlcHRTZWxlY3RlZCAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGhlYWRlcnMgPSBoZWFkZXJzLnNldCgnQWNjZXB0JywgaHR0cEhlYWRlckFjY2VwdFNlbGVjdGVkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHRvIGRldGVybWluZSB0aGUgQ29udGVudC1UeXBlIGhlYWRlclxuICAgICAgICBjb25zdCBjb25zdW1lczogc3RyaW5nW10gPSBbXG4gICAgICAgICAgICAnYXBwbGljYXRpb24vanNvbidcbiAgICAgICAgXTtcbiAgICAgICAgY29uc3QgaHR0cENvbnRlbnRUeXBlU2VsZWN0ZWQ6IHN0cmluZyB8IHVuZGVmaW5lZCA9IHRoaXMuY29uZmlndXJhdGlvbi5zZWxlY3RIZWFkZXJDb250ZW50VHlwZShjb25zdW1lcyk7XG4gICAgICAgIGlmIChodHRwQ29udGVudFR5cGVTZWxlY3RlZCAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGhlYWRlcnMgPSBoZWFkZXJzLnNldCgnQ29udGVudC1UeXBlJywgaHR0cENvbnRlbnRUeXBlU2VsZWN0ZWQpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cENsaWVudC5yZXF1ZXN0PEFycmF5PEV4YW1wbGVEaWZmPj4oJ3B1dCcsYCR7dGhpcy5iYXNlUGF0aH0vcnVsZXMvdGVzdGAsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgYm9keTogYm9keSxcbiAgICAgICAgICAgICAgICBwYXJhbXM6IHF1ZXJ5UGFyYW1ldGVycyxcbiAgICAgICAgICAgICAgICB3aXRoQ3JlZGVudGlhbHM6IHRoaXMuY29uZmlndXJhdGlvbi53aXRoQ3JlZGVudGlhbHMsXG4gICAgICAgICAgICAgICAgaGVhZGVyczogaGVhZGVycyxcbiAgICAgICAgICAgICAgICBvYnNlcnZlOiBvYnNlcnZlLFxuICAgICAgICAgICAgICAgIHJlcG9ydFByb2dyZXNzOiByZXBvcnRQcm9ncmVzc1xuICAgICAgICAgICAgfVxuICAgICAgICApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFVwZGF0ZSB0aGUgY3VycmVudCBhbHRlcm5hdGUgc2Vuc2UgKG9yIGFkZCBpZiBkb2VzIG5vdCBleGlzdCkgd2l0aCB0aGlzIHZhbHVlLlxuICAgICAqIFRoaXMgd2lsbCB1cGRhdGUgYW4gYWx0ZXJuYXRlIHNwZWxsaW5nIGZvciBhIHJ1bGUgYW5kIGxvZyB0aGUgY2hhbmdlICBBbHRlcm5hdGUgc2Vuc2VzIHdpbGwgcmVwbGFjZSB0aGlzIHdvcmQgd2l0aCBhbm90aGVyIHdvcmQgU09NRVRJTUVTLiAgWW91IGNhbiBoYXZlIG1vcmUgdGhhbiBvbmUgYWx0IHNlbnNlIGFuZCBpdCB3aWxsIGNob29zZSB0aGUgYmVzdCBvbmUgYmFzZWQgb24gY29udGV4dCBvciB0aGUgaGlnaGVyIHJpc2sgb25lIGlmIHRoZXkgYXJlIHRpZWQuIFR5cGljYWxseSBhbHRlcm5hdGUgc2Vuc2VzIGFyZSB0aWVkIHRvIHNtYXJ0IHJ1bGVzIGxpa2Uge3tmaXJzdF9uYW1lfX0gXG4gICAgICogQHBhcmFtIHRleHQgVGhlIHRleHQgb2YgdGhlIHJ1bGUgeW91IHdhbnQgdG8gd29yayBvblxuICAgICAqIEBwYXJhbSBsYW5ndWFnZSBTaG93IHJlc3VsdHMgZm9yIHRoZSBnaXZlbiBsYW5ndWFnZSBvbmx5LiAgIFRoaXMgaXMgdGhlIGxhbmd1YWdlIHVzZWQsIGNvdWxkIGhhdmUgYmVlbiBzZXQgYnkgdGhlIHVzZXIgb3IgZGV0ZWN0ZWQgYnkgbGFuZ3VhZ2UgaWQuXG4gICAgICogQHBhcmFtIGRlcGVuZGVuY3kgVGhpcyBpcyB0aGUgcmVsYXRlZCB0ZXh0IHlvdSB3YW50IHRvIHdvcmsgb24uXG4gICAgICogQHBhcmFtIGNsaWVudElkIFNob3cgcmVzdWx0cyBmb3IgYSBnaXZlbiBjbGllbnQuICBUeXBpY2FsbHkgdGhpcyBpcyBzZXQgZm9yIHlvdSBieSB0aGUgaW50ZXJuYWwgc3lzdGVtIGJhc2VkIG9uIHRoZSBBUElfS0VZIHlvdSBhcmUgdXNpbmcuICBIb3dldmVyIHNvbWUgY2xpZW50cyBhcmUgYWxsb3dlZCB0byB2aWV3IG90aGVyIGNsaWVudHMgc3VjaCBhcyB3aGVuIHRoZXkgaGF2ZSBhIHNhbmRib3ggb3Igd2hlbiB0aGV5IGFyZSBhIGxhcmdlIGVudGVycHJpc2UgYW5kIGhhdmUgbXVsdGlwbGUgY2xpZW50cyB0aGV5IG1hbmFnZS4gIEl0IHdpbGwgb25seSBhbGxvdyB5b3UgdG8gdmlldyBjbGllbnQgZGF0YSB5b3UgaGF2ZSBhY2Nlc3MgdG8uXG4gICAgICogQHBhcmFtIHB1Ymxpc2ggVGhpcyB3aWxsIGFsc28gbWFrZSB0aGUgcnVsZSBsaXZlXG4gICAgICogQHBhcmFtIG9ic2VydmUgc2V0IHdoZXRoZXIgb3Igbm90IHRvIHJldHVybiB0aGUgZGF0YSBPYnNlcnZhYmxlIGFzIHRoZSBib2R5LCByZXNwb25zZSBvciBldmVudHMuIGRlZmF1bHRzIHRvIHJldHVybmluZyB0aGUgYm9keS5cbiAgICAgKiBAcGFyYW0gcmVwb3J0UHJvZ3Jlc3MgZmxhZyB0byByZXBvcnQgcmVxdWVzdCBhbmQgcmVzcG9uc2UgcHJvZ3Jlc3MuXG4gICAgICovXG4gICAgcHVibGljIHVwZGF0ZUFsdGVybmF0ZVNlbnNlKHRleHQ6IHN0cmluZywgbGFuZ3VhZ2U6IHN0cmluZywgZGVwZW5kZW5jeTogUnVsZVRleHQsIGNsaWVudElkPzogbnVtYmVyLCBwdWJsaXNoPzogYm9vbGVhbiwgb2JzZXJ2ZT86ICdib2R5JywgcmVwb3J0UHJvZ3Jlc3M/OiBib29sZWFuKTogT2JzZXJ2YWJsZTxSdWxlPjtcbiAgICBwdWJsaWMgdXBkYXRlQWx0ZXJuYXRlU2Vuc2UodGV4dDogc3RyaW5nLCBsYW5ndWFnZTogc3RyaW5nLCBkZXBlbmRlbmN5OiBSdWxlVGV4dCwgY2xpZW50SWQ/OiBudW1iZXIsIHB1Ymxpc2g/OiBib29sZWFuLCBvYnNlcnZlPzogJ3Jlc3BvbnNlJywgcmVwb3J0UHJvZ3Jlc3M/OiBib29sZWFuKTogT2JzZXJ2YWJsZTxIdHRwUmVzcG9uc2U8UnVsZT4+O1xuICAgIHB1YmxpYyB1cGRhdGVBbHRlcm5hdGVTZW5zZSh0ZXh0OiBzdHJpbmcsIGxhbmd1YWdlOiBzdHJpbmcsIGRlcGVuZGVuY3k6IFJ1bGVUZXh0LCBjbGllbnRJZD86IG51bWJlciwgcHVibGlzaD86IGJvb2xlYW4sIG9ic2VydmU/OiAnZXZlbnRzJywgcmVwb3J0UHJvZ3Jlc3M/OiBib29sZWFuKTogT2JzZXJ2YWJsZTxIdHRwRXZlbnQ8UnVsZT4+O1xuICAgIHB1YmxpYyB1cGRhdGVBbHRlcm5hdGVTZW5zZSh0ZXh0OiBzdHJpbmcsIGxhbmd1YWdlOiBzdHJpbmcsIGRlcGVuZGVuY3k6IFJ1bGVUZXh0LCBjbGllbnRJZD86IG51bWJlciwgcHVibGlzaD86IGJvb2xlYW4sIG9ic2VydmU6IGFueSA9ICdib2R5JywgcmVwb3J0UHJvZ3Jlc3M6IGJvb2xlYW4gPSBmYWxzZSApOiBPYnNlcnZhYmxlPGFueT4ge1xuXG4gICAgICAgIGlmICh0ZXh0ID09PSBudWxsIHx8IHRleHQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZXF1aXJlZCBwYXJhbWV0ZXIgdGV4dCB3YXMgbnVsbCBvciB1bmRlZmluZWQgd2hlbiBjYWxsaW5nIHVwZGF0ZUFsdGVybmF0ZVNlbnNlLicpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGxhbmd1YWdlID09PSBudWxsIHx8IGxhbmd1YWdlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignUmVxdWlyZWQgcGFyYW1ldGVyIGxhbmd1YWdlIHdhcyBudWxsIG9yIHVuZGVmaW5lZCB3aGVuIGNhbGxpbmcgdXBkYXRlQWx0ZXJuYXRlU2Vuc2UuJyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZGVwZW5kZW5jeSA9PT0gbnVsbCB8fCBkZXBlbmRlbmN5ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignUmVxdWlyZWQgcGFyYW1ldGVyIGRlcGVuZGVuY3kgd2FzIG51bGwgb3IgdW5kZWZpbmVkIHdoZW4gY2FsbGluZyB1cGRhdGVBbHRlcm5hdGVTZW5zZS4nKTtcbiAgICAgICAgfVxuXG5cblxuICAgICAgICBsZXQgcXVlcnlQYXJhbWV0ZXJzID0gbmV3IEh0dHBQYXJhbXMoe2VuY29kZXI6IG5ldyBDdXN0b21IdHRwVXJsRW5jb2RpbmdDb2RlYygpfSk7XG4gICAgICAgIGlmIChsYW5ndWFnZSAhPT0gdW5kZWZpbmVkICYmIGxhbmd1YWdlICE9PSBudWxsKSB7XG4gICAgICAgICAgICBxdWVyeVBhcmFtZXRlcnMgPSBxdWVyeVBhcmFtZXRlcnMuc2V0KCdsYW5ndWFnZScsIDxhbnk+bGFuZ3VhZ2UpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjbGllbnRJZCAhPT0gdW5kZWZpbmVkICYmIGNsaWVudElkICE9PSBudWxsKSB7XG4gICAgICAgICAgICBxdWVyeVBhcmFtZXRlcnMgPSBxdWVyeVBhcmFtZXRlcnMuc2V0KCdjbGllbnRJZCcsIDxhbnk+Y2xpZW50SWQpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChwdWJsaXNoICE9PSB1bmRlZmluZWQgJiYgcHVibGlzaCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgcXVlcnlQYXJhbWV0ZXJzID0gcXVlcnlQYXJhbWV0ZXJzLnNldCgncHVibGlzaCcsIDxhbnk+cHVibGlzaCk7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgaGVhZGVycyA9IHRoaXMuZGVmYXVsdEhlYWRlcnM7XG5cbiAgICAgICAgLy8gYXV0aGVudGljYXRpb24gKGJlYXJlckF1dGgpIHJlcXVpcmVkXG4gICAgICAgIGlmICh0aGlzLmNvbmZpZ3VyYXRpb24uYWNjZXNzVG9rZW4pIHtcbiAgICAgICAgICAgIGNvbnN0IGFjY2Vzc1Rva2VuID0gdHlwZW9mIHRoaXMuY29uZmlndXJhdGlvbi5hY2Nlc3NUb2tlbiA9PT0gJ2Z1bmN0aW9uJ1xuICAgICAgICAgICAgICAgID8gdGhpcy5jb25maWd1cmF0aW9uLmFjY2Vzc1Rva2VuKClcbiAgICAgICAgICAgICAgICA6IHRoaXMuY29uZmlndXJhdGlvbi5hY2Nlc3NUb2tlbjtcbiAgICAgICAgICAgIGhlYWRlcnMgPSBoZWFkZXJzLnNldCgnQXV0aG9yaXphdGlvbicsICdCZWFyZXIgJyArIGFjY2Vzc1Rva2VuKTtcbiAgICAgICAgfVxuICAgICAgICAvLyB0byBkZXRlcm1pbmUgdGhlIEFjY2VwdCBoZWFkZXJcbiAgICAgICAgbGV0IGh0dHBIZWFkZXJBY2NlcHRzOiBzdHJpbmdbXSA9IFtcbiAgICAgICAgICAgICdhcHBsaWNhdGlvbi9qc29uJ1xuICAgICAgICBdO1xuICAgICAgICBjb25zdCBodHRwSGVhZGVyQWNjZXB0U2VsZWN0ZWQ6IHN0cmluZyB8IHVuZGVmaW5lZCA9IHRoaXMuY29uZmlndXJhdGlvbi5zZWxlY3RIZWFkZXJBY2NlcHQoaHR0cEhlYWRlckFjY2VwdHMpO1xuICAgICAgICBpZiAoaHR0cEhlYWRlckFjY2VwdFNlbGVjdGVkICE9IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgaGVhZGVycyA9IGhlYWRlcnMuc2V0KCdBY2NlcHQnLCBodHRwSGVhZGVyQWNjZXB0U2VsZWN0ZWQpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gdG8gZGV0ZXJtaW5lIHRoZSBDb250ZW50LVR5cGUgaGVhZGVyXG4gICAgICAgIGNvbnN0IGNvbnN1bWVzOiBzdHJpbmdbXSA9IFtcbiAgICAgICAgXTtcblxuICAgICAgICByZXR1cm4gdGhpcy5odHRwQ2xpZW50LnJlcXVlc3Q8UnVsZT4oJ3B1dCcsYCR7dGhpcy5iYXNlUGF0aH0vcnVsZXMvdGV4dC8ke2VuY29kZVVSSUNvbXBvbmVudChTdHJpbmcodGV4dCkpfS9hbHRfc2Vuc2VzLyR7ZW5jb2RlVVJJQ29tcG9uZW50KFN0cmluZyhkZXBlbmRlbmN5KSl9YCxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBwYXJhbXM6IHF1ZXJ5UGFyYW1ldGVycyxcbiAgICAgICAgICAgICAgICB3aXRoQ3JlZGVudGlhbHM6IHRoaXMuY29uZmlndXJhdGlvbi53aXRoQ3JlZGVudGlhbHMsXG4gICAgICAgICAgICAgICAgaGVhZGVyczogaGVhZGVycyxcbiAgICAgICAgICAgICAgICBvYnNlcnZlOiBvYnNlcnZlLFxuICAgICAgICAgICAgICAgIHJlcG9ydFByb2dyZXNzOiByZXBvcnRQcm9ncmVzc1xuICAgICAgICAgICAgfVxuICAgICAgICApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFVwZGF0ZSB0aGUgY3VycmVudCBhbHRlcm5hdGUgc3BlbGxpbmcgKG9yIGFkZCBpZiBkb2VzIG5vdCBleGlzdCkgd2l0aCB0aGlzIHZhbHVlLlxuICAgICAqIFRoaXMgd2lsbCB1cGRhdGUgYW4gYWx0ZXJuYXRlIHNwZWxsaW5nIGZvciBhIHJ1bGUgYW5kIGxvZyB0aGUgY2hhbmdlICBBbHRlcm5hdGUgc3BlbGxpbmdzIHdpbGwgcmVwbGFjZSB0aGlzIHdvcmQgd2l0aCBhbm90aGVyIHdvcmQgRVZFUlkgVElNRS4gIFlvdSBjYW4gaGF2ZSBtb3JlIHRoYW4gb25lIGFsdCBzcGVsbGluZyBhbmQgaXQgd2lsbCBjaG9vc2UgdGhlIGJlc3Qgb25lIGJhc2VkIG9uIGNvbnRleHQgb3IgdGhlIGhpZ2hlciByaXNrIG9uZSBpZiB0aGV5IGFyZSB0aWVkLiBcbiAgICAgKiBAcGFyYW0gdGV4dCBUaGUgdGV4dCBvZiB0aGUgcnVsZSB5b3Ugd2FudCB0byB3b3JrIG9uXG4gICAgICogQHBhcmFtIGxhbmd1YWdlIFNob3cgcmVzdWx0cyBmb3IgdGhlIGdpdmVuIGxhbmd1YWdlIG9ubHkuICAgVGhpcyBpcyB0aGUgbGFuZ3VhZ2UgdXNlZCwgY291bGQgaGF2ZSBiZWVuIHNldCBieSB0aGUgdXNlciBvciBkZXRlY3RlZCBieSBsYW5ndWFnZSBpZC5cbiAgICAgKiBAcGFyYW0gZGVwZW5kZW5jeSBUaGlzIGlzIHRoZSByZWxhdGVkIHRleHQgeW91IHdhbnQgdG8gd29yayBvbi5cbiAgICAgKiBAcGFyYW0gY2xpZW50SWQgU2hvdyByZXN1bHRzIGZvciBhIGdpdmVuIGNsaWVudC4gIFR5cGljYWxseSB0aGlzIGlzIHNldCBmb3IgeW91IGJ5IHRoZSBpbnRlcm5hbCBzeXN0ZW0gYmFzZWQgb24gdGhlIEFQSV9LRVkgeW91IGFyZSB1c2luZy4gIEhvd2V2ZXIgc29tZSBjbGllbnRzIGFyZSBhbGxvd2VkIHRvIHZpZXcgb3RoZXIgY2xpZW50cyBzdWNoIGFzIHdoZW4gdGhleSBoYXZlIGEgc2FuZGJveCBvciB3aGVuIHRoZXkgYXJlIGEgbGFyZ2UgZW50ZXJwcmlzZSBhbmQgaGF2ZSBtdWx0aXBsZSBjbGllbnRzIHRoZXkgbWFuYWdlLiAgSXQgd2lsbCBvbmx5IGFsbG93IHlvdSB0byB2aWV3IGNsaWVudCBkYXRhIHlvdSBoYXZlIGFjY2VzcyB0by5cbiAgICAgKiBAcGFyYW0gcHVibGlzaCBUaGlzIHdpbGwgYWxzbyBtYWtlIHRoZSBydWxlIGxpdmVcbiAgICAgKiBAcGFyYW0gb2JzZXJ2ZSBzZXQgd2hldGhlciBvciBub3QgdG8gcmV0dXJuIHRoZSBkYXRhIE9ic2VydmFibGUgYXMgdGhlIGJvZHksIHJlc3BvbnNlIG9yIGV2ZW50cy4gZGVmYXVsdHMgdG8gcmV0dXJuaW5nIHRoZSBib2R5LlxuICAgICAqIEBwYXJhbSByZXBvcnRQcm9ncmVzcyBmbGFnIHRvIHJlcG9ydCByZXF1ZXN0IGFuZCByZXNwb25zZSBwcm9ncmVzcy5cbiAgICAgKi9cbiAgICBwdWJsaWMgdXBkYXRlQWx0ZXJuYXRlU3BlbGxpbmcodGV4dDogc3RyaW5nLCBsYW5ndWFnZTogc3RyaW5nLCBkZXBlbmRlbmN5OiBSdWxlVGV4dCwgY2xpZW50SWQ/OiBudW1iZXIsIHB1Ymxpc2g/OiBib29sZWFuLCBvYnNlcnZlPzogJ2JvZHknLCByZXBvcnRQcm9ncmVzcz86IGJvb2xlYW4pOiBPYnNlcnZhYmxlPFJ1bGU+O1xuICAgIHB1YmxpYyB1cGRhdGVBbHRlcm5hdGVTcGVsbGluZyh0ZXh0OiBzdHJpbmcsIGxhbmd1YWdlOiBzdHJpbmcsIGRlcGVuZGVuY3k6IFJ1bGVUZXh0LCBjbGllbnRJZD86IG51bWJlciwgcHVibGlzaD86IGJvb2xlYW4sIG9ic2VydmU/OiAncmVzcG9uc2UnLCByZXBvcnRQcm9ncmVzcz86IGJvb2xlYW4pOiBPYnNlcnZhYmxlPEh0dHBSZXNwb25zZTxSdWxlPj47XG4gICAgcHVibGljIHVwZGF0ZUFsdGVybmF0ZVNwZWxsaW5nKHRleHQ6IHN0cmluZywgbGFuZ3VhZ2U6IHN0cmluZywgZGVwZW5kZW5jeTogUnVsZVRleHQsIGNsaWVudElkPzogbnVtYmVyLCBwdWJsaXNoPzogYm9vbGVhbiwgb2JzZXJ2ZT86ICdldmVudHMnLCByZXBvcnRQcm9ncmVzcz86IGJvb2xlYW4pOiBPYnNlcnZhYmxlPEh0dHBFdmVudDxSdWxlPj47XG4gICAgcHVibGljIHVwZGF0ZUFsdGVybmF0ZVNwZWxsaW5nKHRleHQ6IHN0cmluZywgbGFuZ3VhZ2U6IHN0cmluZywgZGVwZW5kZW5jeTogUnVsZVRleHQsIGNsaWVudElkPzogbnVtYmVyLCBwdWJsaXNoPzogYm9vbGVhbiwgb2JzZXJ2ZTogYW55ID0gJ2JvZHknLCByZXBvcnRQcm9ncmVzczogYm9vbGVhbiA9IGZhbHNlICk6IE9ic2VydmFibGU8YW55PiB7XG5cbiAgICAgICAgaWYgKHRleHQgPT09IG51bGwgfHwgdGV4dCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1JlcXVpcmVkIHBhcmFtZXRlciB0ZXh0IHdhcyBudWxsIG9yIHVuZGVmaW5lZCB3aGVuIGNhbGxpbmcgdXBkYXRlQWx0ZXJuYXRlU3BlbGxpbmcuJyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAobGFuZ3VhZ2UgPT09IG51bGwgfHwgbGFuZ3VhZ2UgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZXF1aXJlZCBwYXJhbWV0ZXIgbGFuZ3VhZ2Ugd2FzIG51bGwgb3IgdW5kZWZpbmVkIHdoZW4gY2FsbGluZyB1cGRhdGVBbHRlcm5hdGVTcGVsbGluZy4nKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChkZXBlbmRlbmN5ID09PSBudWxsIHx8IGRlcGVuZGVuY3kgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZXF1aXJlZCBwYXJhbWV0ZXIgZGVwZW5kZW5jeSB3YXMgbnVsbCBvciB1bmRlZmluZWQgd2hlbiBjYWxsaW5nIHVwZGF0ZUFsdGVybmF0ZVNwZWxsaW5nLicpO1xuICAgICAgICB9XG5cblxuXG4gICAgICAgIGxldCBxdWVyeVBhcmFtZXRlcnMgPSBuZXcgSHR0cFBhcmFtcyh7ZW5jb2RlcjogbmV3IEN1c3RvbUh0dHBVcmxFbmNvZGluZ0NvZGVjKCl9KTtcbiAgICAgICAgaWYgKGxhbmd1YWdlICE9PSB1bmRlZmluZWQgJiYgbGFuZ3VhZ2UgIT09IG51bGwpIHtcbiAgICAgICAgICAgIHF1ZXJ5UGFyYW1ldGVycyA9IHF1ZXJ5UGFyYW1ldGVycy5zZXQoJ2xhbmd1YWdlJywgPGFueT5sYW5ndWFnZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNsaWVudElkICE9PSB1bmRlZmluZWQgJiYgY2xpZW50SWQgIT09IG51bGwpIHtcbiAgICAgICAgICAgIHF1ZXJ5UGFyYW1ldGVycyA9IHF1ZXJ5UGFyYW1ldGVycy5zZXQoJ2NsaWVudElkJywgPGFueT5jbGllbnRJZCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHB1Ymxpc2ggIT09IHVuZGVmaW5lZCAmJiBwdWJsaXNoICE9PSBudWxsKSB7XG4gICAgICAgICAgICBxdWVyeVBhcmFtZXRlcnMgPSBxdWVyeVBhcmFtZXRlcnMuc2V0KCdwdWJsaXNoJywgPGFueT5wdWJsaXNoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBoZWFkZXJzID0gdGhpcy5kZWZhdWx0SGVhZGVycztcblxuICAgICAgICAvLyBhdXRoZW50aWNhdGlvbiAoYmVhcmVyQXV0aCkgcmVxdWlyZWRcbiAgICAgICAgaWYgKHRoaXMuY29uZmlndXJhdGlvbi5hY2Nlc3NUb2tlbikge1xuICAgICAgICAgICAgY29uc3QgYWNjZXNzVG9rZW4gPSB0eXBlb2YgdGhpcy5jb25maWd1cmF0aW9uLmFjY2Vzc1Rva2VuID09PSAnZnVuY3Rpb24nXG4gICAgICAgICAgICAgICAgPyB0aGlzLmNvbmZpZ3VyYXRpb24uYWNjZXNzVG9rZW4oKVxuICAgICAgICAgICAgICAgIDogdGhpcy5jb25maWd1cmF0aW9uLmFjY2Vzc1Rva2VuO1xuICAgICAgICAgICAgaGVhZGVycyA9IGhlYWRlcnMuc2V0KCdBdXRob3JpemF0aW9uJywgJ0JlYXJlciAnICsgYWNjZXNzVG9rZW4pO1xuICAgICAgICB9XG4gICAgICAgIC8vIHRvIGRldGVybWluZSB0aGUgQWNjZXB0IGhlYWRlclxuICAgICAgICBsZXQgaHR0cEhlYWRlckFjY2VwdHM6IHN0cmluZ1tdID0gW1xuICAgICAgICAgICAgJ2FwcGxpY2F0aW9uL2pzb24nXG4gICAgICAgIF07XG4gICAgICAgIGNvbnN0IGh0dHBIZWFkZXJBY2NlcHRTZWxlY3RlZDogc3RyaW5nIHwgdW5kZWZpbmVkID0gdGhpcy5jb25maWd1cmF0aW9uLnNlbGVjdEhlYWRlckFjY2VwdChodHRwSGVhZGVyQWNjZXB0cyk7XG4gICAgICAgIGlmIChodHRwSGVhZGVyQWNjZXB0U2VsZWN0ZWQgIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBoZWFkZXJzID0gaGVhZGVycy5zZXQoJ0FjY2VwdCcsIGh0dHBIZWFkZXJBY2NlcHRTZWxlY3RlZCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyB0byBkZXRlcm1pbmUgdGhlIENvbnRlbnQtVHlwZSBoZWFkZXJcbiAgICAgICAgY29uc3QgY29uc3VtZXM6IHN0cmluZ1tdID0gW1xuICAgICAgICBdO1xuXG4gICAgICAgIHJldHVybiB0aGlzLmh0dHBDbGllbnQucmVxdWVzdDxSdWxlPigncHV0JyxgJHt0aGlzLmJhc2VQYXRofS9ydWxlcy90ZXh0LyR7ZW5jb2RlVVJJQ29tcG9uZW50KFN0cmluZyh0ZXh0KSl9L2FsdF9zcGVsbGluZ3MvJHtlbmNvZGVVUklDb21wb25lbnQoU3RyaW5nKGRlcGVuZGVuY3kpKX1gLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHBhcmFtczogcXVlcnlQYXJhbWV0ZXJzLFxuICAgICAgICAgICAgICAgIHdpdGhDcmVkZW50aWFsczogdGhpcy5jb25maWd1cmF0aW9uLndpdGhDcmVkZW50aWFscyxcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiBoZWFkZXJzLFxuICAgICAgICAgICAgICAgIG9ic2VydmU6IG9ic2VydmUsXG4gICAgICAgICAgICAgICAgcmVwb3J0UHJvZ3Jlc3M6IHJlcG9ydFByb2dyZXNzXG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVXBkYXRlIGEgY29tbWVudFxuICAgICAqIENvbW1lbnRzIGFyZSB3YXlzIHRvIGxlYXZlIGEgbm90ZSB0byBzYXkgd2h5IGEgcGVyc29uIG1hZGUgdGhlIGRlY2lzaW9uIHRoZXkgZGlkLiAgT3IgaXQgY291bGQgYmUgYSBxdWVzdGlvbiBvciBhbnN3ZXIgdHJ5aW5nIHRvIGdldCBoZWxwIG9uIGFuIGl0ZW0uIFxuICAgICAqIEBwYXJhbSBsYW5ndWFnZSBTaG93IHJlc3VsdHMgZm9yIHRoZSBnaXZlbiBsYW5ndWFnZSBvbmx5LiAgIFRoaXMgaXMgdGhlIGxhbmd1YWdlIHVzZWQsIGNvdWxkIGhhdmUgYmVlbiBzZXQgYnkgdGhlIHVzZXIgb3IgZGV0ZWN0ZWQgYnkgbGFuZ3VhZ2UgaWQuXG4gICAgICogQHBhcmFtIHRleHQgVGhlIHRleHQgb2YgdGhlIHJ1bGUgeW91IHdhbnQgdG8gd29yayBvblxuICAgICAqIEBwYXJhbSBjb21tZW50SWQgVGhlIHVuaXF1ZSBpZGVudGlmaWVyIGZvciB0aGUgY29tbWVudFxuICAgICAqIEBwYXJhbSBib2R5IFxuICAgICAqIEBwYXJhbSBjbGllbnRJZCBTaG93IHJlc3VsdHMgZm9yIGEgZ2l2ZW4gY2xpZW50LiAgVHlwaWNhbGx5IHRoaXMgaXMgc2V0IGZvciB5b3UgYnkgdGhlIGludGVybmFsIHN5c3RlbSBiYXNlZCBvbiB0aGUgQVBJX0tFWSB5b3UgYXJlIHVzaW5nLiAgSG93ZXZlciBzb21lIGNsaWVudHMgYXJlIGFsbG93ZWQgdG8gdmlldyBvdGhlciBjbGllbnRzIHN1Y2ggYXMgd2hlbiB0aGV5IGhhdmUgYSBzYW5kYm94IG9yIHdoZW4gdGhleSBhcmUgYSBsYXJnZSBlbnRlcnByaXNlIGFuZCBoYXZlIG11bHRpcGxlIGNsaWVudHMgdGhleSBtYW5hZ2UuICBJdCB3aWxsIG9ubHkgYWxsb3cgeW91IHRvIHZpZXcgY2xpZW50IGRhdGEgeW91IGhhdmUgYWNjZXNzIHRvLlxuICAgICAqIEBwYXJhbSBvYnNlcnZlIHNldCB3aGV0aGVyIG9yIG5vdCB0byByZXR1cm4gdGhlIGRhdGEgT2JzZXJ2YWJsZSBhcyB0aGUgYm9keSwgcmVzcG9uc2Ugb3IgZXZlbnRzLiBkZWZhdWx0cyB0byByZXR1cm5pbmcgdGhlIGJvZHkuXG4gICAgICogQHBhcmFtIHJlcG9ydFByb2dyZXNzIGZsYWcgdG8gcmVwb3J0IHJlcXVlc3QgYW5kIHJlc3BvbnNlIHByb2dyZXNzLlxuICAgICAqL1xuICAgIHB1YmxpYyB1cGRhdGVDb21tZW50KGxhbmd1YWdlOiBzdHJpbmcsIHRleHQ6IHN0cmluZywgY29tbWVudElkOiBzdHJpbmcsIGJvZHk/OiBDb21tZW50LCBjbGllbnRJZD86IG51bWJlciwgb2JzZXJ2ZT86ICdib2R5JywgcmVwb3J0UHJvZ3Jlc3M/OiBib29sZWFuKTogT2JzZXJ2YWJsZTxDb21tZW50PjtcbiAgICBwdWJsaWMgdXBkYXRlQ29tbWVudChsYW5ndWFnZTogc3RyaW5nLCB0ZXh0OiBzdHJpbmcsIGNvbW1lbnRJZDogc3RyaW5nLCBib2R5PzogQ29tbWVudCwgY2xpZW50SWQ/OiBudW1iZXIsIG9ic2VydmU/OiAncmVzcG9uc2UnLCByZXBvcnRQcm9ncmVzcz86IGJvb2xlYW4pOiBPYnNlcnZhYmxlPEh0dHBSZXNwb25zZTxDb21tZW50Pj47XG4gICAgcHVibGljIHVwZGF0ZUNvbW1lbnQobGFuZ3VhZ2U6IHN0cmluZywgdGV4dDogc3RyaW5nLCBjb21tZW50SWQ6IHN0cmluZywgYm9keT86IENvbW1lbnQsIGNsaWVudElkPzogbnVtYmVyLCBvYnNlcnZlPzogJ2V2ZW50cycsIHJlcG9ydFByb2dyZXNzPzogYm9vbGVhbik6IE9ic2VydmFibGU8SHR0cEV2ZW50PENvbW1lbnQ+PjtcbiAgICBwdWJsaWMgdXBkYXRlQ29tbWVudChsYW5ndWFnZTogc3RyaW5nLCB0ZXh0OiBzdHJpbmcsIGNvbW1lbnRJZDogc3RyaW5nLCBib2R5PzogQ29tbWVudCwgY2xpZW50SWQ/OiBudW1iZXIsIG9ic2VydmU6IGFueSA9ICdib2R5JywgcmVwb3J0UHJvZ3Jlc3M6IGJvb2xlYW4gPSBmYWxzZSApOiBPYnNlcnZhYmxlPGFueT4ge1xuXG4gICAgICAgIGlmIChsYW5ndWFnZSA9PT0gbnVsbCB8fCBsYW5ndWFnZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1JlcXVpcmVkIHBhcmFtZXRlciBsYW5ndWFnZSB3YXMgbnVsbCBvciB1bmRlZmluZWQgd2hlbiBjYWxsaW5nIHVwZGF0ZUNvbW1lbnQuJyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGV4dCA9PT0gbnVsbCB8fCB0ZXh0ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignUmVxdWlyZWQgcGFyYW1ldGVyIHRleHQgd2FzIG51bGwgb3IgdW5kZWZpbmVkIHdoZW4gY2FsbGluZyB1cGRhdGVDb21tZW50LicpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGNvbW1lbnRJZCA9PT0gbnVsbCB8fCBjb21tZW50SWQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZXF1aXJlZCBwYXJhbWV0ZXIgY29tbWVudElkIHdhcyBudWxsIG9yIHVuZGVmaW5lZCB3aGVuIGNhbGxpbmcgdXBkYXRlQ29tbWVudC4nKTtcbiAgICAgICAgfVxuXG5cblxuICAgICAgICBsZXQgcXVlcnlQYXJhbWV0ZXJzID0gbmV3IEh0dHBQYXJhbXMoe2VuY29kZXI6IG5ldyBDdXN0b21IdHRwVXJsRW5jb2RpbmdDb2RlYygpfSk7XG4gICAgICAgIGlmIChsYW5ndWFnZSAhPT0gdW5kZWZpbmVkICYmIGxhbmd1YWdlICE9PSBudWxsKSB7XG4gICAgICAgICAgICBxdWVyeVBhcmFtZXRlcnMgPSBxdWVyeVBhcmFtZXRlcnMuc2V0KCdsYW5ndWFnZScsIDxhbnk+bGFuZ3VhZ2UpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjbGllbnRJZCAhPT0gdW5kZWZpbmVkICYmIGNsaWVudElkICE9PSBudWxsKSB7XG4gICAgICAgICAgICBxdWVyeVBhcmFtZXRlcnMgPSBxdWVyeVBhcmFtZXRlcnMuc2V0KCdjbGllbnRJZCcsIDxhbnk+Y2xpZW50SWQpO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IGhlYWRlcnMgPSB0aGlzLmRlZmF1bHRIZWFkZXJzO1xuXG4gICAgICAgIC8vIGF1dGhlbnRpY2F0aW9uIChiZWFyZXJBdXRoKSByZXF1aXJlZFxuICAgICAgICBpZiAodGhpcy5jb25maWd1cmF0aW9uLmFjY2Vzc1Rva2VuKSB7XG4gICAgICAgICAgICBjb25zdCBhY2Nlc3NUb2tlbiA9IHR5cGVvZiB0aGlzLmNvbmZpZ3VyYXRpb24uYWNjZXNzVG9rZW4gPT09ICdmdW5jdGlvbidcbiAgICAgICAgICAgICAgICA/IHRoaXMuY29uZmlndXJhdGlvbi5hY2Nlc3NUb2tlbigpXG4gICAgICAgICAgICAgICAgOiB0aGlzLmNvbmZpZ3VyYXRpb24uYWNjZXNzVG9rZW47XG4gICAgICAgICAgICBoZWFkZXJzID0gaGVhZGVycy5zZXQoJ0F1dGhvcml6YXRpb24nLCAnQmVhcmVyICcgKyBhY2Nlc3NUb2tlbik7XG4gICAgICAgIH1cbiAgICAgICAgLy8gdG8gZGV0ZXJtaW5lIHRoZSBBY2NlcHQgaGVhZGVyXG4gICAgICAgIGxldCBodHRwSGVhZGVyQWNjZXB0czogc3RyaW5nW10gPSBbXG4gICAgICAgICAgICAnYXBwbGljYXRpb24vanNvbidcbiAgICAgICAgXTtcbiAgICAgICAgY29uc3QgaHR0cEhlYWRlckFjY2VwdFNlbGVjdGVkOiBzdHJpbmcgfCB1bmRlZmluZWQgPSB0aGlzLmNvbmZpZ3VyYXRpb24uc2VsZWN0SGVhZGVyQWNjZXB0KGh0dHBIZWFkZXJBY2NlcHRzKTtcbiAgICAgICAgaWYgKGh0dHBIZWFkZXJBY2NlcHRTZWxlY3RlZCAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGhlYWRlcnMgPSBoZWFkZXJzLnNldCgnQWNjZXB0JywgaHR0cEhlYWRlckFjY2VwdFNlbGVjdGVkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHRvIGRldGVybWluZSB0aGUgQ29udGVudC1UeXBlIGhlYWRlclxuICAgICAgICBjb25zdCBjb25zdW1lczogc3RyaW5nW10gPSBbXG4gICAgICAgICAgICAnYXBwbGljYXRpb24vanNvbidcbiAgICAgICAgXTtcbiAgICAgICAgY29uc3QgaHR0cENvbnRlbnRUeXBlU2VsZWN0ZWQ6IHN0cmluZyB8IHVuZGVmaW5lZCA9IHRoaXMuY29uZmlndXJhdGlvbi5zZWxlY3RIZWFkZXJDb250ZW50VHlwZShjb25zdW1lcyk7XG4gICAgICAgIGlmIChodHRwQ29udGVudFR5cGVTZWxlY3RlZCAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGhlYWRlcnMgPSBoZWFkZXJzLnNldCgnQ29udGVudC1UeXBlJywgaHR0cENvbnRlbnRUeXBlU2VsZWN0ZWQpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cENsaWVudC5yZXF1ZXN0PENvbW1lbnQ+KCdwdXQnLGAke3RoaXMuYmFzZVBhdGh9L3J1bGVzL3RleHQvJHtlbmNvZGVVUklDb21wb25lbnQoU3RyaW5nKHRleHQpKX0vY29tbWVudHMvJHtlbmNvZGVVUklDb21wb25lbnQoU3RyaW5nKGNvbW1lbnRJZCkpfWAsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgYm9keTogYm9keSxcbiAgICAgICAgICAgICAgICBwYXJhbXM6IHF1ZXJ5UGFyYW1ldGVycyxcbiAgICAgICAgICAgICAgICB3aXRoQ3JlZGVudGlhbHM6IHRoaXMuY29uZmlndXJhdGlvbi53aXRoQ3JlZGVudGlhbHMsXG4gICAgICAgICAgICAgICAgaGVhZGVyczogaGVhZGVycyxcbiAgICAgICAgICAgICAgICBvYnNlcnZlOiBvYnNlcnZlLFxuICAgICAgICAgICAgICAgIHJlcG9ydFByb2dyZXNzOiByZXBvcnRQcm9ncmVzc1xuICAgICAgICAgICAgfVxuICAgICAgICApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFVwZGF0ZSB0aGUgYSBmbGFnIGFzc29jaWF0ZWQgKG9yIGFkZCBpZiBkb2VzIG5vdCBleGlzdCkgd2l0aCB0aGlzIHZhbHVlLlxuICAgICAqIFRoaXMgd2lsbCB1cGRhdGUgYSBmbGFnIHdpdGggdGhpcyBydWxlICBUaGVzZSBhcmUgYSBzZXJpZXMgb2Ygc3BlY2lhbCBhdHRyaWJ1dGVzIHlvdSBjYW4gYWRkIHRvIGFuIGl0ZW0uIEZvciBpbnN0YW5jZSBpZiB5b3UgYWRkIEZJUlNUX05BTUUgZmxhZyBpdCB3aWxsIGF1dG9tYXRpY2FsbHkgYWRkIGFuIGFsdF9zZW5zZSBvZiB7e2ZpcnN0X25hbWV9fSBhbmQgYWRkIG90aGVyIGxvZ2ljIGludGVyYWxseSB0byB0cmVhdCBpdCBhcyBwb3RlbnRpYWwgUElJIFxuICAgICAqIEBwYXJhbSB0ZXh0IFRoZSB0ZXh0IG9mIHRoZSBydWxlIHlvdSB3YW50IHRvIHdvcmsgb25cbiAgICAgKiBAcGFyYW0gbGFuZ3VhZ2UgU2hvdyByZXN1bHRzIGZvciB0aGUgZ2l2ZW4gbGFuZ3VhZ2Ugb25seS4gICBUaGlzIGlzIHRoZSBsYW5ndWFnZSB1c2VkLCBjb3VsZCBoYXZlIGJlZW4gc2V0IGJ5IHRoZSB1c2VyIG9yIGRldGVjdGVkIGJ5IGxhbmd1YWdlIGlkLlxuICAgICAqIEBwYXJhbSBmbGFnIFRoZSBuYW1lIG9mIHRoZSBmbGFnIHRvIGNoYW5nZVxuICAgICAqIEBwYXJhbSBjbGllbnRJZCBTaG93IHJlc3VsdHMgZm9yIGEgZ2l2ZW4gY2xpZW50LiAgVHlwaWNhbGx5IHRoaXMgaXMgc2V0IGZvciB5b3UgYnkgdGhlIGludGVybmFsIHN5c3RlbSBiYXNlZCBvbiB0aGUgQVBJX0tFWSB5b3UgYXJlIHVzaW5nLiAgSG93ZXZlciBzb21lIGNsaWVudHMgYXJlIGFsbG93ZWQgdG8gdmlldyBvdGhlciBjbGllbnRzIHN1Y2ggYXMgd2hlbiB0aGV5IGhhdmUgYSBzYW5kYm94IG9yIHdoZW4gdGhleSBhcmUgYSBsYXJnZSBlbnRlcnByaXNlIGFuZCBoYXZlIG11bHRpcGxlIGNsaWVudHMgdGhleSBtYW5hZ2UuICBJdCB3aWxsIG9ubHkgYWxsb3cgeW91IHRvIHZpZXcgY2xpZW50IGRhdGEgeW91IGhhdmUgYWNjZXNzIHRvLlxuICAgICAqIEBwYXJhbSBwdWJsaXNoIFRoaXMgd2lsbCBhbHNvIG1ha2UgdGhlIHJ1bGUgbGl2ZVxuICAgICAqIEBwYXJhbSBvYnNlcnZlIHNldCB3aGV0aGVyIG9yIG5vdCB0byByZXR1cm4gdGhlIGRhdGEgT2JzZXJ2YWJsZSBhcyB0aGUgYm9keSwgcmVzcG9uc2Ugb3IgZXZlbnRzLiBkZWZhdWx0cyB0byByZXR1cm5pbmcgdGhlIGJvZHkuXG4gICAgICogQHBhcmFtIHJlcG9ydFByb2dyZXNzIGZsYWcgdG8gcmVwb3J0IHJlcXVlc3QgYW5kIHJlc3BvbnNlIHByb2dyZXNzLlxuICAgICAqL1xuICAgIHB1YmxpYyB1cGRhdGVGbGFnKHRleHQ6IHN0cmluZywgbGFuZ3VhZ2U6IHN0cmluZywgZmxhZzogRmxhZywgY2xpZW50SWQ/OiBudW1iZXIsIHB1Ymxpc2g/OiBib29sZWFuLCBvYnNlcnZlPzogJ2JvZHknLCByZXBvcnRQcm9ncmVzcz86IGJvb2xlYW4pOiBPYnNlcnZhYmxlPFJ1bGU+O1xuICAgIHB1YmxpYyB1cGRhdGVGbGFnKHRleHQ6IHN0cmluZywgbGFuZ3VhZ2U6IHN0cmluZywgZmxhZzogRmxhZywgY2xpZW50SWQ/OiBudW1iZXIsIHB1Ymxpc2g/OiBib29sZWFuLCBvYnNlcnZlPzogJ3Jlc3BvbnNlJywgcmVwb3J0UHJvZ3Jlc3M/OiBib29sZWFuKTogT2JzZXJ2YWJsZTxIdHRwUmVzcG9uc2U8UnVsZT4+O1xuICAgIHB1YmxpYyB1cGRhdGVGbGFnKHRleHQ6IHN0cmluZywgbGFuZ3VhZ2U6IHN0cmluZywgZmxhZzogRmxhZywgY2xpZW50SWQ/OiBudW1iZXIsIHB1Ymxpc2g/OiBib29sZWFuLCBvYnNlcnZlPzogJ2V2ZW50cycsIHJlcG9ydFByb2dyZXNzPzogYm9vbGVhbik6IE9ic2VydmFibGU8SHR0cEV2ZW50PFJ1bGU+PjtcbiAgICBwdWJsaWMgdXBkYXRlRmxhZyh0ZXh0OiBzdHJpbmcsIGxhbmd1YWdlOiBzdHJpbmcsIGZsYWc6IEZsYWcsIGNsaWVudElkPzogbnVtYmVyLCBwdWJsaXNoPzogYm9vbGVhbiwgb2JzZXJ2ZTogYW55ID0gJ2JvZHknLCByZXBvcnRQcm9ncmVzczogYm9vbGVhbiA9IGZhbHNlICk6IE9ic2VydmFibGU8YW55PiB7XG5cbiAgICAgICAgaWYgKHRleHQgPT09IG51bGwgfHwgdGV4dCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1JlcXVpcmVkIHBhcmFtZXRlciB0ZXh0IHdhcyBudWxsIG9yIHVuZGVmaW5lZCB3aGVuIGNhbGxpbmcgdXBkYXRlRmxhZy4nKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChsYW5ndWFnZSA9PT0gbnVsbCB8fCBsYW5ndWFnZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1JlcXVpcmVkIHBhcmFtZXRlciBsYW5ndWFnZSB3YXMgbnVsbCBvciB1bmRlZmluZWQgd2hlbiBjYWxsaW5nIHVwZGF0ZUZsYWcuJyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZmxhZyA9PT0gbnVsbCB8fCBmbGFnID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignUmVxdWlyZWQgcGFyYW1ldGVyIGZsYWcgd2FzIG51bGwgb3IgdW5kZWZpbmVkIHdoZW4gY2FsbGluZyB1cGRhdGVGbGFnLicpO1xuICAgICAgICB9XG5cblxuXG4gICAgICAgIGxldCBxdWVyeVBhcmFtZXRlcnMgPSBuZXcgSHR0cFBhcmFtcyh7ZW5jb2RlcjogbmV3IEN1c3RvbUh0dHBVcmxFbmNvZGluZ0NvZGVjKCl9KTtcbiAgICAgICAgaWYgKGxhbmd1YWdlICE9PSB1bmRlZmluZWQgJiYgbGFuZ3VhZ2UgIT09IG51bGwpIHtcbiAgICAgICAgICAgIHF1ZXJ5UGFyYW1ldGVycyA9IHF1ZXJ5UGFyYW1ldGVycy5zZXQoJ2xhbmd1YWdlJywgPGFueT5sYW5ndWFnZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNsaWVudElkICE9PSB1bmRlZmluZWQgJiYgY2xpZW50SWQgIT09IG51bGwpIHtcbiAgICAgICAgICAgIHF1ZXJ5UGFyYW1ldGVycyA9IHF1ZXJ5UGFyYW1ldGVycy5zZXQoJ2NsaWVudElkJywgPGFueT5jbGllbnRJZCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHB1Ymxpc2ggIT09IHVuZGVmaW5lZCAmJiBwdWJsaXNoICE9PSBudWxsKSB7XG4gICAgICAgICAgICBxdWVyeVBhcmFtZXRlcnMgPSBxdWVyeVBhcmFtZXRlcnMuc2V0KCdwdWJsaXNoJywgPGFueT5wdWJsaXNoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBoZWFkZXJzID0gdGhpcy5kZWZhdWx0SGVhZGVycztcblxuICAgICAgICAvLyBhdXRoZW50aWNhdGlvbiAoYmVhcmVyQXV0aCkgcmVxdWlyZWRcbiAgICAgICAgaWYgKHRoaXMuY29uZmlndXJhdGlvbi5hY2Nlc3NUb2tlbikge1xuICAgICAgICAgICAgY29uc3QgYWNjZXNzVG9rZW4gPSB0eXBlb2YgdGhpcy5jb25maWd1cmF0aW9uLmFjY2Vzc1Rva2VuID09PSAnZnVuY3Rpb24nXG4gICAgICAgICAgICAgICAgPyB0aGlzLmNvbmZpZ3VyYXRpb24uYWNjZXNzVG9rZW4oKVxuICAgICAgICAgICAgICAgIDogdGhpcy5jb25maWd1cmF0aW9uLmFjY2Vzc1Rva2VuO1xuICAgICAgICAgICAgaGVhZGVycyA9IGhlYWRlcnMuc2V0KCdBdXRob3JpemF0aW9uJywgJ0JlYXJlciAnICsgYWNjZXNzVG9rZW4pO1xuICAgICAgICB9XG4gICAgICAgIC8vIHRvIGRldGVybWluZSB0aGUgQWNjZXB0IGhlYWRlclxuICAgICAgICBsZXQgaHR0cEhlYWRlckFjY2VwdHM6IHN0cmluZ1tdID0gW1xuICAgICAgICAgICAgJ2FwcGxpY2F0aW9uL2pzb24nXG4gICAgICAgIF07XG4gICAgICAgIGNvbnN0IGh0dHBIZWFkZXJBY2NlcHRTZWxlY3RlZDogc3RyaW5nIHwgdW5kZWZpbmVkID0gdGhpcy5jb25maWd1cmF0aW9uLnNlbGVjdEhlYWRlckFjY2VwdChodHRwSGVhZGVyQWNjZXB0cyk7XG4gICAgICAgIGlmIChodHRwSGVhZGVyQWNjZXB0U2VsZWN0ZWQgIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBoZWFkZXJzID0gaGVhZGVycy5zZXQoJ0FjY2VwdCcsIGh0dHBIZWFkZXJBY2NlcHRTZWxlY3RlZCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyB0byBkZXRlcm1pbmUgdGhlIENvbnRlbnQtVHlwZSBoZWFkZXJcbiAgICAgICAgY29uc3QgY29uc3VtZXM6IHN0cmluZ1tdID0gW1xuICAgICAgICBdO1xuXG4gICAgICAgIHJldHVybiB0aGlzLmh0dHBDbGllbnQucmVxdWVzdDxSdWxlPigncHV0JyxgJHt0aGlzLmJhc2VQYXRofS9ydWxlcy90ZXh0LyR7ZW5jb2RlVVJJQ29tcG9uZW50KFN0cmluZyh0ZXh0KSl9L2ZsYWdzLyR7ZW5jb2RlVVJJQ29tcG9uZW50KFN0cmluZyhmbGFnKSl9YCxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBwYXJhbXM6IHF1ZXJ5UGFyYW1ldGVycyxcbiAgICAgICAgICAgICAgICB3aXRoQ3JlZGVudGlhbHM6IHRoaXMuY29uZmlndXJhdGlvbi53aXRoQ3JlZGVudGlhbHMsXG4gICAgICAgICAgICAgICAgaGVhZGVyczogaGVhZGVycyxcbiAgICAgICAgICAgICAgICBvYnNlcnZlOiBvYnNlcnZlLFxuICAgICAgICAgICAgICAgIHJlcG9ydFByb2dyZXNzOiByZXBvcnRQcm9ncmVzc1xuICAgICAgICAgICAgfVxuICAgICAgICApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFVwZGF0ZSB0aGUgY3VycmVudCBsZWV0IG1hcHBpbmcgYXNzb2NpYXRlZCAob3IgYWRkIGlmIGRvZXMgbm90IGV4aXN0KSB3aXRoIHRoaXMgdmFsdWUuXG4gICAgICogVGhpcyB3aWxsIHVwZGF0ZSBhIGxlZXQgbWFwcGluZyB3aXRoIHRoaXMgcnVsZSAgSW4gbWFueSBjYXNlcyBsZXR0ZXJzIGxpa2Ug344gb3Ig4oywIGNvdWxkIGJlIHVzZWQgaW5zdGVhZCBvZiB1ICBZb3UgY2FuIG1hcCB0aG9zZSBvdGhlciBsZXR0ZXJzIHRvIHUgYW5kIHRoZSBzeXN0ZW0gd2lsbCBzZWUgaWYgaXQgcmVzdWx0cyBpbiBhIGtub3duIHdvcmQgd2hlbiBkb2luZyBzby4gXG4gICAgICogQHBhcmFtIHRleHQgVGhlIHRleHQgb2YgdGhlIHJ1bGUgeW91IHdhbnQgdG8gd29yayBvblxuICAgICAqIEBwYXJhbSBsYW5ndWFnZSBTaG93IHJlc3VsdHMgZm9yIHRoZSBnaXZlbiBsYW5ndWFnZSBvbmx5LiAgIFRoaXMgaXMgdGhlIGxhbmd1YWdlIHVzZWQsIGNvdWxkIGhhdmUgYmVlbiBzZXQgYnkgdGhlIHVzZXIgb3IgZGV0ZWN0ZWQgYnkgbGFuZ3VhZ2UgaWQuXG4gICAgICogQHBhcmFtIGRlcGVuZGVuY3kgVGhpcyBpcyB0aGUgcmVsYXRlZCB0ZXh0IHlvdSB3YW50IHRvIHdvcmsgb24uXG4gICAgICogQHBhcmFtIGNsaWVudElkIFNob3cgcmVzdWx0cyBmb3IgYSBnaXZlbiBjbGllbnQuICBUeXBpY2FsbHkgdGhpcyBpcyBzZXQgZm9yIHlvdSBieSB0aGUgaW50ZXJuYWwgc3lzdGVtIGJhc2VkIG9uIHRoZSBBUElfS0VZIHlvdSBhcmUgdXNpbmcuICBIb3dldmVyIHNvbWUgY2xpZW50cyBhcmUgYWxsb3dlZCB0byB2aWV3IG90aGVyIGNsaWVudHMgc3VjaCBhcyB3aGVuIHRoZXkgaGF2ZSBhIHNhbmRib3ggb3Igd2hlbiB0aGV5IGFyZSBhIGxhcmdlIGVudGVycHJpc2UgYW5kIGhhdmUgbXVsdGlwbGUgY2xpZW50cyB0aGV5IG1hbmFnZS4gIEl0IHdpbGwgb25seSBhbGxvdyB5b3UgdG8gdmlldyBjbGllbnQgZGF0YSB5b3UgaGF2ZSBhY2Nlc3MgdG8uXG4gICAgICogQHBhcmFtIHB1Ymxpc2ggVGhpcyB3aWxsIGFsc28gbWFrZSB0aGUgcnVsZSBsaXZlXG4gICAgICogQHBhcmFtIG9ic2VydmUgc2V0IHdoZXRoZXIgb3Igbm90IHRvIHJldHVybiB0aGUgZGF0YSBPYnNlcnZhYmxlIGFzIHRoZSBib2R5LCByZXNwb25zZSBvciBldmVudHMuIGRlZmF1bHRzIHRvIHJldHVybmluZyB0aGUgYm9keS5cbiAgICAgKiBAcGFyYW0gcmVwb3J0UHJvZ3Jlc3MgZmxhZyB0byByZXBvcnQgcmVxdWVzdCBhbmQgcmVzcG9uc2UgcHJvZ3Jlc3MuXG4gICAgICovXG4gICAgcHVibGljIHVwZGF0ZUxlZXRNYXBwaW5nKHRleHQ6IHN0cmluZywgbGFuZ3VhZ2U6IHN0cmluZywgZGVwZW5kZW5jeTogUnVsZVRleHQsIGNsaWVudElkPzogbnVtYmVyLCBwdWJsaXNoPzogYm9vbGVhbiwgb2JzZXJ2ZT86ICdib2R5JywgcmVwb3J0UHJvZ3Jlc3M/OiBib29sZWFuKTogT2JzZXJ2YWJsZTxSdWxlPjtcbiAgICBwdWJsaWMgdXBkYXRlTGVldE1hcHBpbmcodGV4dDogc3RyaW5nLCBsYW5ndWFnZTogc3RyaW5nLCBkZXBlbmRlbmN5OiBSdWxlVGV4dCwgY2xpZW50SWQ/OiBudW1iZXIsIHB1Ymxpc2g/OiBib29sZWFuLCBvYnNlcnZlPzogJ3Jlc3BvbnNlJywgcmVwb3J0UHJvZ3Jlc3M/OiBib29sZWFuKTogT2JzZXJ2YWJsZTxIdHRwUmVzcG9uc2U8UnVsZT4+O1xuICAgIHB1YmxpYyB1cGRhdGVMZWV0TWFwcGluZyh0ZXh0OiBzdHJpbmcsIGxhbmd1YWdlOiBzdHJpbmcsIGRlcGVuZGVuY3k6IFJ1bGVUZXh0LCBjbGllbnRJZD86IG51bWJlciwgcHVibGlzaD86IGJvb2xlYW4sIG9ic2VydmU/OiAnZXZlbnRzJywgcmVwb3J0UHJvZ3Jlc3M/OiBib29sZWFuKTogT2JzZXJ2YWJsZTxIdHRwRXZlbnQ8UnVsZT4+O1xuICAgIHB1YmxpYyB1cGRhdGVMZWV0TWFwcGluZyh0ZXh0OiBzdHJpbmcsIGxhbmd1YWdlOiBzdHJpbmcsIGRlcGVuZGVuY3k6IFJ1bGVUZXh0LCBjbGllbnRJZD86IG51bWJlciwgcHVibGlzaD86IGJvb2xlYW4sIG9ic2VydmU6IGFueSA9ICdib2R5JywgcmVwb3J0UHJvZ3Jlc3M6IGJvb2xlYW4gPSBmYWxzZSApOiBPYnNlcnZhYmxlPGFueT4ge1xuXG4gICAgICAgIGlmICh0ZXh0ID09PSBudWxsIHx8IHRleHQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZXF1aXJlZCBwYXJhbWV0ZXIgdGV4dCB3YXMgbnVsbCBvciB1bmRlZmluZWQgd2hlbiBjYWxsaW5nIHVwZGF0ZUxlZXRNYXBwaW5nLicpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGxhbmd1YWdlID09PSBudWxsIHx8IGxhbmd1YWdlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignUmVxdWlyZWQgcGFyYW1ldGVyIGxhbmd1YWdlIHdhcyBudWxsIG9yIHVuZGVmaW5lZCB3aGVuIGNhbGxpbmcgdXBkYXRlTGVldE1hcHBpbmcuJyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZGVwZW5kZW5jeSA9PT0gbnVsbCB8fCBkZXBlbmRlbmN5ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignUmVxdWlyZWQgcGFyYW1ldGVyIGRlcGVuZGVuY3kgd2FzIG51bGwgb3IgdW5kZWZpbmVkIHdoZW4gY2FsbGluZyB1cGRhdGVMZWV0TWFwcGluZy4nKTtcbiAgICAgICAgfVxuXG5cblxuICAgICAgICBsZXQgcXVlcnlQYXJhbWV0ZXJzID0gbmV3IEh0dHBQYXJhbXMoe2VuY29kZXI6IG5ldyBDdXN0b21IdHRwVXJsRW5jb2RpbmdDb2RlYygpfSk7XG4gICAgICAgIGlmIChsYW5ndWFnZSAhPT0gdW5kZWZpbmVkICYmIGxhbmd1YWdlICE9PSBudWxsKSB7XG4gICAgICAgICAgICBxdWVyeVBhcmFtZXRlcnMgPSBxdWVyeVBhcmFtZXRlcnMuc2V0KCdsYW5ndWFnZScsIDxhbnk+bGFuZ3VhZ2UpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjbGllbnRJZCAhPT0gdW5kZWZpbmVkICYmIGNsaWVudElkICE9PSBudWxsKSB7XG4gICAgICAgICAgICBxdWVyeVBhcmFtZXRlcnMgPSBxdWVyeVBhcmFtZXRlcnMuc2V0KCdjbGllbnRJZCcsIDxhbnk+Y2xpZW50SWQpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChwdWJsaXNoICE9PSB1bmRlZmluZWQgJiYgcHVibGlzaCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgcXVlcnlQYXJhbWV0ZXJzID0gcXVlcnlQYXJhbWV0ZXJzLnNldCgncHVibGlzaCcsIDxhbnk+cHVibGlzaCk7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgaGVhZGVycyA9IHRoaXMuZGVmYXVsdEhlYWRlcnM7XG5cbiAgICAgICAgLy8gYXV0aGVudGljYXRpb24gKGJlYXJlckF1dGgpIHJlcXVpcmVkXG4gICAgICAgIGlmICh0aGlzLmNvbmZpZ3VyYXRpb24uYWNjZXNzVG9rZW4pIHtcbiAgICAgICAgICAgIGNvbnN0IGFjY2Vzc1Rva2VuID0gdHlwZW9mIHRoaXMuY29uZmlndXJhdGlvbi5hY2Nlc3NUb2tlbiA9PT0gJ2Z1bmN0aW9uJ1xuICAgICAgICAgICAgICAgID8gdGhpcy5jb25maWd1cmF0aW9uLmFjY2Vzc1Rva2VuKClcbiAgICAgICAgICAgICAgICA6IHRoaXMuY29uZmlndXJhdGlvbi5hY2Nlc3NUb2tlbjtcbiAgICAgICAgICAgIGhlYWRlcnMgPSBoZWFkZXJzLnNldCgnQXV0aG9yaXphdGlvbicsICdCZWFyZXIgJyArIGFjY2Vzc1Rva2VuKTtcbiAgICAgICAgfVxuICAgICAgICAvLyB0byBkZXRlcm1pbmUgdGhlIEFjY2VwdCBoZWFkZXJcbiAgICAgICAgbGV0IGh0dHBIZWFkZXJBY2NlcHRzOiBzdHJpbmdbXSA9IFtcbiAgICAgICAgICAgICdhcHBsaWNhdGlvbi9qc29uJ1xuICAgICAgICBdO1xuICAgICAgICBjb25zdCBodHRwSGVhZGVyQWNjZXB0U2VsZWN0ZWQ6IHN0cmluZyB8IHVuZGVmaW5lZCA9IHRoaXMuY29uZmlndXJhdGlvbi5zZWxlY3RIZWFkZXJBY2NlcHQoaHR0cEhlYWRlckFjY2VwdHMpO1xuICAgICAgICBpZiAoaHR0cEhlYWRlckFjY2VwdFNlbGVjdGVkICE9IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgaGVhZGVycyA9IGhlYWRlcnMuc2V0KCdBY2NlcHQnLCBodHRwSGVhZGVyQWNjZXB0U2VsZWN0ZWQpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gdG8gZGV0ZXJtaW5lIHRoZSBDb250ZW50LVR5cGUgaGVhZGVyXG4gICAgICAgIGNvbnN0IGNvbnN1bWVzOiBzdHJpbmdbXSA9IFtcbiAgICAgICAgXTtcblxuICAgICAgICByZXR1cm4gdGhpcy5odHRwQ2xpZW50LnJlcXVlc3Q8UnVsZT4oJ3B1dCcsYCR7dGhpcy5iYXNlUGF0aH0vcnVsZXMvdGV4dC8ke2VuY29kZVVSSUNvbXBvbmVudChTdHJpbmcodGV4dCkpfS9sZWV0X21hcHBpbmdzLyR7ZW5jb2RlVVJJQ29tcG9uZW50KFN0cmluZyhkZXBlbmRlbmN5KSl9YCxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBwYXJhbXM6IHF1ZXJ5UGFyYW1ldGVycyxcbiAgICAgICAgICAgICAgICB3aXRoQ3JlZGVudGlhbHM6IHRoaXMuY29uZmlndXJhdGlvbi53aXRoQ3JlZGVudGlhbHMsXG4gICAgICAgICAgICAgICAgaGVhZGVyczogaGVhZGVycyxcbiAgICAgICAgICAgICAgICBvYnNlcnZlOiBvYnNlcnZlLFxuICAgICAgICAgICAgICAgIHJlcG9ydFByb2dyZXNzOiByZXBvcnRQcm9ncmVzc1xuICAgICAgICAgICAgfVxuICAgICAgICApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFVwZGF0ZSB0aGUgY3VycmVudCBydWxlXG4gICAgICogVGhpcyB3aWxsIHVwZGF0ZSB0aGUgY3VycmVudCBydWxlIHRvIHRoZSBmb2xsb3dpbmdcbiAgICAgKiBAcGFyYW0gbGFuZ3VhZ2UgU2hvdyByZXN1bHRzIGZvciB0aGUgZ2l2ZW4gbGFuZ3VhZ2Ugb25seS4gICBUaGlzIGlzIHRoZSBsYW5ndWFnZSB1c2VkLCBjb3VsZCBoYXZlIGJlZW4gc2V0IGJ5IHRoZSB1c2VyIG9yIGRldGVjdGVkIGJ5IGxhbmd1YWdlIGlkLlxuICAgICAqIEBwYXJhbSB0ZXh0IFRoZSB0ZXh0IG9mIHRoZSBydWxlIHlvdSB3YW50IHRvIHdvcmsgb25cbiAgICAgKiBAcGFyYW0gYm9keSBcbiAgICAgKiBAcGFyYW0gY2xpZW50SWQgU2hvdyByZXN1bHRzIGZvciBhIGdpdmVuIGNsaWVudC4gIFR5cGljYWxseSB0aGlzIGlzIHNldCBmb3IgeW91IGJ5IHRoZSBpbnRlcm5hbCBzeXN0ZW0gYmFzZWQgb24gdGhlIEFQSV9LRVkgeW91IGFyZSB1c2luZy4gIEhvd2V2ZXIgc29tZSBjbGllbnRzIGFyZSBhbGxvd2VkIHRvIHZpZXcgb3RoZXIgY2xpZW50cyBzdWNoIGFzIHdoZW4gdGhleSBoYXZlIGEgc2FuZGJveCBvciB3aGVuIHRoZXkgYXJlIGEgbGFyZ2UgZW50ZXJwcmlzZSBhbmQgaGF2ZSBtdWx0aXBsZSBjbGllbnRzIHRoZXkgbWFuYWdlLiAgSXQgd2lsbCBvbmx5IGFsbG93IHlvdSB0byB2aWV3IGNsaWVudCBkYXRhIHlvdSBoYXZlIGFjY2VzcyB0by5cbiAgICAgKiBAcGFyYW0gcHVibGlzaCBUaGlzIHdpbGwgYWxzbyBtYWtlIHRoZSBydWxlIGxpdmVcbiAgICAgKiBAcGFyYW0gb2JzZXJ2ZSBzZXQgd2hldGhlciBvciBub3QgdG8gcmV0dXJuIHRoZSBkYXRhIE9ic2VydmFibGUgYXMgdGhlIGJvZHksIHJlc3BvbnNlIG9yIGV2ZW50cy4gZGVmYXVsdHMgdG8gcmV0dXJuaW5nIHRoZSBib2R5LlxuICAgICAqIEBwYXJhbSByZXBvcnRQcm9ncmVzcyBmbGFnIHRvIHJlcG9ydCByZXF1ZXN0IGFuZCByZXNwb25zZSBwcm9ncmVzcy5cbiAgICAgKi9cbiAgICBwdWJsaWMgdXBkYXRlUnVsZShsYW5ndWFnZTogc3RyaW5nLCB0ZXh0OiBzdHJpbmcsIGJvZHk/OiBSdWxlLCBjbGllbnRJZD86IG51bWJlciwgcHVibGlzaD86IGJvb2xlYW4sIG9ic2VydmU/OiAnYm9keScsIHJlcG9ydFByb2dyZXNzPzogYm9vbGVhbik6IE9ic2VydmFibGU8UnVsZT47XG4gICAgcHVibGljIHVwZGF0ZVJ1bGUobGFuZ3VhZ2U6IHN0cmluZywgdGV4dDogc3RyaW5nLCBib2R5PzogUnVsZSwgY2xpZW50SWQ/OiBudW1iZXIsIHB1Ymxpc2g/OiBib29sZWFuLCBvYnNlcnZlPzogJ3Jlc3BvbnNlJywgcmVwb3J0UHJvZ3Jlc3M/OiBib29sZWFuKTogT2JzZXJ2YWJsZTxIdHRwUmVzcG9uc2U8UnVsZT4+O1xuICAgIHB1YmxpYyB1cGRhdGVSdWxlKGxhbmd1YWdlOiBzdHJpbmcsIHRleHQ6IHN0cmluZywgYm9keT86IFJ1bGUsIGNsaWVudElkPzogbnVtYmVyLCBwdWJsaXNoPzogYm9vbGVhbiwgb2JzZXJ2ZT86ICdldmVudHMnLCByZXBvcnRQcm9ncmVzcz86IGJvb2xlYW4pOiBPYnNlcnZhYmxlPEh0dHBFdmVudDxSdWxlPj47XG4gICAgcHVibGljIHVwZGF0ZVJ1bGUobGFuZ3VhZ2U6IHN0cmluZywgdGV4dDogc3RyaW5nLCBib2R5PzogUnVsZSwgY2xpZW50SWQ/OiBudW1iZXIsIHB1Ymxpc2g/OiBib29sZWFuLCBvYnNlcnZlOiBhbnkgPSAnYm9keScsIHJlcG9ydFByb2dyZXNzOiBib29sZWFuID0gZmFsc2UgKTogT2JzZXJ2YWJsZTxhbnk+IHtcblxuICAgICAgICBpZiAobGFuZ3VhZ2UgPT09IG51bGwgfHwgbGFuZ3VhZ2UgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZXF1aXJlZCBwYXJhbWV0ZXIgbGFuZ3VhZ2Ugd2FzIG51bGwgb3IgdW5kZWZpbmVkIHdoZW4gY2FsbGluZyB1cGRhdGVSdWxlLicpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRleHQgPT09IG51bGwgfHwgdGV4dCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1JlcXVpcmVkIHBhcmFtZXRlciB0ZXh0IHdhcyBudWxsIG9yIHVuZGVmaW5lZCB3aGVuIGNhbGxpbmcgdXBkYXRlUnVsZS4nKTtcbiAgICAgICAgfVxuXG5cblxuXG4gICAgICAgIGxldCBxdWVyeVBhcmFtZXRlcnMgPSBuZXcgSHR0cFBhcmFtcyh7ZW5jb2RlcjogbmV3IEN1c3RvbUh0dHBVcmxFbmNvZGluZ0NvZGVjKCl9KTtcbiAgICAgICAgaWYgKGxhbmd1YWdlICE9PSB1bmRlZmluZWQgJiYgbGFuZ3VhZ2UgIT09IG51bGwpIHtcbiAgICAgICAgICAgIHF1ZXJ5UGFyYW1ldGVycyA9IHF1ZXJ5UGFyYW1ldGVycy5zZXQoJ2xhbmd1YWdlJywgPGFueT5sYW5ndWFnZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNsaWVudElkICE9PSB1bmRlZmluZWQgJiYgY2xpZW50SWQgIT09IG51bGwpIHtcbiAgICAgICAgICAgIHF1ZXJ5UGFyYW1ldGVycyA9IHF1ZXJ5UGFyYW1ldGVycy5zZXQoJ2NsaWVudElkJywgPGFueT5jbGllbnRJZCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHB1Ymxpc2ggIT09IHVuZGVmaW5lZCAmJiBwdWJsaXNoICE9PSBudWxsKSB7XG4gICAgICAgICAgICBxdWVyeVBhcmFtZXRlcnMgPSBxdWVyeVBhcmFtZXRlcnMuc2V0KCdwdWJsaXNoJywgPGFueT5wdWJsaXNoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBoZWFkZXJzID0gdGhpcy5kZWZhdWx0SGVhZGVycztcblxuICAgICAgICAvLyBhdXRoZW50aWNhdGlvbiAoYmVhcmVyQXV0aCkgcmVxdWlyZWRcbiAgICAgICAgaWYgKHRoaXMuY29uZmlndXJhdGlvbi5hY2Nlc3NUb2tlbikge1xuICAgICAgICAgICAgY29uc3QgYWNjZXNzVG9rZW4gPSB0eXBlb2YgdGhpcy5jb25maWd1cmF0aW9uLmFjY2Vzc1Rva2VuID09PSAnZnVuY3Rpb24nXG4gICAgICAgICAgICAgICAgPyB0aGlzLmNvbmZpZ3VyYXRpb24uYWNjZXNzVG9rZW4oKVxuICAgICAgICAgICAgICAgIDogdGhpcy5jb25maWd1cmF0aW9uLmFjY2Vzc1Rva2VuO1xuICAgICAgICAgICAgaGVhZGVycyA9IGhlYWRlcnMuc2V0KCdBdXRob3JpemF0aW9uJywgJ0JlYXJlciAnICsgYWNjZXNzVG9rZW4pO1xuICAgICAgICB9XG4gICAgICAgIC8vIHRvIGRldGVybWluZSB0aGUgQWNjZXB0IGhlYWRlclxuICAgICAgICBsZXQgaHR0cEhlYWRlckFjY2VwdHM6IHN0cmluZ1tdID0gW1xuICAgICAgICAgICAgJ2FwcGxpY2F0aW9uL2pzb24nXG4gICAgICAgIF07XG4gICAgICAgIGNvbnN0IGh0dHBIZWFkZXJBY2NlcHRTZWxlY3RlZDogc3RyaW5nIHwgdW5kZWZpbmVkID0gdGhpcy5jb25maWd1cmF0aW9uLnNlbGVjdEhlYWRlckFjY2VwdChodHRwSGVhZGVyQWNjZXB0cyk7XG4gICAgICAgIGlmIChodHRwSGVhZGVyQWNjZXB0U2VsZWN0ZWQgIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBoZWFkZXJzID0gaGVhZGVycy5zZXQoJ0FjY2VwdCcsIGh0dHBIZWFkZXJBY2NlcHRTZWxlY3RlZCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyB0byBkZXRlcm1pbmUgdGhlIENvbnRlbnQtVHlwZSBoZWFkZXJcbiAgICAgICAgY29uc3QgY29uc3VtZXM6IHN0cmluZ1tdID0gW1xuICAgICAgICAgICAgJ2FwcGxpY2F0aW9uL2pzb24nXG4gICAgICAgIF07XG4gICAgICAgIGNvbnN0IGh0dHBDb250ZW50VHlwZVNlbGVjdGVkOiBzdHJpbmcgfCB1bmRlZmluZWQgPSB0aGlzLmNvbmZpZ3VyYXRpb24uc2VsZWN0SGVhZGVyQ29udGVudFR5cGUoY29uc3VtZXMpO1xuICAgICAgICBpZiAoaHR0cENvbnRlbnRUeXBlU2VsZWN0ZWQgIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBoZWFkZXJzID0gaGVhZGVycy5zZXQoJ0NvbnRlbnQtVHlwZScsIGh0dHBDb250ZW50VHlwZVNlbGVjdGVkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzLmh0dHBDbGllbnQucmVxdWVzdDxSdWxlPigncHV0JyxgJHt0aGlzLmJhc2VQYXRofS9ydWxlcy90ZXh0LyR7ZW5jb2RlVVJJQ29tcG9uZW50KFN0cmluZyh0ZXh0KSl9YCxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBib2R5OiBib2R5LFxuICAgICAgICAgICAgICAgIHBhcmFtczogcXVlcnlQYXJhbWV0ZXJzLFxuICAgICAgICAgICAgICAgIHdpdGhDcmVkZW50aWFsczogdGhpcy5jb25maWd1cmF0aW9uLndpdGhDcmVkZW50aWFscyxcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiBoZWFkZXJzLFxuICAgICAgICAgICAgICAgIG9ic2VydmU6IG9ic2VydmUsXG4gICAgICAgICAgICAgICAgcmVwb3J0UHJvZ3Jlc3M6IHJlcG9ydFByb2dyZXNzXG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSW5zZXJ0L1VwZGF0ZSBydWxlcyBpbiB0aGUgc3lzdGVtXG4gICAgICogVGhpcyB3aWxsIHVwZGF0ZSBhIHJ1bGUgYW5kIGxvZyB0aGUgY2hhbmdlXG4gICAgICogQHBhcmFtIGJvZHkgXG4gICAgICogQHBhcmFtIHB1Ymxpc2ggVGhpcyB3aWxsIGFsc28gbWFrZSB0aGUgcnVsZSBsaXZlXG4gICAgICogQHBhcmFtIG9ic2VydmUgc2V0IHdoZXRoZXIgb3Igbm90IHRvIHJldHVybiB0aGUgZGF0YSBPYnNlcnZhYmxlIGFzIHRoZSBib2R5LCByZXNwb25zZSBvciBldmVudHMuIGRlZmF1bHRzIHRvIHJldHVybmluZyB0aGUgYm9keS5cbiAgICAgKiBAcGFyYW0gcmVwb3J0UHJvZ3Jlc3MgZmxhZyB0byByZXBvcnQgcmVxdWVzdCBhbmQgcmVzcG9uc2UgcHJvZ3Jlc3MuXG4gICAgICovXG4gICAgcHVibGljIHVwZGF0ZVJ1bGVzKGJvZHk/OiBBcnJheTxSdWxlPiwgcHVibGlzaD86IGJvb2xlYW4sIG9ic2VydmU/OiAnYm9keScsIHJlcG9ydFByb2dyZXNzPzogYm9vbGVhbik6IE9ic2VydmFibGU8SW5saW5lUmVzcG9uc2UyMDA+O1xuICAgIHB1YmxpYyB1cGRhdGVSdWxlcyhib2R5PzogQXJyYXk8UnVsZT4sIHB1Ymxpc2g/OiBib29sZWFuLCBvYnNlcnZlPzogJ3Jlc3BvbnNlJywgcmVwb3J0UHJvZ3Jlc3M/OiBib29sZWFuKTogT2JzZXJ2YWJsZTxIdHRwUmVzcG9uc2U8SW5saW5lUmVzcG9uc2UyMDA+PjtcbiAgICBwdWJsaWMgdXBkYXRlUnVsZXMoYm9keT86IEFycmF5PFJ1bGU+LCBwdWJsaXNoPzogYm9vbGVhbiwgb2JzZXJ2ZT86ICdldmVudHMnLCByZXBvcnRQcm9ncmVzcz86IGJvb2xlYW4pOiBPYnNlcnZhYmxlPEh0dHBFdmVudDxJbmxpbmVSZXNwb25zZTIwMD4+O1xuICAgIHB1YmxpYyB1cGRhdGVSdWxlcyhib2R5PzogQXJyYXk8UnVsZT4sIHB1Ymxpc2g/OiBib29sZWFuLCBvYnNlcnZlOiBhbnkgPSAnYm9keScsIHJlcG9ydFByb2dyZXNzOiBib29sZWFuID0gZmFsc2UgKTogT2JzZXJ2YWJsZTxhbnk+IHtcblxuXG5cbiAgICAgICAgbGV0IHF1ZXJ5UGFyYW1ldGVycyA9IG5ldyBIdHRwUGFyYW1zKHtlbmNvZGVyOiBuZXcgQ3VzdG9tSHR0cFVybEVuY29kaW5nQ29kZWMoKX0pO1xuICAgICAgICBpZiAocHVibGlzaCAhPT0gdW5kZWZpbmVkICYmIHB1Ymxpc2ggIT09IG51bGwpIHtcbiAgICAgICAgICAgIHF1ZXJ5UGFyYW1ldGVycyA9IHF1ZXJ5UGFyYW1ldGVycy5zZXQoJ3B1Ymxpc2gnLCA8YW55PnB1Ymxpc2gpO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IGhlYWRlcnMgPSB0aGlzLmRlZmF1bHRIZWFkZXJzO1xuXG4gICAgICAgIC8vIGF1dGhlbnRpY2F0aW9uIChiZWFyZXJBdXRoKSByZXF1aXJlZFxuICAgICAgICBpZiAodGhpcy5jb25maWd1cmF0aW9uLmFjY2Vzc1Rva2VuKSB7XG4gICAgICAgICAgICBjb25zdCBhY2Nlc3NUb2tlbiA9IHR5cGVvZiB0aGlzLmNvbmZpZ3VyYXRpb24uYWNjZXNzVG9rZW4gPT09ICdmdW5jdGlvbidcbiAgICAgICAgICAgICAgICA/IHRoaXMuY29uZmlndXJhdGlvbi5hY2Nlc3NUb2tlbigpXG4gICAgICAgICAgICAgICAgOiB0aGlzLmNvbmZpZ3VyYXRpb24uYWNjZXNzVG9rZW47XG4gICAgICAgICAgICBoZWFkZXJzID0gaGVhZGVycy5zZXQoJ0F1dGhvcml6YXRpb24nLCAnQmVhcmVyICcgKyBhY2Nlc3NUb2tlbik7XG4gICAgICAgIH1cbiAgICAgICAgLy8gdG8gZGV0ZXJtaW5lIHRoZSBBY2NlcHQgaGVhZGVyXG4gICAgICAgIGxldCBodHRwSGVhZGVyQWNjZXB0czogc3RyaW5nW10gPSBbXG4gICAgICAgICAgICAnYXBwbGljYXRpb24vanNvbidcbiAgICAgICAgXTtcbiAgICAgICAgY29uc3QgaHR0cEhlYWRlckFjY2VwdFNlbGVjdGVkOiBzdHJpbmcgfCB1bmRlZmluZWQgPSB0aGlzLmNvbmZpZ3VyYXRpb24uc2VsZWN0SGVhZGVyQWNjZXB0KGh0dHBIZWFkZXJBY2NlcHRzKTtcbiAgICAgICAgaWYgKGh0dHBIZWFkZXJBY2NlcHRTZWxlY3RlZCAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGhlYWRlcnMgPSBoZWFkZXJzLnNldCgnQWNjZXB0JywgaHR0cEhlYWRlckFjY2VwdFNlbGVjdGVkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHRvIGRldGVybWluZSB0aGUgQ29udGVudC1UeXBlIGhlYWRlclxuICAgICAgICBjb25zdCBjb25zdW1lczogc3RyaW5nW10gPSBbXG4gICAgICAgICAgICAnYXBwbGljYXRpb24vanNvbidcbiAgICAgICAgXTtcbiAgICAgICAgY29uc3QgaHR0cENvbnRlbnRUeXBlU2VsZWN0ZWQ6IHN0cmluZyB8IHVuZGVmaW5lZCA9IHRoaXMuY29uZmlndXJhdGlvbi5zZWxlY3RIZWFkZXJDb250ZW50VHlwZShjb25zdW1lcyk7XG4gICAgICAgIGlmIChodHRwQ29udGVudFR5cGVTZWxlY3RlZCAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGhlYWRlcnMgPSBoZWFkZXJzLnNldCgnQ29udGVudC1UeXBlJywgaHR0cENvbnRlbnRUeXBlU2VsZWN0ZWQpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cENsaWVudC5yZXF1ZXN0PElubGluZVJlc3BvbnNlMjAwPigncHV0JyxgJHt0aGlzLmJhc2VQYXRofS9ydWxlc2AsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgYm9keTogYm9keSxcbiAgICAgICAgICAgICAgICBwYXJhbXM6IHF1ZXJ5UGFyYW1ldGVycyxcbiAgICAgICAgICAgICAgICB3aXRoQ3JlZGVudGlhbHM6IHRoaXMuY29uZmlndXJhdGlvbi53aXRoQ3JlZGVudGlhbHMsXG4gICAgICAgICAgICAgICAgaGVhZGVyczogaGVhZGVycyxcbiAgICAgICAgICAgICAgICBvYnNlcnZlOiBvYnNlcnZlLFxuICAgICAgICAgICAgICAgIHJlcG9ydFByb2dyZXNzOiByZXBvcnRQcm9ncmVzc1xuICAgICAgICAgICAgfVxuICAgICAgICApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFVwZGF0ZSB0aGUgY3VycmVudCB0b3BpYyAob3IgYWRkIGlmIGRvZXMgbm90IGV4aXN0KSB3aXRoIHRoaXMgdmFsdWUuXG4gICAgICogVGhpcyB3aWxsIHVwZGF0ZSBhIHRvcGljIGZvciBhIHJ1bGUgYW5kIGxvZyB0aGUgY2hhbmdlXG4gICAgICogQHBhcmFtIGxhbmd1YWdlIFNob3cgcmVzdWx0cyBmb3IgdGhlIGdpdmVuIGxhbmd1YWdlIG9ubHkuICAgVGhpcyBpcyB0aGUgbGFuZ3VhZ2UgdXNlZCwgY291bGQgaGF2ZSBiZWVuIHNldCBieSB0aGUgdXNlciBvciBkZXRlY3RlZCBieSBsYW5ndWFnZSBpZC5cbiAgICAgKiBAcGFyYW0gdGV4dCBUaGUgdGV4dCBvZiB0aGUgcnVsZSB5b3Ugd2FudCB0byB3b3JrIG9uXG4gICAgICogQHBhcmFtIHRvcGljSWQgVGhlIHRvcGljIGlzIHRoZSBpZCBmb3IgdG9waWMuICBTZWUgZG9jdW1lbnRhdGlvbiBvbiBUb3BpYyBmb3Igd2hhdCB0aGUgaWRzIGFyZVxuICAgICAqIEBwYXJhbSBib2R5IFxuICAgICAqIEBwYXJhbSBjbGllbnRJZCBTaG93IHJlc3VsdHMgZm9yIGEgZ2l2ZW4gY2xpZW50LiAgVHlwaWNhbGx5IHRoaXMgaXMgc2V0IGZvciB5b3UgYnkgdGhlIGludGVybmFsIHN5c3RlbSBiYXNlZCBvbiB0aGUgQVBJX0tFWSB5b3UgYXJlIHVzaW5nLiAgSG93ZXZlciBzb21lIGNsaWVudHMgYXJlIGFsbG93ZWQgdG8gdmlldyBvdGhlciBjbGllbnRzIHN1Y2ggYXMgd2hlbiB0aGV5IGhhdmUgYSBzYW5kYm94IG9yIHdoZW4gdGhleSBhcmUgYSBsYXJnZSBlbnRlcnByaXNlIGFuZCBoYXZlIG11bHRpcGxlIGNsaWVudHMgdGhleSBtYW5hZ2UuICBJdCB3aWxsIG9ubHkgYWxsb3cgeW91IHRvIHZpZXcgY2xpZW50IGRhdGEgeW91IGhhdmUgYWNjZXNzIHRvLlxuICAgICAqIEBwYXJhbSBwdWJsaXNoIFRoaXMgd2lsbCBhbHNvIG1ha2UgdGhlIHJ1bGUgbGl2ZVxuICAgICAqIEBwYXJhbSBvYnNlcnZlIHNldCB3aGV0aGVyIG9yIG5vdCB0byByZXR1cm4gdGhlIGRhdGEgT2JzZXJ2YWJsZSBhcyB0aGUgYm9keSwgcmVzcG9uc2Ugb3IgZXZlbnRzLiBkZWZhdWx0cyB0byByZXR1cm5pbmcgdGhlIGJvZHkuXG4gICAgICogQHBhcmFtIHJlcG9ydFByb2dyZXNzIGZsYWcgdG8gcmVwb3J0IHJlcXVlc3QgYW5kIHJlc3BvbnNlIHByb2dyZXNzLlxuICAgICAqL1xuICAgIHB1YmxpYyB1cGRhdGVUb3BpYyhsYW5ndWFnZTogc3RyaW5nLCB0ZXh0OiBzdHJpbmcsIHRvcGljSWQ6IG51bWJlciwgYm9keT86IFVwZGF0ZVRvcGljLCBjbGllbnRJZD86IG51bWJlciwgcHVibGlzaD86IGJvb2xlYW4sIG9ic2VydmU/OiAnYm9keScsIHJlcG9ydFByb2dyZXNzPzogYm9vbGVhbik6IE9ic2VydmFibGU8UnVsZT47XG4gICAgcHVibGljIHVwZGF0ZVRvcGljKGxhbmd1YWdlOiBzdHJpbmcsIHRleHQ6IHN0cmluZywgdG9waWNJZDogbnVtYmVyLCBib2R5PzogVXBkYXRlVG9waWMsIGNsaWVudElkPzogbnVtYmVyLCBwdWJsaXNoPzogYm9vbGVhbiwgb2JzZXJ2ZT86ICdyZXNwb25zZScsIHJlcG9ydFByb2dyZXNzPzogYm9vbGVhbik6IE9ic2VydmFibGU8SHR0cFJlc3BvbnNlPFJ1bGU+PjtcbiAgICBwdWJsaWMgdXBkYXRlVG9waWMobGFuZ3VhZ2U6IHN0cmluZywgdGV4dDogc3RyaW5nLCB0b3BpY0lkOiBudW1iZXIsIGJvZHk/OiBVcGRhdGVUb3BpYywgY2xpZW50SWQ/OiBudW1iZXIsIHB1Ymxpc2g/OiBib29sZWFuLCBvYnNlcnZlPzogJ2V2ZW50cycsIHJlcG9ydFByb2dyZXNzPzogYm9vbGVhbik6IE9ic2VydmFibGU8SHR0cEV2ZW50PFJ1bGU+PjtcbiAgICBwdWJsaWMgdXBkYXRlVG9waWMobGFuZ3VhZ2U6IHN0cmluZywgdGV4dDogc3RyaW5nLCB0b3BpY0lkOiBudW1iZXIsIGJvZHk/OiBVcGRhdGVUb3BpYywgY2xpZW50SWQ/OiBudW1iZXIsIHB1Ymxpc2g/OiBib29sZWFuLCBvYnNlcnZlOiBhbnkgPSAnYm9keScsIHJlcG9ydFByb2dyZXNzOiBib29sZWFuID0gZmFsc2UgKTogT2JzZXJ2YWJsZTxhbnk+IHtcblxuICAgICAgICBpZiAobGFuZ3VhZ2UgPT09IG51bGwgfHwgbGFuZ3VhZ2UgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZXF1aXJlZCBwYXJhbWV0ZXIgbGFuZ3VhZ2Ugd2FzIG51bGwgb3IgdW5kZWZpbmVkIHdoZW4gY2FsbGluZyB1cGRhdGVUb3BpYy4nKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0ZXh0ID09PSBudWxsIHx8IHRleHQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZXF1aXJlZCBwYXJhbWV0ZXIgdGV4dCB3YXMgbnVsbCBvciB1bmRlZmluZWQgd2hlbiBjYWxsaW5nIHVwZGF0ZVRvcGljLicpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRvcGljSWQgPT09IG51bGwgfHwgdG9waWNJZCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1JlcXVpcmVkIHBhcmFtZXRlciB0b3BpY0lkIHdhcyBudWxsIG9yIHVuZGVmaW5lZCB3aGVuIGNhbGxpbmcgdXBkYXRlVG9waWMuJyk7XG4gICAgICAgIH1cblxuXG5cblxuICAgICAgICBsZXQgcXVlcnlQYXJhbWV0ZXJzID0gbmV3IEh0dHBQYXJhbXMoe2VuY29kZXI6IG5ldyBDdXN0b21IdHRwVXJsRW5jb2RpbmdDb2RlYygpfSk7XG4gICAgICAgIGlmIChsYW5ndWFnZSAhPT0gdW5kZWZpbmVkICYmIGxhbmd1YWdlICE9PSBudWxsKSB7XG4gICAgICAgICAgICBxdWVyeVBhcmFtZXRlcnMgPSBxdWVyeVBhcmFtZXRlcnMuc2V0KCdsYW5ndWFnZScsIDxhbnk+bGFuZ3VhZ2UpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjbGllbnRJZCAhPT0gdW5kZWZpbmVkICYmIGNsaWVudElkICE9PSBudWxsKSB7XG4gICAgICAgICAgICBxdWVyeVBhcmFtZXRlcnMgPSBxdWVyeVBhcmFtZXRlcnMuc2V0KCdjbGllbnRJZCcsIDxhbnk+Y2xpZW50SWQpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChwdWJsaXNoICE9PSB1bmRlZmluZWQgJiYgcHVibGlzaCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgcXVlcnlQYXJhbWV0ZXJzID0gcXVlcnlQYXJhbWV0ZXJzLnNldCgncHVibGlzaCcsIDxhbnk+cHVibGlzaCk7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgaGVhZGVycyA9IHRoaXMuZGVmYXVsdEhlYWRlcnM7XG5cbiAgICAgICAgLy8gYXV0aGVudGljYXRpb24gKGJlYXJlckF1dGgpIHJlcXVpcmVkXG4gICAgICAgIGlmICh0aGlzLmNvbmZpZ3VyYXRpb24uYWNjZXNzVG9rZW4pIHtcbiAgICAgICAgICAgIGNvbnN0IGFjY2Vzc1Rva2VuID0gdHlwZW9mIHRoaXMuY29uZmlndXJhdGlvbi5hY2Nlc3NUb2tlbiA9PT0gJ2Z1bmN0aW9uJ1xuICAgICAgICAgICAgICAgID8gdGhpcy5jb25maWd1cmF0aW9uLmFjY2Vzc1Rva2VuKClcbiAgICAgICAgICAgICAgICA6IHRoaXMuY29uZmlndXJhdGlvbi5hY2Nlc3NUb2tlbjtcbiAgICAgICAgICAgIGhlYWRlcnMgPSBoZWFkZXJzLnNldCgnQXV0aG9yaXphdGlvbicsICdCZWFyZXIgJyArIGFjY2Vzc1Rva2VuKTtcbiAgICAgICAgfVxuICAgICAgICAvLyB0byBkZXRlcm1pbmUgdGhlIEFjY2VwdCBoZWFkZXJcbiAgICAgICAgbGV0IGh0dHBIZWFkZXJBY2NlcHRzOiBzdHJpbmdbXSA9IFtcbiAgICAgICAgICAgICdhcHBsaWNhdGlvbi9qc29uJ1xuICAgICAgICBdO1xuICAgICAgICBjb25zdCBodHRwSGVhZGVyQWNjZXB0U2VsZWN0ZWQ6IHN0cmluZyB8IHVuZGVmaW5lZCA9IHRoaXMuY29uZmlndXJhdGlvbi5zZWxlY3RIZWFkZXJBY2NlcHQoaHR0cEhlYWRlckFjY2VwdHMpO1xuICAgICAgICBpZiAoaHR0cEhlYWRlckFjY2VwdFNlbGVjdGVkICE9IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgaGVhZGVycyA9IGhlYWRlcnMuc2V0KCdBY2NlcHQnLCBodHRwSGVhZGVyQWNjZXB0U2VsZWN0ZWQpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gdG8gZGV0ZXJtaW5lIHRoZSBDb250ZW50LVR5cGUgaGVhZGVyXG4gICAgICAgIGNvbnN0IGNvbnN1bWVzOiBzdHJpbmdbXSA9IFtcbiAgICAgICAgICAgICdhcHBsaWNhdGlvbi9qc29uJ1xuICAgICAgICBdO1xuICAgICAgICBjb25zdCBodHRwQ29udGVudFR5cGVTZWxlY3RlZDogc3RyaW5nIHwgdW5kZWZpbmVkID0gdGhpcy5jb25maWd1cmF0aW9uLnNlbGVjdEhlYWRlckNvbnRlbnRUeXBlKGNvbnN1bWVzKTtcbiAgICAgICAgaWYgKGh0dHBDb250ZW50VHlwZVNlbGVjdGVkICE9IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgaGVhZGVycyA9IGhlYWRlcnMuc2V0KCdDb250ZW50LVR5cGUnLCBodHRwQ29udGVudFR5cGVTZWxlY3RlZCk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcy5odHRwQ2xpZW50LnJlcXVlc3Q8UnVsZT4oJ3B1dCcsYCR7dGhpcy5iYXNlUGF0aH0vcnVsZXMvdGV4dC8ke2VuY29kZVVSSUNvbXBvbmVudChTdHJpbmcodGV4dCkpfS90b3BpYy8ke2VuY29kZVVSSUNvbXBvbmVudChTdHJpbmcodG9waWNJZCkpfWAsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgYm9keTogYm9keSxcbiAgICAgICAgICAgICAgICBwYXJhbXM6IHF1ZXJ5UGFyYW1ldGVycyxcbiAgICAgICAgICAgICAgICB3aXRoQ3JlZGVudGlhbHM6IHRoaXMuY29uZmlndXJhdGlvbi53aXRoQ3JlZGVudGlhbHMsXG4gICAgICAgICAgICAgICAgaGVhZGVyczogaGVhZGVycyxcbiAgICAgICAgICAgICAgICBvYnNlcnZlOiBvYnNlcnZlLFxuICAgICAgICAgICAgICAgIHJlcG9ydFByb2dyZXNzOiByZXBvcnRQcm9ncmVzc1xuICAgICAgICAgICAgfVxuICAgICAgICApO1xuICAgIH1cblxufVxuIl19
